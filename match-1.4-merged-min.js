var M=window.M||{};
(function(f){function e(){var a="Firefox;Chrome;Opera;Safari;MSIE 9.0;BlackBerry".split(";"),b,d;this.name=void 0;for(b in a)d=a[b],this["is"+d]=-1!=navigator.userAgent.indexOf(d),!this.name&&this["is"+d]&&(this.name=d);this.supportedAudioFormat=this.getBrowserPreferredAudioFormat();this.supported=void 0!=this.name}function d(){var a="Android BlackBerry iPhone iPad iPod IEMobile".split(" "),b;for(b in a)deviceName=a[b],this["is"+deviceName]=-1!=navigator.userAgent.indexOf(deviceName),!this.name&&
this["is"+deviceName]&&(this.name=deviceName);this.name?this.isMobile=!0:(this.isMobile=!1,this.name="PC")}function b(){window.requestAnimFrame(b);window.Match.gameLoop()}function a(){this._isPlaying=!1;this._gameLayers=[];this._gameObjects=[];this._gameObjectsToAdd=[];this.cache=null;this.offScreenCanvas=document.createElement("canvas");this.offScreenContext=this.offScreenCanvas.getContext("2d");this.onLoopProperties={offScreenContext:this.offScreenContext,offScreenCanvas:this.offScreenCanvas,debug:!1,
time:0};this.browser=new e;this.device=new d;this.setDoubleBuffer(!1);var a=this;document.addEventListener("DOMContentLoaded",function(){a.setUpGameLoop()})}f.Match||(e.prototype.getBrowserPreferredAudioFormat=function(){var a=document.createElement("audio");if(""!=a.canPlayType("audio/ogg"))return".ogg";if(""!=a.canPlayType("audio/mpeg"))return".mp3";if(""!=a.canPlayType("audio/wav"))return".wav";if(""!=a.canPlayType("audio/mp4"))return".mp4";console.warn("This browser does not support audio")},
e.prototype.getBrowserAudioSupportedFormats=function(){var a=document.createElement("audio"),b=[];""!=a.canPlayType("audio/ogg")&&b.push(".ogg");""!=a.canPlayType("audio/mpeg")&&b.push(".mp3");""!=a.canPlayType("audio/wav")&&b.push(".wav");""!=a.canPlayType("audio/mp4")&&b.push(".mp4");return b.join("|")},a.prototype={setUpGameLoop:function(){this.gameLoopAlreadySetup=!0;b();"function"==typeof window.main&&window.main()},setDebug:function(a){this.onLoopProperties.debug=a},setKeyboard:function(a){this.keyboard=
a;this.onLoopProperties.keyboard=a},setMouse:function(a){this.mouse=a;this.onLoopProperties.mouse=a},setTouch:function(a){this.touch=a;this.onLoopProperties.touch=a},setAccelerometer:function(a){this.accelerometer=a;this.onLoopProperties.accelerometer=a},setOrientation:function(a){this.orientation=a;this.onLoopProperties.orientation=a},renderSingleBuffer:function(a,b,d){var g=a.length,e=0,f=this.frontBuffer;for(f.clearRect(0,0,b.width,b.height);e<g;e++)f.drawImage(a[e].onLoop(d),0,0)},renderDoubleBuffer:function(a,
b,d){var g=a.length,e=0,f,h=this.backBuffer;for(h.clearRect(0,0,b.width,b.height);e<g;e++)f=a[e],h.save(),f.composite&&(h.globalCompositeOperation=f.composite),0<=f._alpha&&1>=f._alpha&&(h.globalAlpha=f._alpha),h.translate(h.halfWidth,h.halfHeight),f.rotation&&h.rotate(f.rotation),f.scale&&h.scale(f.scale.x,f.scale.y),h.drawImage(f.onLoop(d),-h.halfWidth,-h.halfHeight),h.restore();this.frontBuffer.clearRect(0,0,b.width,b.height);this.frontBuffer.drawImage(h.canvas,0,0)},updateGameObjects:function(a,
b){for(var d in a){var e=a[d];b.keyboard&&b.keyboard.applyToObject(e);b.mouse&&b.mouse.applyToObject(e);b.touch&&b.touch.applyToObject(e);b.accelerometer&&b.accelerometer.applyToObject(e);b.orientation&&b.orientation.applyToObject(e);if(e.onLoop)e.onLoop(b);e.children&&this.updateGameObjects(e.children,b)}},gameLoop:function(){if(this._isPlaying){if(this.onBeforeLoop)this.onBeforeLoop();var a=this.onLoopProperties;a.time=this.FpsCounter.timeInMillis;this.updateGameObjects(this._gameObjects,a);a.mouse&&
a.mouse.update();a.touch&&a.touch.update();a.keyboard&&a.keyboard.update();a.accelerometer&&a.accelerometer.update();a.orientation&&a.orientation.update();this.render(this._gameLayers,this.frontBuffer.canvas,a);if(a.debug){this.frontBuffer.save();this.frontBuffer.font="18px sans-serif";this.frontBuffer.fillStyle="yellow";this.frontBuffer.fillText(this.getFps()+"fps",20,20);for(a=0;a<this._gameLayers.length;a++)this.frontBuffer.fillText("layer"+a+" "+this._gameLayers[a]._loopTime+"ms",20,40+20*a);
this.frontBuffer.restore()}this.FpsCounter.count();if(this.onAfterLoop)this.onAfterLoop()}},getFirst:function(){return this.getIndex(0)},getIndex:function(a){try{return this._gameObjects[a]}catch(b){return null}},get:function(a){if(this.cache&&this.cache.key==a)return this.cache;for(var b=this._gameObjects.length,d;b--;)if(d=this._gameObjects[b],a==d.key)return this.cache=d;return null},getLast:function(){return this.getIndex(this._gameObjects.length-1)},isInOnLoopList:function(a){return-1!=this._gameObjects.indexOf(a)},
pushGameObject:function(a){if(!a.onLoop)throw Error("Cannot add object with no onLoop method "+a.constructor.name);this._gameObjects.push(a)},pushObject:function(a){this.pushGameObject(a)},removeGameObject:function(a){void 0!=a&&("string"==typeof a?this.removeGameObject(this.get(a)):isNaN(a)?(a=this._gameObjects.indexOf(a),-1!=a&&this._gameObjects.splice(a,1)):this._gameObjects.splice(a,1))},removeAllGameObjects:function(){this._gameObjects=[]},createNewContext:function(){return window.document.createElement("canvas").getContext("2d")},
setDoubleBuffer:function(a){a?(this.backBuffer=this.createNewContext(),this.updateBufferSize(),this.render=this.renderDoubleBuffer):this.render=this.renderSingleBuffer},isDoubleBuffered:function(){return this.render==this.renderDoubleBuffer},setCanvasSize:function(a,b){this.frontBuffer&&(this.frontBuffer.canvas.width=a,this.frontBuffer.canvas.height=b,this.updateBufferSize())},updateBufferSize:function(){this.frontBuffer&&(this.backBuffer&&this.frontBuffer&&(this.backBuffer.canvas.width=this.frontBuffer.canvas.width,
this.backBuffer.canvas.height=this.frontBuffer.canvas.height,this.backBuffer.halfWidth=this.backBuffer.canvas.width/2,this.backBuffer.halfHeight=this.backBuffer.canvas.height/2),this.offScreenCanvas.width=this.frontBuffer.canvas.width,this.offScreenCanvas.height=this.frontBuffer.canvas.height,this.collisions.PixelPerfect&&(this.collisions.PixelPerfect.testContext.canvas.width=this.offScreenCanvas.width,this.collisions.PixelPerfect.testContext.canvas.height=this.offScreenCanvas.height),this.updateViewport())},
createGameLayer:function(){var a=new this.GameLayer;this.frontBuffer&&a.setBufferSize(this.frontBuffer.canvas);this.pushGameLayer(a);return a},createLayer:function(){return this.createGameLayer()},pushGameLayer:function(a){if(!a)throw Error("Cannot add null game layer");this.frontBuffer&&a.setBufferSize(this.frontBuffer.canvas);this._gameLayers.push(a)},pushLayer:function(a){this.pushGameLayer(a)},removeScene:function(){var a=this._gameLayers;this._gameLayers=[];return a},pushScene:function(a){for(var b=
0,d=a.length;b<d;b++)this.pushGameLayer(a[b])},swapScenes:function(a){a=this.removeScene();this.pushScene(a);return a},removeGameLayer:function(a){a||(a=this._gameLayers[0]);this.removeElementFromArray(a,this._gameLayers);for(var b in a.onRenderList)this.removeGameObject(a.onRenderList[b])},removeAllGameLayers:function(){for(var a=0;a<this._gameLayers.length;a++)this.removeGameLayer(this._gameLayers[a])},getSpeed:function(a){return a/this.getAverageFps()},getFps:function(){return this.FpsCounter.fps},
getAverageFps:function(){return this.FpsCounter.getAverageFps()},getGameTime:function(){return this.FpsCounter.gameTime},getTime:function(){return this.FpsCounter.timeInMillis},clearFrontBuffer:function(){this.frontBuffer&&this.frontBuffer.clearRect(0,0,this.frontBuffer.canvas.width,this.frontBuffer.canvas.height)},pause:function(){if(this._isPlaying){if(this.onPause)this.onPause()}else if(this.onUnPause)this.onUnPause();this._isPlaying=!this._isPlaying},start:function(a,b){a||(a=M.dom("canvas"));
if(!(a instanceof HTMLCanvasElement))throw Error("start is expecting an HTMLCanvasElement as argument");a.onselectstart=function(){return!1};a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullScreen;this.frontBuffer=a.getContext("2d");this.updateBufferSize();this.updateViewport();for(var d=0,e=this._gameLayers.length;d<e;d++)this._gameLayers[d].setBufferSize(a);this._isPlaying=!0;this.gameLoopAlreadySetup||this.setUpGameLoop()},updateViewport:function(){this.camera.setViewport(this.frontBuffer.canvas.width,
this.frontBuffer.canvas.height)},getViewportSize:function(){return{width:this.camera.viewportWidth,height:this.camera.viewportHeight}},removeIndexFromArray:function(a,b){b.splice(a,1)},removeElementFromArray:function(a,b){var d=b.indexOf(a);-1!=d&&this.removeIndexFromArray(d,b)},dom:function(a){return document.querySelector(a)},applyProperties:function(a,b,d){if(a&&b){if(d){if(!b)throw Error("Cannot apply null properties to "+a.constructor.name);for(var e=d.length;e--;)if(!b[d[e]])throw Error("Unable to apply properties to ["+
a.constructor.name+"] You must specify ["+d[e]+"]");}d="";for(e in b)if(d="set"+e.charAt(0).toUpperCase()+e.substr(1),a[d])a[d](b[e]);else a[e]=b[e];return a}},apply:function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var d=arguments[b];if(d)if(d instanceof Function){var e=new d,f;for(f in e)d.prototype[f]||a[f]||(a[f]=e[f])}else for(f in d)a[f]||(a[f]=d[f])}},put:function(a,b){for(var d in b)a[d]=b[d]},clone:function(a){for(var b in a)c[b]=a[b];return{}},each:function(a,b,d){var e=a.length;
if(d)for(;e--;)b.call(d,a[e]);else for(;e--;)b.call(a[e])},extend:function(a,b){for(var d in b.prototype)a.prototype[d]||(a.prototype[d]=b.prototype[d])},round:function(a,b){for(var d="1";b--;)d+="0";b=parseInt(d);return Math.round(a*b)/b},getPercentage:function(a,b){return a*b/100},elapsedTimeFrom:function(a,b){return M.getTime()-a>=b},isPaused:function(){return!this._isPlaying},getStyleBySelector:function(a){var b=document.styleSheets,d,e,f;for(e=b.length-1;0<=e;e--)for(d=b[e].cssRules,f=0;f<d.length;f++)if(d[f].type==
CSSRule.STYLE_RULE&&d[f].selectorText==a)return d[f].style;return null},setFullScreen:function(){this.frontBuffer&&this.frontBuffer.canvas.requestFullScreen&&this.frontBuffer.canvas.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}},window.console?(window.console.log&&(window.console.debug=window.console.log),window.console.warn||(window.console.warn=window.console.debug)):(window.console={},window.console.log=window.console.debug=window.console.error=window.console.warning=function(){}),HTMLElement.prototype.remove=
function(){this.parentNode.removeChild(this)},HTMLElement.prototype.setClass=function(a){this.setAttribute("class",a)},HTMLCanvasElement.prototype.getCenter=function(){return{x:this.width/2,y:this.height/2}},HTMLCanvasElement.prototype.setSize=function(a,b){this.width=a;this.height=b},HTMLCanvasElement.prototype.adjustTo=function(a,b){this.style.setProperty("width",a+"px",null);this.style.setProperty("height",b+"px",null)},HTMLCanvasElement.prototype.adjustToAvailSize=function(){this.adjustTo(window.screen.availWidth+
"px",window.screen.availHeight+"px")},HTMLCanvasElement.prototype.resizeKeepingAspect=function(a){this.adjustTo(this.width*a,this.height*a)},HTMLCanvasElement.prototype.getRight=function(){return this.offsetLeft+this.offsetWidth},HTMLCanvasElement.prototype.getBottom=function(){return this.offsetTop+this.offsetHeight},HTMLCanvasElement.prototype.getAvailWidth=function(){return this.getRight()<window.screen.availWidth?this.offsetWidth:window.screen.availWidth-this.offsetLeft},HTMLCanvasElement.prototype.getAvailHeight=
function(){return this.getBottom()<window.screen.availHeight?this.offsetHeight:window.screen.availHeight-this.offsetTop},HTMLCanvasElement.prototype.getViewport=function(){var a={};a.left=0>this.offsetLeft?-this.offsetLeft:0;a.top=0>this.offsetTop?-this.offsetTop:0;a.right=this.offsetLeft+this.offsetWidth>window.screen.availWidth?window.screen.availWidth-this.offsetLeft:this.offsetWidth;a.bottom=this.offsetTop+this.offsetHeight>window.screen.availHeight?window.screen.availHeight-this.offsetTop:this.offsetHeight;
return a},HTMLCanvasElement.prototype.getAspect=function(){var a={x:1,y:1};this.style.width&&this.width!=parseInt(this.style.width)&&(a.x=this.width/parseInt(this.style.width));this.style.height&&this.height!=parseInt(this.style.height)&&(a.y=this.height/parseInt(this.style.height));return a},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,
1E3/60)}}(),f.M=f.Match=new a)})(window);(function(f){function e(){this.listeners=[]}e.prototype.addEventListener=function(d,b){b&&(d=d.bind(b));this.listeners.push(d)};e.prototype.raise=function(){for(var d=0,b=this.listeners.length;d<b;d++)this.listeners[d](arguments)};e.prototype.removeEventListener=function(d){d=this.listeners.indexOf(d);-1<d&&this.listeners.splice(d,1)};f.EventListener=e})(window.Match);(function(f){function e(){this.lastTime=(new Date).getTime();this._currentFps=0;this.fps="";this.gameTime=1;this.totalFps=this.timeInMillis=0}e.prototype.reset=function(){this.fps="";this.timeInMillis=this._currentFps=this.totalFps=0;this.gameTime=1};e.prototype.count=function(){this.timeInMillis=(new Date).getTime();1E3<=this.timeInMillis-this.lastTime?(this.lastTime=this.timeInMillis,this.fps=this._currentFps,this.gameTime++,this.totalFps+=this.fps,this._currentFps=0):this._currentFps++};e.prototype.getAverageFps=
function(){return 0==this.totalFps?60:Math.floor(this.totalFps/this.gameTime)};f.FpsCounter=new e})(window.Match);(function(f){function e(){this.hasFocus=!1;this.children={}}e.prototype.removeChild=function(d){delete this.children[d]};e.prototype.onLoop=function(){throw Error("Method GameObject.onLoop is abstract and must be overriden");};f.GameObject=e})(window.M);(function(f){function e(){this.math=Math}function d(b,a){this.x=b;this.y=a}e.prototype.getXFromCircle=function(b,a,d){return b+a*this.math.cos(d)};e.prototype.getYFromCircle=function(b,a,d){return b+a*this.math.sin(d)};e.prototype.getPointFromCircle=function(b,a,d,e){return this.getPointFromElipsis(b,a,d,d,e)};e.prototype.getPointFromElipsis=function(b,a,e,p,f){return new d(this.getXFromCircle(b,e,f),this.getYFromCircle(a,p,f))};e.prototype.getVector2d=function(b,a){return new d(a.x-b.x,a.y-b.y)};
e.prototype.getVector=function(b,a){return this.getVector2d(b,a)};e.prototype.getRotatedVertex=function(b,a){return new d(b.x*this.math.cos(a)-b.y*this.math.sin(a),b.y*this.math.cos(a)+b.x*this.math.sin(a))};e.prototype.getMagnitude=function(b){return this.math.sqrt(b.x*b.x+b.y*b.y)};e.prototype.getSquareDistance=function(b,a){var d=b.x-a.x,e=b.y-a.y;return d*d+e*e};e.prototype.getAngleBetweenVectors=function(b,a){var d=this.getMagnitude(b)*this.getMagnitude(a);return this.math.acos((b.x*a.x+b.y*
a.y)/d)};e.prototype.getCosBetweenVectors=function(b,a){var d=this.getMagnitude(b)*this.getMagnitude(a);return(b.x*a.x+b.y*a.y)/d};e.prototype.getDistance=function(b,a){return this.math.sqrt(this.getSquareDistance(b,a))};e.prototype.haveTheSameDirection=function(b,a){return 0<b.x&&0>a.x||0>b.x&&0<a.x||0<b.y&&0>a.y||0>b.y&&0<a.y?!1:!0};e.prototype.areParallelVectors=function(b,a){b=this.getNormalized(b);a=this.getNormalized(a);var d=b.x/a.x,e=b.y/a.y;return d>=e-0.1&&d<=e+0.1};e.prototype.getNormalized=
function(b){var a=this.getMagnitude(b);return new d(b.x/a,b.y/a)};e.prototype.substract=function(b,a){return new d(b.x-a.x,b.y-a.y)};e.prototype.add=function(b,a){return new d(b.x+a.x,b.y+a.y)};e.prototype.scalarProduct=function(b,a){return new d(b.x*a,b.y*a)};e.prototype.rotateIfNeeded=function(b,a,d){if(!this.areParallelVectors(b,a)||!this.haveTheSameDirection(b,a)){var e=this.getSquareDistance(b,a),f=this.getRotatedVertex(b,d);if(this.getSquareDistance(f,a)<e)return b.x=f.x,b.y=f.y,d;a=this.getRotatedVertex(b,
-d);b.x=a.x;b.y=a.y;return-d}return 0};f.math2d=f.Math2d=new e;f.math2d.Vector2d=d})(window.Match);(function(f,e){function d(b){this.objects=[];this.mode=null;this.setMode(b||"Polygon")}d.prototype={reset:function(){this.objects=[]},onLoop:function(){for(var b=0,a=1;b<this.objects.length;){for(;a<this.objects.length;)this.checkCollisions(this.objects[b],this.objects[a]),a++;b++;a=b+1}for(b=this.objects.length;b--;)this.objects[b]._visible||f.removeIndexFromArray(b,this.objects)},canCollide:function(b,a){if(b.cantCollideType)for(var d=b.cantCollideType.length;d--;)if(a instanceof b.cantCollideType[d])return!1;
if(b.cantCollide)for(d=b.cantCollide.length;d--;)if(b.cantCollide[d]==a)return!1;return!0},checkCollisions:function(b,a){if(this.canCollide(b,a)&&this.canCollide(a,b)&&this.mode.haveCollided(b,a)){if(b.onCollision)b.onCollision(a);if(a.onCollision)a.onCollision(b)}},setMode:function(b,a){this.mode="string"===typeof b?f.collisions[b]:b},push:function(b){this.objects.push(b)},removeType:function(b){for(var a=this.objects.length;a--;)this.objects[a]instanceof b&&this.remove(this.objects[a])}};e.AllvsAllCollisionHandler=
d})(window.Match,window.Match.collisions||(window.Match.collisions={}));(function(f,e){function d(b){this.colliders=[];this.collidables=[];this.setMode(b||"Polygon");this.collidableCallback=this.colliderCallback="onCollision"}d.prototype={onLoop:function(){for(var b=this.colliders.length;b--;)this.checkCollisions(this.colliders[b],this.collidables)},checkCollisions:function(b,a){if(b)for(var d=a.length,e=null;d--;){e=a[d];if(!e)break;if(e instanceof Array)this.checkCollisions(b,e);else if(this.mode.haveCollided(b,e)){if(b[this.colliderCallback])b[this.colliderCallback](e);
if(e[this.collidableCallback])e[this.collidableCallback](b)}}},setMode:function(b){this.mode="string"===typeof b?f.collisions[b]:b}};e.CollisionHandler=d})(window.Match,window.Match.collisions||(window.Match.collisions={}));(function(f,e){function d(){this.math2d=e}d.prototype={getCollisionArea:function(b){var a=[],d=b.getWidth()/2,e=b.getHeight()/2;a.push({x:-d,y:-e});a.push({x:d,y:-e});a.push({x:d,y:e});a.push({x:-d,y:e});this.rotate(a,b._rotation);this.translate(a,b._x,b._y);return a},translate:function(b,a,d){for(var e=0;e<b.length;e++)b[e].x+=a,b[e].y+=d},rotate:function(b,a){if(a)for(var d=0;d<b.length;d++)b[d]=this.math2d.getRotatedVertex(b[d],a)},haveCollided:function(b,a){for(var d=this.getCollisionArea(a),
e=this.getCollisionArea(b),f=0;f<e.length;f++)if(this.pointInPolygon(e[f].x,e[f].y,d)||this.pointInPolygon(d[f].x,d[f].y,e))return!0;return!1},pointInPolygon:function(b,a,d){var e,f,g=!1,n=d.length,m;e=0;for(f=n-1;e<n;f=e++)m=d[e],f=d[f],m.y>a!=f.y>a&&b<(f.x-m.x)*(a-m.y)/(f.y-m.y)+m.x&&(g=!g);return g}};f.Polygon=new d})(window.Match.collisions||(window.Match.collisions={}),window.Match.math2d);(function(f){function e(){}e.prototype={haveCollided:function(d,b){var a=0,e=0,a=d._halfWidth>d._halfHeight?d._halfWidth:d._halfHeight,e=b._halfWidth>b._halfHeight?b._halfWidth:b._halfHeight;return d._y+a<b._y-e||d._y-a>b._y+e||d._x+a<b._x-e||d._x-a>b._x+e?!1:!0}};f.Square=new e})(window.Match.collisions||(window.Match.collisions={}));(function(f,e){function d(b){this.math2d=e}d.prototype={haveCollided:function(b,a){var d=b.getWidth()*b.getHeight()/2,e=a.getWidth()*a.getHeight()/2,d=d<e?d:e;return this.math2d.getSquareDistance(b.getLocation(),a.getLocation())<=d*d}};f.Radial=new d})(window.Match.collisions||(window.Match.collisions={}),window.Match.math2d);(function(f){function e(){}e.prototype={haveCollided:function(d,b){return d.getBottom()<b.getTop()||d.getTop()>b.getBottom()||d.getRight()<b.getLeft()||d.getLeft()>b.getRight()?!1:!0}};f.Simple=new e})(window.Match.collisions||(window.Match.collisions={}));(function(f,e){function d(){this.testContext=document.createElement("canvas").getContext("2d")}d.prototype.haveCollided=function(b,a){var d=window.Math,e=d.min(b.getLeft(),a.getLeft()),f=d.min(b.getTop(),a.getTop()),g=d.max(b.getRight(),a.getRight())-e,n=d.max(b.getBottom(),a.getBottom())-f,m=this.testContext,h=d=0;m.clearRect(e,f,g,n);m.save();b.onRender(m,m.canvas,0,0);m.globalCompositeOperation="source-in";a.onRender(m,m.canvas,0,0);m.restore();for(e=m.getImageData(e,f,g,n);d<e.width;){for(;h<
e.height;){if(0!=e.data[4*(h*e.width+d)+3])return!0;h++}d++;h=0}return!1};e.PixelPerfect=new d})(window.Match,window.Match.collisions||(window.Match.collisions={}));(function(f){function e(){this._halfViewportWidth=this._halfViewportHeight=this.viewportHeight=this.viewportWidth=this.y=this.x=0}e.prototype.setViewport=function(d,b){this.viewportWidth=d;this.viewportHeight=b;this._halfViewportWidth=d/2;this._halfViewportHeight=b/2};e.prototype.centerAtRenderizable=function(d){this.x=d._x-this._halfViewportWidth;this.y=d._y-this._halfViewportHeight};e.prototype.centerAt=function(d,b){this.x=d-this._halfViewportWidth;this.y=b-this._halfViewportHeight};f.onLoopProperties.camera=
f.camera=new e})(window.Match);(function(f){function e(a){f.mouse.mousedown(a)}function d(a){f.mouse.mouseup(a)}function b(a){f.mouse.click(a)}function a(a){f.mouse.mousemove(a)}function s(a){f.mouse.mousewheel(a)}function p(a){f.mouse.DOMMouseScroll(a)}function k(){this.events={0:{},1:{},2:{}};this.y=this.x=null;this.isDragging=!1;f.browser.isFirefox?document.addEventListener("DOMMouseScroll",p,!1):"MSIE 9.0"==f.browser.name?document.addEventListener("onwheel",s,!1):document.addEventListener("mousewheel",s,!1);document.addEventListener("mousedown",
e,!1);document.addEventListener("mouseup",d,!1);document.addEventListener("mousemove",a,!1);document.addEventListener("click",b,!1)}k.prototype={LEFT:0,MIDDLE:1,RIGHT:2,select:function(a){this.isDragging||(this.selectedObject=a)},fireEventOnLastSelectedObject:function(){var a=this.selectedObject,b=this.prevSelectedObject;if(a){a.onMouseIn&&!a._mouseInRaised&&(a._mouseInRaised=!0,a.onMouseIn(this));if(b&&b!=a&&(b._mouseInRaised=!1,b.onMouseOut))b.onMouseOut(this);if(a.onMouseUp&&this.up())a.onMouseUp(this);
if(a.onClick&&this.clicked())a.onClick(this);if(a.onMouseDown&&this.down()&&(a.onMouseDown(this),this.isDragging=!0,a.onDrag))a.onDrag(this);if(a.onMouseOver)a.onMouseOver(this);if(a.onMouseMove&&this.moved())a.onMouseMove(this);if(a.onMouseWheel&&this.wheel())a.onMouseWheel(this)}else b&&b.onMouseOut&&(b._mouseInRaised=!1,b.onMouseOut(this));this.prevSelectedObject=a;this.isDragging||(this.selectedObject=null)},clicked:function(a){return null!=a?this.events[a].click:this.events[0].click},down:function(a){return null!=
a?this.events[a].down:this.events[0].down||this.events[1].down||this.events[2].down},up:function(a){return null!=a?this.events[a].up:this.events[0].up||this.events[1].up||this.events[2].up},moved:function(){return this.eventMouseMove},wheel:function(){this.wheelDeltaY=0;this.eventMouseWheel&&(this.wheelDeltaY=this.eventMouseWheel.wheelDeltaY);return this.wheelDeltaY},clear:function(){for(var a=0;3>a;a++)this.events[a].up=null,this.events[a].click=null;this.eventMouseMove=this.eventMouseWheel=null},
click:function(a){this.events[a.button].click=a;this.x=a.offsetX;this.y=a.offsetY},mousedown:function(a){this.events[a.button].down=a},mouseup:function(a){this.events[a.button].down=null;this.events[a.button].up=a;this.isDragging=!1},mousewheel:function(a){this.eventMouseWheel=a},DOMMouseScroll:function(a){this.mousewheel({wheelDeltaY:-40*a.detail})},isOverPixelPerfect:function(a){if(a.onRender&&a._visible){var b=f.offScreenContext,d=f.offScreenCanvas,e=f.camera;b.save();b.clearRect(0,0,d.width,d.height);
a.onRender(b,d,e.x,e.y);a=b.getImageData(this.x,this.y,1,1);return a.data[3]?a.data[0]||a.data[1]||a.data[2]?!0:!1:!1}},isOverPolygon:function(a){var b=f.camera,d=this.x+b.x,b=this.y+b.y;return a._rotation?(this._x=d,this._y=b,f.collisions.Polygon.haveCollided(a,this)):a.getBottom()<b||a.getTop()>b||a.getRight()<d||a.getLeft()>d?!1:!0},getHeight:function(){return 2},getWidth:function(){return 2},update:function(){this.fireEventOnLastSelectedObject();this.clear()},applyToObject:function(a){(a.onMouseOver||
a.onMouseIn||a.onMouseOut||a.onMouseWheel||a.onMouseDown&&this.down()||a.onMouseUp&&this.up()||a.onClick&&this.clicked())&&this.isOverPolygon(a)&&this.isOverPixelPerfect(a)&&this.select(a)}};f.browser.isFirefox?(k.prototype.mousemove=function(a){this.eventMouseMove=a;this.x=a.layerX-a.target.offsetLeft;this.y=a.layerY-a.target.offsetTop},k.prototype.click=function(a){this.events[a.button].click=a;this.x=a.layerX-a.target.offsetLeft;this.y=a.layerY-a.target.offsetTop}):k.prototype.mousemove=function(a){this.eventMouseMove=
a;this.x=a.offsetX;this.y=a.offsetY};f.setMouse(new k)})(window.Match);(function(f){function e(a){b.accelerate(a)}function d(){window.addEventListener("devicemotion",e,!1)}var b;d.prototype.accelerate=function(a){this._hasEvent=!0;this.accelerationIncludingGravity=a.accelerationIncludingGravity;this.acceleration=a.acceleration;this.rotationRate=a.rotationRate};d.prototype.update=function(){this._hasEvent=!1};d.prototype.applyToObject=function(a){if(this._hasEvent){if(a.onDeviceAccelerationIncludingGravity)a.onDeviceAccelerationIncludingGravity(this.accelerationIncludingGravity.x,
this.accelerationIncludingGravity.y,this.accelerationIncludingGravity.z,this.rotationRate);if(a.onDeviceAcceleration)a.onDeviceAcceleration(this.acceleration.x,this.acceleration.y,this.acceleration.z,this.rotationRate);if(a.onDeviceRotation)a.onDeviceRotation(this.rotationRate.alpha,this.rotationRate.beta,this.rotationRate.gamma)}};b=new d;f.setAccelerometer(b)})(window.Match);(function(f){function e(a){f.keyboard.fireDown(a)}function d(a){f.keyboard.fireUp(a)}function b(){document.addEventListener("keydown",e,!1);document.addEventListener("keyup",d,!1)}b.prototype={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",
122:"f11",123:"f12",145:"numlock",220:"pipe",keysDown:{length:0},keysUp:null,keysPressed:{},fireDown:function(a){a=this[a.which]||String.fromCharCode(a.which).toLowerCase();this.keysDown[a]=!0;void 0==this.keysPressed[a]&&(this.keysPressed[a]=!0);this.keysDown.length++},fireUp:function(a){a=this[a.which]||String.fromCharCode(a.which).toLowerCase();this.keysUp||(this.keysUp={});this.keysDown[a]=!1;this.keysPressed[a]=void 0;this.keysUp[a]=!0;0<this.keysDown.length&&this.keysDown.length--},update:function(){this.keysUp=
null;for(var a in this.keysPressed)!0==this.keysPressed[a]&&(this.keysPressed[a]=!1)},applyToObject:function(a){if(a.hasFocus){if(a.onKeyDown)a.onKeyDown(this.keysDown);if(a.onKeyUp)a.onKeyUp(this.keysUp);if(a.keyDownMappings&&0<this.keysDown.length)for(var b in a.keyDownMappings)if(this.keysDown[b])a[a.keyDownMappings[b]]();if(a.keyUpMappings&&this.keysUp)for(b in a.keyUpMappings)if(this.keysUp[b])a[a.keyUpMappings[b]]()}},getKeyCode:function(a){return a.charCodeAt(0)}};f.setKeyboard(new b)})(window.Match);(function(f){function e(a){s.start(a)}function d(a){s.end(a)}function b(a){s.move(a)}function a(){document.addEventListener("touchstart",e,!1);document.addEventListener("touchend",d,!1);document.addEventListener("touchmove",b,!1);this.y=this.x=0;this.isDragging=!1;this.events={start:null,end:null,move:null}}var s;a.prototype.clear=function(){this.events.end&&(this.events.start=null,this.y=this.x=0);this.events.end=null;this.force=this.events.move=null;this.isDragging||(this.selectedObject=null)};
a.prototype.update=function(){this.fireEventOnLastSelectedObject(this);this.clear()};a.prototype.getHeight=function(){return 2};a.prototype.getWidth=function(){return 2};a.prototype.applyToObject=function(a){!this.isDragging&&((a.onTouch||a.onTouchEnd||a.onTouchMove||a.onDrag)&&this.isOverPolygon(a)&&this.isOverPixelPerfect(a))&&(this.selectedObject=a)};a.prototype._setTouch=function(a){this.x=a.pageX-a.target.offsetLeft;this.y=a.pageY-a.target.offsetTop;this.force=a.force};a.prototype.start=function(a){a=
a.changedTouches;a.length&&(a=a[0],this._setTouch(a),this.events.start=a)};a.prototype.end=function(a){a=a.changedTouches;a.length&&(this.events.end=a[0],this.isDragging=!1,this.selectedObject=null)};a.prototype.move=function(a){a=a.changedTouches;a.length&&(a=a[0],this._setTouch(a),this.events.move=a)};a.prototype.started=function(){return this.events.start};a.prototype.moved=function(){return this.events.move};a.prototype.ended=function(){return this.events.end};a.prototype.fireEventOnLastSelectedObject=
function(){if(this.selectedObject){if(this.events.start){if(this.selectedObject.onTouch)this.selectedObject.onTouch(this);this.selectedObject.onDrag&&(this.isDragging=!0)}if(this.events.end&&this.selectedObject.onTouchEnd)this.selectedObject.onTouchEnd(this);if(this.events.move){if(this.selectedObject.onTouchMove)this.selectedObject.onTouchMove(this);if(this.isDragging)this.selectedObject.onDrag(this)}}};a.prototype.isOverPixelPerfect=function(a){if(a.onRender&&a._visible){var b=f.offScreenContext,
d=f.offScreenCanvas,e=f.camera;b.save();b.clearRect(0,0,d.width,d.height);a.onRender(b,d,e.x,e.y);a=b.getImageData(this.x,this.y,1,1);return a.data[3]?a.data[0]||a.data[1]||a.data[2]?!0:!1:!1}};a.prototype.isOverPolygon=function(a){var b=f.camera,d=this.x+b.x,b=this.y+b.y;return a._rotation?(this._x=d,this._y=b,f.collisions.Polygon.haveCollided(a,this)):a.getBottom()<b||a.getTop()>b||a.getRight()<d||a.getLeft()>d?!1:!0};s=new a;f.setTouch(s)})(window.Match);(function(f){function e(){}e.prototype.rgb=function(d,b,a){return"rgb("+[d,b,a].join()+")"};e.prototype.rgba=function(d,b,a,e){return"rgba("+[d,b,a,e].join()+")"};e.prototype.rgbToHex=function(d,b,a){return"#"+this.componentToHex(d)+this.componentToHex(b)+this.componentToHex(a)};e.prototype.componentToHex=function(d){d=d.toString(16);return 1==d.length?"0"+d:d};e.prototype.hexToRgb=function(d){d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);return this.rgb(parseInt(d[1],16),parseInt(d[2],16),
parseInt(d[3],16))};e.prototype.alpha=function(){return this.rgba(0,0,0,0)};e.prototype.random=function(){var d=window.Math;return this.rgb(d.round(255*d.random()),d.round(255*d.random()),d.round(255*d.random()))};f.color=new e})(window.Match);(function(f){function e(){this.math=window.Math}e.prototype.integer=function(d,b){return this.math.floor(this.math.random()*(b-d+1))+d};e.prototype.decimal=function(d,b){return this.math.random()*(b-d)+d};e.prototype.bool=function(){return 0.5>this.math.random()};e.prototype.sign=function(){return this.bool()?1:-1};e.prototype.booleanFromChance=function(d){return this.integer(0,100)<=d};e.prototype.color=function(){return f.color.random()};f.random=new e})(window.Match);(function(f){function e(){}f.postProcess||(f.postProcess={});e.prototype.run=function(d){return d.canvas};f.postProcess.NoPostProcess=e})(window.M);(function(f){function e(){}f.postProcess||(f.postProcess={});e.prototype.run=function(d){var b=d.getImageData(0,0,d.canvas.width,d.canvas.height),a=b.data,e=a.length,f,k,g,n;for(f=0;f<e;f+=4)k=a[f],g=a[f+1],n=a[f+2],k=0.2126*k+0.7152*g+0.0722*n,a[f]=a[f+1]=a[f+2]=k;d.putImageData(b,0,0);return d.canvas};f.postProcess.GrayScale=e})(window.M);
(function(f){function e(d){if(void 0==d)throw Error("Brightness has no constructor that takes no arguments. You must specify the brightness value");this.value=d}f.postProcess||(f.postProcess={});e.prototype.run=function(d){for(var b=d.getImageData(0,0,d.canvas.width,d.canvas.height),a=b.data,e=0;e<a.length;e+=4)a[e]+=this.value,a[e+1]+=this.value,a[e+2]+=this.value;d.putImageData(b,0,0);return d.canvas};f.postProcess.Brightness=e})(window.M);
(function(f){function e(d,b){this.matrix=d;this.opaque=b}f.postProcess||(f.postProcess={});e.prototype.setSharpen=function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]};e.prototype.setBlur=function(){this.matrix=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]};e.prototype.setContour=function(){this.matrix=[1,1,1,1,0.7,-1,-1,-1,-1]};e.prototype.run=function(d){if(this.matrix){var b=Math.round(Math.sqrt(this.matrix.length)),a=Math.floor(b/2),e=d.getImageData(0,0,d.canvas.width,d.canvas.height),f=e.data,k=e.width,g=
e.height,n=document.createElement("canvas").getContext("2d");n.canvas.width=e.width;n.canvas.height=e.height;for(var e=n.getImageData(0,0,e.width,e.height),n=e.data,m=this.opaque?1:0,h=0;h<g;h++)for(var u=0;u<k;u++){for(var r=h,y=u,z=4*(h*k+u),B=0,C=0,x=0,q=0,t=0;t<b;t++)for(var A=0;A<b;A++){var v=r+t-a,w=y+A-a;0<=v&&(v<g&&0<=w&&w<k)&&(v=4*(v*k+w),w=this.matrix[t*b+A],B+=f[v]*w,C+=f[v+1]*w,x+=f[v+2]*w,q+=f[v+3]*w)}n[z]=B;n[z+1]=C;n[z+2]=x;n[z+3]=q+m*(255-q)}d.putImageData(e,0,0);return d.canvas}};
f.postProcess.Convolute=e})(window.M);(function(f){function e(){this.postProcessing=new f.postProcess.NoPostProcess;this.buffer=document.createElement("canvas").getContext("2d");this.onRenderList=[];this.eventListener={needsRedraw:!0,needsSorting:!1};this.operation=this.scale=this.rotation=null;this.parrallaxFactor={x:1,y:1};this._onLoopAnimations=[];f.frontBuffer&&this.setSize(f.frontBuffer.canvas.width,f.frontBuffer.canvas.height)}e.prototype={_loopThroughAnimations:function(){for(var d=0,b=this._onLoopAnimations.length;d<b;d++)this._onLoopAnimations[d].onLoop()||
this._onLoopAnimations.splice(d,1)},setAlpha:function(d){this._alpha=d},getAlpha:function(){return this.alpha},fadeIn:function(d,b){this._onLoopAnimations.push(new f.effects.visual.FadeIn(this,d,b));return this},fadeOut:function(d,b){this._onLoopAnimations.push(new f.effects.visual.FadeOut(this,d,b));return this},continousFade:function(d,b,a,e){this._onLoopAnimations.push(new f.effects.visual.ContinousFade(this,d,b,a,e));return this},setBufferSize:function(d){if(!(d instanceof HTMLCanvasElement))throw Error("setBufferSize is expecting an HTMLCanvasElement as argument");
this.buffer.canvas.width=d.width;this.buffer.canvas.height=d.height},setAntialiasing:function(d){this.buffer.mozImageSmoothingEnabled=d;this.buffer.webkitImageSmoothingEnabled=d;this.buffer.mozImageSmoothingEnabled=d;this.buffer.webkitImageSmoothingEnabled=d},getWidth:function(){return this.buffer.canvas.width},getHeight:function(){return this.buffer.canvas.height},setWidth:function(d){this.buffer.canvas.width=d},setHeight:function(d){this.buffer.canvas.height=d},setSize:function(d,b){this.setWidth(d);
this.setHeight(b)},getCenter:function(){return new f.math2d.Vector2d(this.buffer.canvas.width/2,this.buffer.canvas.height/2)},onLoop:function(d){var b=d.camera.x*this.parrallaxFactor.x,a=d.camera.y*this.parrallaxFactor.y,e=b+d.camera.viewportWidth,f=a+d.camera.viewportHeight,k=this.buffer,g=k.canvas,n;d.debug&&(n=(new Date).getTime());this.eventListener.needsRedraw&&(this.clearColor?(k.fillStyle=this.clearColor,k.fillRect(0,0,g.width,g.height)):k.clearRect(0,0,g.width,g.height),this.renderGameObjects(this.onRenderList,
k,g,b,a,e,f),this.eventListener.needsRedraw=!1);this.eventListener.needsSorting&&(this.sort(),this.eventListener.needsSorting=!1);this._loopThroughAnimations();d.debug&&(this._loopTime=(new Date).getTime()-n);return this.postProcessing.run(k)},renderGameObjects:function(d,b,a,e,f,k,g){for(var n in d){var m=d[n];m.isVisible(e,f,k,g)&&(m.onRender(b,a,e,f,k,g),m.children&&this.renderGameObjects(m.children,b,a,e,f,k,g))}},addToGame:function(){f.pushGameLayer(this)},push:function(d,b,a){if(!d)throw Error("Cannot add null object to rendering loop");
d instanceof Function&&(d={onRender:d,isVisible:function(){return this.onChangeEvent.needsRedraw=!0},setZIndex:function(a){this._zIndex=a}});if(d.onRender){b&&(d.key=b);if(void 0==d._zIndex){if(-1<a)try{d.setZIndex(a||0)}catch(e){d._zIndex=a||0}}else d.setZIndex(d.getZIndex());if(d.onLoad)d.onLoad();this.eventListener.needsSorting=!0;d.onChangeEvent=this.eventListener;this.onRenderList.push(d);d.onLoop&&f.pushGameObject(d);b=f.camera;a=b.x*this.parrallaxFactor.x;var p=b.y*this.parrallaxFactor.y;d.isVisible(a,
p,a+b.viewportWidth,p+b.viewportHeight)&&(this.eventListener.needsRedraw=!0)}else console.warn("Cannot add object with no onRender method ",d.constructor.name,"adding to Match list of Game Objects"),f.pushGameObject(d)},sort:function(){this.onRenderList.sort(this._sortFunction)},_sortFunction:function(d,b){return d._zIndex-b._zIndex},getFirst:function(){return this.getIndex(0)},getIndex:function(d){try{return this.onRenderList[d]}catch(b){return null}},get:function(d){if(this.cache&&this.cache.key==
d)return this.cache;for(var b=this.onRenderList.length,a;b--;)if(a=this.onRenderList[b],d==a.key)return this.cache=a;return null},getLast:function(){return this.getIndex(this.onRenderList.length-1)},isOnRenderList:function(d){return-1!=this.onRenderList.indexOf(d)},remove:function(d){if(void 0!=d){if("string"==typeof d)this.remove(this.get(d));else if(isNaN(d)){var b=this.onRenderList.indexOf(d);-1!=b&&this.onRenderList.splice(b,1)}else this.onRenderList.splice(d,1);d.onLoop&&f.removeGameObject(d);
this._needsRedraw=!0}},removeAll:function(){this.onRenderList=[]},setBackground:function(d){this.buffer.canvas.style.setProperty("background",d,null)},getBackground:function(){return this.buffer.canvas.getPropertyValue("background")}};f.GameLayer=f.Layer=e})(window.Match);(function(f,e){function d(){this.total=this.toLoad=0;this.onImageLoaded=new e;this.onAllImagesLoaded=new e;this.onImageError=new e}function b(){f.sprites._imageError(this)}function a(){f.sprites._imageLoaded(this)}d.prototype._imageLoaded=function(a){this.toLoad--;if(a.frames)if(a.frames instanceof Array)for(var b in a.frames)a.frames[b].halfWidth=a.frames[b].width/2,a.frames[b].halfHeight=a.frames[b].height/2;else{b=[];var d=a.frames.width,e=a.frames.height,f=a.frames.padding||0,m=Math.floor(a.width/
(d+f)),h=Math.floor(a.height/(e+f)),u,r;for(r=0;r<h;r++)for(u=0;u<m;u++)b.push({x:(f+d)*u+f,y:(f+e)*r+f,width:d,height:e,halfWidth:d/2,halfHeight:e/2});a.frames=b}else a.frames=[{x:0,y:0,width:a.width,height:a.height,halfWidth:a.width/2,halfHeight:a.height/2}];this.onImageLoaded.raise({image:a,remaining:this.toLoad,total:this.total});0>=this.toLoad&&this.onAllImagesLoaded.raise()};d.prototype._imageError=function(a){this.toLoad--;this.onImageError.raise(a);console.error("Could not load",a.src)};d.prototype.load=
function(d){var e,f,g;d.onProgress&&(this.onImageLoaded.addEventListener(d.onProgress),delete d.onProgress);d.onFinish&&(this.onAllImagesLoaded.addEventListener(d.onFinish),delete d.onFinish);for(g in d)e=d[g],f=new Image,f.onload=a,f.onerror=b,this.total=++this.toLoad,"string"==typeof e?f.src=e:(f.src=e.source,f.frames=e.frames,f.animations=e.animations),this[g]=f};d.prototype.remove=function(a){this[a]instanceof Image&&(delete this[a],0<=this.total-1&&this.total--,0<=this.toLoad-1&&this.toLoad--)};
d.prototype.removeAll=function(){for(var a in this)this.remove(a)};d.prototype.removeAllEventListeners=function(){this.onImageLoaded=new e;this.onAllImagesLoaded=new e;this.onImageError=new e};f.SpriteManager=new d;f.sprites=f.SpriteManager})(M||(M={}),M.EventListener||(M.EventListener={}));(function(f){function e(){f.sounds[this.name].setReady();f.sounds.toLoad--;0>=f.sounds.toLoad&&f.sounds.onAllSoundsLoaded.raise()}function d(){console.warn("Unable to load "+this.src);f.sounds.error=!0;f.sounds[this.name].setNotReady();f.sounds.toLoad--;0>=f.sounds.toLoad&&f.sounds.onAllSoundsLoaded.raise()}function b(a,b){this.audioBuffer=[];this.src=b;this.name=a;this.increaseBuffer()}function a(){this.total=this.toLoad=0;this.onSoundLoaded=new f.EventListener;this.onAllSoundsLoaded=new f.EventListener;
this.onSoundError=new f.EventListener;this.error=!1}b.prototype.MAX_BUFFER=3;b.prototype.setReady=function(){this.canPlay=this.checkOk;1==this.audioBuffer.length&&f.sounds.onSoundLoaded.raise({sound:this,remaining:f.sounds.toLoad,total:f.sounds.total})};b.prototype.setNotReady=function(){this.canPlay=this.checkOk;f.sounds.onSoundError.raise({sound:this,remaining:f.sounds.toLoad,total:f.sounds.total})};b.prototype.play=function(){if(this.canPlay()){for(var a=0,b;a<this.audioBuffer.length;){b=this.audioBuffer[a];
if(b.ended||0==b.currentTime){b.play();return}a++}b=this.audioBuffer[0];b.pause();b.currentTime=0;b.play();this.audioBuffer.length<this.MAX_BUFFER&&this.increaseBuffer()}};b.prototype.stop=function(){this.canPlay()&&this.each(function(a){0<a.duration&&(a.pause(),a.currentTime=0)})};b.prototype.pause=function(){this.canPlay()&&(this.onNextPauseResume?(this.play(),this.onNextPauseResume=!1):(this.onNextPauseResume=this.isPlaying(),this.each(function(a){a.pause()})))};b.prototype.checkFail=function(){return!1};
b.prototype.checkOk=function(){return!0};b.prototype.canPlay=function(){this.increaseBuffer();return!1};b.prototype.setPlaybackRate=function(a){this.each(function(b){b.playbackRate=a})};b.prototype.resetPlaybackRate=function(){this.each(function(a){a.playbackRate=1})};b.prototype.getPlaybackRate=function(){return this.audioBuffer[0].playbackRate};b.prototype.isPaused=function(){var a=0;for(l=this.audioBuffer.length;a<l;a++)if(this.audioBuffer[a].paused)return!0;return!1};b.prototype.setVolume=function(a){this.each(function(b){b.volume=
a})};b.prototype.isPlaying=function(){var a=0;for(l=this.audioBuffer.length;a<l;a++)if(!this.audioBuffer[a].paused)return!0;return!1};b.prototype.each=function(a){for(var b=this.audioBuffer.length;b--;)a(this.audioBuffer[b])};b.prototype.increaseBuffer=function(){var a=new Audio(this.src),b=this.audioBuffer[0];a.addEventListener("loadeddata",e);a.addEventListener("error",d);a.name=this.name;b&&(a.muted=b.muted,a.volume=b.volume);this.audioBuffer.push(a)};b.prototype.mute=function(){this.each(function(a){a.muted=
!a.muted})};b.prototype.setLoop=function(a){this.audioBuffer[0].loop=a};var s=function(){};fakeSound={name:""};for(var p in b.prototype)"function"==typeof b.prototype[p]&&(fakeSound[p]=s);a.prototype.load=function(){if(1<arguments.length)this.loadOne(arguments[0],arguments[1]);else{var a=arguments[0];a.onProgress&&(this.onSoundLoaded.addEventListener(a.onProgress),delete a.onProgress);a.onFinish&&(this.onAllSoundsLoaded.addEventListener(a.onFinish),delete a.onFinish);for(var b in a)this.loadOne(b,
a[b])}};a.prototype.loadOne=function(a,d){this.total=++this.toLoad;void 0==f.browser.supportedAudioFormat?(this[a]=fakeSound,fakeSound.name=a,this.onSoundLoaded.raise({sound:fakeSound,remaining:f.sounds.toLoad--,total:f.sounds.total}),0>=this.toLoad&&this.onAllSoundsLoaded.raise()):("."!=d.charAt(d.length-4)&&(d+=f.browser.supportedAudioFormat),this[a]=new b(a,d));this[a].name=a};a.prototype.pause=function(){for(var a in this)this[a]instanceof b&&this[a].pause()};a.prototype.setVolume=function(a){for(var d in this)this[d]instanceof
b&&this[d].setVolume(a)};a.prototype.mute=function(){for(var a in this)this[a]instanceof b&&this[a].mute()};a.prototype.stop=function(){for(var a in this)this[a]instanceof b&&this[a].stop()};a.prototype.removeAll=function(){for(var a in this)delete this[a];this.audioBuffer=[];this.src=url;this.name=name;this.increaseBuffer()};f.SoundManager=f.sounds=new a})(window.Match);(function(f){function e(b){this._halfHeight=this._halfWidth=this._height=this._width=this._y=this._x=0;this._scale=this._rotation=null;this._visible=!0;this.operation=null;this._onLoopAnimations=[];this._onLoopTimers=[];this.onChangeEvent={};this.set(b)}function d(b,a,d,e){this.width=d-b;this.height=e-a;this._x=b+this.width/2;this._y=a+this.height/2}e.prototype.removeChild=function(b){delete this.children[b]};e.prototype.putChild=function(b,a){this.children||(this.children={});this.children[b]=a};
e.prototype._zIndex=0;e.prototype.onLoop=function(b){this._loopThroughAnimations();this._loopThroughTimers();if(this.onUpdate)this.onUpdate(b)};e.prototype.set=function(b){if(b){var a="",d;for(d in b)if(a="set"+d.charAt(0).toUpperCase()+d.substr(1),this[a])this[a](b[d]);else this[d]=b[d]}};e.prototype.setAlpha=function(b){this._alpha=b;this.onChangeEvent.needsRedraw=!0};e.prototype.getAlpha=function(){return this._alpha};e.prototype._loopThroughAnimations=function(){for(var b=0,a=this._onLoopAnimations.length;b<
a;b++)this._onLoopAnimations[b].onLoop()||this._onLoopAnimations.splice(b,1)};e.prototype.fadeIn=function(b,a){this._onLoopAnimations.push(new f.effects.visual.FadeIn(this,b,a));return this};e.prototype.fadeOut=function(b,a){this._onLoopAnimations.push(new f.effects.visual.FadeOut(this,b,a));return this};e.prototype.continousFade=function(b,a,d,e){this._onLoopAnimations.push(new f.effects.visual.ContinousFade(this,b,a,d,e));return this};e.prototype.move=function(b,a,d,e){this._onLoopAnimations.push(new f.effects.visual.Move(this,
b,a,d,e));return this};e.prototype.scaleUp=function(b,a,d,e){this._onLoopAnimations.push(new f.effects.visual.ScaleUp(this,b,a,d,e));return this};e.prototype.scaleDown=function(b,a,d,e){this._onLoopAnimations.push(new f.effects.visual.ScaleDown(this,b,a,d,e));return this};e.prototype.twinkle=function(b,a,d){this._onLoopAnimations.push(new f.effects.visual.Twinkle(this,b,a,d));return this};e.prototype.rotate=function(b,a,d){this._onLoopAnimations.push(new f.effects.visual.Rotate(this,b,a,d));return this};
e.prototype._loopThroughTimers=function(){for(var b=0,a=this._onLoopTimers.length;b<a;b++)this._onLoopTimers[b].onLoop()};e.prototype.addTimer=function(b,a){var d=new f.Timer(b,a,this);this._onLoopTimers.push(d);return d};e.prototype.removeTimer=function(b){this._onLoopTimers.splice(this._onLoopTimers.indexOf(this._getTimer(b)),1);return this};e.prototype._getTimer=function(b){for(var a=0,d=this._onLoopTimers.length;a<d;a++)if(this._onLoopTimers[a].callback==b)return this._onLoopTimers[a]};e.prototype.setZIndex=
function(b){this._zIndex=b;this.onChangeEvent.needsRedraw=!0;this.onChangeEvent.needsSorting=!0};e.prototype.getZIndex=function(){return this._zIndex};e.prototype.setVisible=function(b){this._visible=b;this.onChangeEvent.needsRedraw=!0};e.prototype.setWidth=function(b){this._width=b;this._halfWidth=b/2;this.onChangeEvent.needsRedraw=!0};e.prototype.setHeight=function(b){this._height=b;this._halfHeight=b/2;this.onChangeEvent.needsRedraw=!0};e.prototype.getWidth=function(){return this._scale?this._width*
this._scale.x:this._width};e.prototype.getHeight=function(){return this._scale?this._height*this._scale.y:this._height};e.prototype.setSize=function(b,a){this.setWidth(b);this.setHeight(a)};e.prototype.getSize=function(){return{width:this.getWidth(),height:this.getHeight()}};e.prototype.setScale=function(b,a){if(b||a)b||(b=1),a||(a=1),this._scale={x:b,y:a},this.onChangeEvent.needsRedraw=!0};e.prototype.setScaleX=function(b){this._scale||(this._scale={},this._scale.y=1);this._scale.x=b;this.onChangeEvent.needsRedraw=
!0};e.prototype.setScaleY=function(b){this._scale||(this._scale={},this._scale.x=1);this._scale.y=b;this.onChangeEvent.needsRedraw=!0};e.prototype.mirror=function(){this.invertX()};e.prototype.invertX=function(){this._scale||(this._scale={},this._scale.x=1,this._scale.y=1);this._scale.x*=-1;this.onChangeEvent.needsRedraw=!0};e.prototype.invertY=function(){this._scale||(this._scale={},this._scale.x=1,this._scale.y=1);this._scale.y=-1;this.onChangeEvent.needsRedraw=!0};e.prototype.getLeft=function(){return this._scale?
void 0!=this.pivotX?this._x+this.pivotX-this._width*this._scale.x:this._x-this._halfWidth*this._scale.x:void 0!=this.pivotX?this._x+this.pivotX-this._width:this._x-this._halfWidth};e.prototype.getRight=function(){return this._scale?void 0!=this.pivotX?this._x+this.pivotX+this._width*this._scale.x:this._x+this._halfWidth*this._scale.x:void 0!=this.pivotX?this._x+this.pivotX+this._width:this._x+this._halfWidth};e.prototype.getTop=function(){return this._scale?void 0!=this.pivotY?this._y+this.pivotY-
this._height*this._scale.y:this._y-this._halfHeight*this._scale.y:void 0!=this.pivotY?this._y+this.pivotY-this._height:this._y-this._halfHeight};e.prototype.getBottom=function(){return this._scale?void 0!=this.pivotY?this._y+this.pivotY+this._height*this._scale.y:this._y+this._halfHeight*this._scale.y:void 0!=this.pivotY?this._y+this.pivotY+this._height:this._y+this._halfHeight};e.prototype.setLeft=function(b){this._x=this._scale?b+this._halfWidth*this._scale.x:b+this._halfWidth;this.onChangeEvent.needsRedraw=
!0};e.prototype.setRight=function(b){this._x=this._scale?b-this._halfWidth*this._scale.x:b-this._halfWidth;this.onChangeEvent.needsRedraw=!0};e.prototype.setTop=function(b){this._y=this._scale?b+this._halfHeight*this._scale.y:b+this._halfHeight;this.onChangeEvent.needsRedraw=!0};e.prototype.setBottom=function(b){this._y=this._scale?b-this._halfHeight*this._scale.y:b-this._halfHeight;this.onChangeEvent.needsRedraw=!0};e.prototype.getLocation=function(){return{x:this._x,y:this._y}};e.prototype.setLocation=
function(b,a){this.prevX=this._x;this.prevY=this._y;this._x=b;this._y=a;this.onChangeEvent.needsRedraw=!0};e.prototype._applyOperation=function(b){this.operation&&(b.globalCompositeOperation=this.operation)};e.prototype._applyAlpha=function(b){0<=this._alpha&&1>=this._alpha&&(b.globalAlpha=this._alpha)};e.prototype._applyTranslation=function(b,a,d){b.translate(this._x-a,this._y-d)};e.prototype._applyRotation=function(b){this._rotation&&b.rotate(this._rotation)};e.prototype._applyScale=function(b){this._scale&&
b.scale(this._scale.x,this._scale.y)};e.prototype._applyShadow=function(b){this._shadow&&(b.shadowColor=this._shadow.color,b.shadowBlur=this._shadow.blur,b.shadowOffsetX=this._shadow.offsetX,b.shadowOffsetY=this._shadow.offsetY)};e.prototype.offsetAlpha=function(b){this._alpha+=b;this.onChangeEvent.needsRedraw=!0};e.prototype.offsetRotation=function(b){this._rotation+=b;this.onChangeEvent.needsRedraw=!0};e.prototype.isVisible=function(b,a,d,e){return this._visible?this.isIn(b,a,d,e):!1};e.prototype.isIn=
function(b,a,e,p){return this._rotation?f.collisions.Polygon.haveCollided(this,new d(b,a,e,p)):this.getBottom()<a||this.getTop()>p||this.getRight()<b||this.getLeft()>e?!1:!0};e.prototype.setRotation=function(b){this._rotation=b;this.onChangeEvent.needsRedraw=!0};e.prototype.getRotation=function(){return this._rotation};e.prototype.setX=function(b){this.prevX=this._x;this._x=b;this.onChangeEvent.needsRedraw=!0};e.prototype.setY=function(b){this.prevY=this._y;this._y=b;this.onChangeEvent.needsRedraw=
!0};e.prototype.offset=function(b,a){this._x+=b;this._y+=a;this.onChangeEvent.needsRedraw=!0};e.prototype.offsetX=function(b){this._x+=b;this.onChangeEvent.needsRedraw=!0};e.prototype.offsetY=function(b){this._y+=b;this.onChangeEvent.needsRedraw=!0};e.prototype.getX=function(){return this._x};e.prototype.getY=function(){return this._y};e.prototype.onRender=function(){throw Error("Method onRender must be overriden");};e.prototype.getMaxSize=function(){return Math.max(this.getWidth(),this.getHeight())};
f.renderers=f.renderers||{};f.renderers.Renderizable=e;d.prototype.getWidth=function(){return this.width};d.prototype.getHeight=function(){return this.height}})(window.M);(function(f,e,d){function b(a){d.apply(this);a&&this.setImage(a)}b.prototype.setImage=function(a,b){if(!a)throw Error("Image cannot be null");if(a instanceof Image)a.frames||(a.frames=[{x:0,y:0,width:a.width,height:a.height,halfWidth:a.width/2,halfHeight:a.height/2}]),this._image=a;else if(e.sprites[a])this._image=e.sprites[a];else throw Error("Image by id "+a+" not loaded");this.setFrameIndex(b)};b.prototype.play=function(a,b){if(!this._animation||this.animationName!=a||!this.isPlaying){if(a||!this._animation){if(!this._image)throw Error("No image selected");
if(!this._image.animations)throw Error("Image has no animations");if(!this._image.animations[a])throw Error("Image has no animation by name "+a);this._animation=this._image.animations[a];this.animationName=a;this._frameIndex=0}this.isPlaying=!0;this.loop=b;this.onChangeEvent.needsRedraw=!0}};b.prototype.stop=function(){this.isPlaying=!1};b.prototype._animate=function(){if(this.isPlaying){var a=e.getTime();this.currentFrameStartInMillis||(this.currentFrameStartInMillis=a);a-this.currentFrameStartInMillis>
this._animation.duration&&(this.currentFrame=this._image.frames[this._animation.frames[this._frameIndex]],this._frameIndex<this._animation.frames.length-1?this._frameIndex++:this.loop?this._frameIndex=0==this._frameIndex?1:0:this.isPlaying=!1,this.currentFrameStartInMillis=a,this.onChangeEvent.needsRedraw=!0)}};b.prototype.isLastAnimationFrame=function(){return this._animation?this._frameIndex==this._animation.frames.length-1:!1};b.prototype.isFirstAnimationFrame=function(){return this._animation?
1==this._frameIndex:!1};b.prototype.onLoop=function(a){this._loopThroughAnimations();this._loopThroughTimers();if(this.onUpdate)this.onUpdate(a);this._animate()};b.prototype.onRender=function(a,b,d,e){this._image&&(a.save(),this._applyOperation(a),this._applyAlpha(a),this._applyTranslation(a,d,e),this._applyRotation(a),this._applyScale(a),this._applyShadow(a),a.drawImage(this._image,this.currentFrame.x,this.currentFrame.y,this.currentFrame.width,this.currentFrame.height,this.pivotX?this.pivotX:-this.currentFrame.halfWidth,
this.pivotY?this.pivotY:-this.currentFrame.halfHeight,this.oW||this.currentFrame.width,this.oH||this.currentFrame.height),a.restore())};b.prototype.setSize=function(a,b){this.oW=a;this.oH=b;this.onChangeEvent.needsRedraw=!0};b.prototype.setFrameIndex=function(a){this._frameIndex=a=a||0;this.currentFrame=this._image.frames[a]};b.prototype.getTop=function(){return this._scale?this._y-this.currentFrame.halfHeight*this._scale.y:this._y-this.currentFrame.halfHeight};b.prototype.getBottom=function(){return this._scale?
this._y+this.currentFrame.halfHeight*this._scale.y:this._y+this.currentFrame.halfHeight};b.prototype.getLeft=function(){return this._scale?this._x-this.currentFrame.halfWidth*this._scale.x:this._x-this.currentFrame.halfWidth};b.prototype.getRight=function(){return this._scale?this._x+this.currentFrame.halfWidth*this._scale.x:this._x+this.currentFrame.halfWidth};b.prototype.getWidth=function(){return this._scale?this.currentFrame.width*this._scale.x:this.currentFrame.width};b.prototype.getHeight=function(){return this._scale?
this.currentFrame.height*this._scale.y:this.currentFrame.height};b.prototype.setLeft=function(a){this._x=this._scale?a+this.currentFrame.halfWidth*this._scale.x:a+this.currentFrame.halfWidth;this.onChangeEvent.needsRedraw=!0};b.prototype.setRight=function(a){this._x=this._scale?a-this.currentFrame.halfWidth*this._scale.x:a-this.currentFrame.halfWidth;this.onChangeEvent.needsRedraw=!0};b.prototype.setTop=function(a){this._y=this._scale?a+this.currentFrame.halfHeight*this._scale.y:a+this.currentFrame.halfHeight;
this.onChangeEvent.needsRedraw=!0};b.prototype.setBottom=function(a){this._y=this._scale?a-this.currentFrame.halfHeight*this._scale.y:a-this.currentFrame.halfHeight;this.onChangeEvent.needsRedraw=!0};e.extend(b,d);f.Sprite=b})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(f,e,d){function b(a){d.apply(this,arguments);this._fillStyle="black";this._lineWidth=this._strokeStyle=null;this.set(a)}b.prototype.css=function(a){a=e.getStyleBySelector(a);""!=a.color&&this.setFillStyle(a.color);""!=a.backgroundColor&&this.setFillStyle(a.backgroundColor);""!=a.borderColor&&this.setStrokeStyle(a.borderColor);""!=a.borderWidth&&this.setLineWidth(a.borderWidth);""!=a.width&&this.setWidth(a.width);""!=a.height&&this.setHeight(a.height);""!=a.left&&this.setLeft(a.left);""!=
a.right&&this.setRight(a.right);""!=a.top&&this.setTop(a.top);""!=a.bottom&&this.setBottom(a.bottom);if(""!=a.boxShadow){var b,d,f,g;-1<a.boxShadow.indexOf("rgb")?b=a.boxShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0]:a.boxShadow.indexOf("px")>a.boxShadow.indexOf(" ")&&(b=a.boxShadow.substr(0,a.boxShadow.indexOf(" ")));if(a=a.boxShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/))d=parseInt(a[1]),f=parseInt(a[2]),g=parseInt(a[3]);this.setShadow(d,f,b,g)}};b.prototype.setFillStyle=function(a){this._fillStyle=
a;this._changed=!0};b.prototype.setStrokeStyle=function(a){this._strokeStyle=a;this._changed=!0};b.prototype.setStrokeWidth=function(a){this._lineWidth=a;this._changed=!0};b.prototype.setShadow=function(a,b,d,e){this._shadow={x:a,y:b,color:d||"black",blur:e||1};this._changed=!0};b.prototype.getFillStyle=function(){return this._fillStyle};b.prototype.getStrokeStyle=function(){return this._strokeStyle};b.prototype.getStrokeWidth=function(){return this._lineWidth};b.prototype.getShadow=function(){return this._shadow};
b.prototype.onRender=function(a,b,d,e){a.save();this._applyOperation(a);this._applyAlpha(a);this._applyTranslation(a,d,e);this._applyRotation(a);this._applyScale(a);this._fillStyle&&(a.fillStyle=this._fillStyle,a.fillRect(-this._halfWidth,-this._halfHeight,this._width,this._height));this._applyShadow(a);this._lineWidth&&(a.lineWidth=this._lineWidth);this._strokeStyle&&(a.strokeStyle=this._strokeStyle,a.strokeRect(-this._halfWidth,-this._halfHeight,this._width,this._height));a.restore()};e.extend(b,
d);f.Rectangle=b})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(f,e,d){function b(a){d.apply(this,arguments);this._fillStyle="rgb(0,0,0)";this._lineWidth=this._strokeStyle=null;this._radius=1;this._startAngle=0;this._endAngle=6.28;this.set(a)}b.prototype.css=function(a){a=e.getStyleBySelector(a);""!=a.color&&this.setFillStyle(a.color);""!=a.backgroundColor&&this.setFillStyle(a.backgroundColor);""!=a.borderColor&&this.setStrokeStyle(a.borderColor);""!=a.borderWidth&&this.setLineWidth(a.borderWidth);""!=a.width&&this.setRadius(a.width);""!=a.height&&this.setRadius(a.height);
""!=a.left&&this.setLeft(a.left);""!=a.right&&this.setRight(a.right);""!=a.top&&this.setTop(a.top);""!=a.bottom&&this.setBottom(a.bottom);if(""!=a.boxShadow){var b,d,f,g;-1<a.boxShadow.indexOf("rgb")?b=a.boxShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0]:a.boxShadow.indexOf("px")>a.boxShadow.indexOf(" ")&&(b=a.boxShadow.substr(0,a.boxShadow.indexOf(" ")));if(a=a.boxShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/))d=parseInt(a[1]),f=parseInt(a[2]),g=parseInt(a[3]);this.setShadow(d,f,b,g)}};
b.prototype.setStrokeStyle=function(a){this._strokeStyle=a;this._changed=!0};b.prototype.getStrokeStyle=function(){return this._strokeStyle};b.prototype.setFillStyle=function(a){this._fillStyle=a;this._changed=!0};b.prototype.getFillStyle=function(){return this._fillStyle};b.prototype.setStrokeWidth=function(a){this._lineWidth=a;this._changed=!0};b.prototype.getStrokeWidth=function(){return this._lineWidth};b.prototype.setRadius=function(a){this._radius=a;this._changed=!0};b.prototype.setShadow=function(a,
b,d,e){this._shadow={x:a,y:b,color:d||"black",blur:e||1};this._changed=!0};b.prototype.getShadow=function(){return this._shadow};b.prototype.getRadius=function(){return this._radius};b.prototype.isMouseOver=function(a){a||(a=e.onLoopProperties);return e.Math2d.getDistance({x:this._x,y:this._y},a.mouse)<=this._radius};b.prototype.getWidth=function(){return this._scale?this._radius*this._scale.x:this._radius};b.prototype.getHeight=function(){return this._scale?this._radius*this._scale.y:this._radius};
b.prototype.getLeft=function(){return this._scale?this._x-this._radius*this._scale.x:this._x-this._radius};b.prototype.getRight=function(){return this._scale?this._x+this._radius*this._scale.x:this._x+this._radius};b.prototype.getTop=function(){return this._scale?this._y-this._radius*this._scale.y:this._y-this._radius};b.prototype.getBottom=function(){return this._scale?this._y+this._radius*this._scale.y:this._y+this._radius};b.prototype.setLeft=function(a){this._x=this._scale?a+this._radius*this._scale.x:
a+this._radius;this._changed=!0};b.prototype.setRight=function(a){this._x=this._scale?a-this._radius*this._scale.x:a-this._radius;this._changed=!0};b.prototype.setTop=function(a){this._y=this._scale?a+this._radius*this._scale.y:a+this._radius;this._changed=!0};b.prototype.setBottom=function(a){this._y=this._scale?a-this._radius*this._scale.y:a-this._radius;this._changed=!0};b.prototype.onRender=function(a,b,d,e){a.save();this._applyOperation(a);this._applyAlpha(a);this._applyTranslation(a,d,e);this._applyRotation(a);
this._applyScale(a);a.beginPath();a.arc(0,0,this._radius,this._startAngle,this._endAngle,!1);a.closePath();this._fillStyle&&(a.fillStyle=this._fillStyle,a.fill());this._shadow&&(a.shadowColor=this._shadow.color,a.shadowBlur=this._shadow.blur,a.shadowOffsetX=this._shadow.x,a.shadowOffsetY=this._shadow.y);this._lineWidth&&(a.lineWidth=this._lineWidth);this._strokeStyle&&(a.strokeStyle=this._strokeStyle,a.stroke(-this._halfWidth,-this._halfHeight,this._width,this._height));a.restore();this._zIndexchanged=
this._changed=!1};e.extend(b,d);f.Circle=b})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(f,e,d){function b(a){d.apply(this,arguments);this._weight=this._variant=this._style="";this._size="14px";this._family="Calibri, Verdana, Arial, Monospace";this._textAlign="center";this._textBaseline="middle";this._text="";this.set(a)}b.prototype.onRender=function(a,b,d,e){a.save();this._applyShadow(a);this._applyAlpha(a);this._applyTranslation(a,d,e);this._applyRotation(a);this._applyScale(a);a.font=this._style+this._variant+this._weight+this._size+this._family;a.textAlign=this._textAlign;
a.textBaseline=this._textBaseline;a.fillStyle=this._fillStyle;if(this.multiLine)for(b=0;b<this.multiLine.length;b++)a.fillText(this.multiLine[b],0,b*this.getHeight());else a.fillText(this._text,0,0);this._strokeStyle&&(a.strokeStyle=this._strokeStyle,a.lineWidth=this._lineWidth||1,a.strokeText(this._text,0,0));a.restore()};b.prototype.getRight=function(){return this._x+this.getWidth()};b.prototype.getBottom=function(){return this._y+this.getHeight()};b.prototype.getHeight=function(){if(this._text==
this._cachedText2)return this._height;var a=document.createElement("span"),b;a.font=this._style+this._variant+this._weight+this._size+this._family;a.textContent=this._text;document.body.appendChild(a);b=a.offsetHeight;document.body.removeChild(a);this._height=b;this._cachedText2=this._text;return b};b.prototype.setAlignment=function(a,b){this.setHorizontalAlign(a);this.setVerticalAlign(b)};b.prototype.setHorizontalAlign=function(a){this._textAlign=a;this.onChangeEvent.needsRedraw=!0};b.prototype.setVerticalAlign=
function(a){this._textBaseline=a;this.onChangeEvent.needsRedraw=!0};b.prototype.getWidth=function(){if(this._text==this._cachedText)return this._width;var a,b=e.offScreenContext;b.save();b.font=this._family;b.fillStyle=this._fillStyle;a=b.measureText(this._text).width;b.restore();this._width=a;this._cachedText=this._text;return a};b.prototype.setFamily=function(a){this._family=a;this.onChangeEvent.needsRedraw=!0};b.prototype.setSize=function(a){this._size=parseInt(a)+"px ";this.onChangeEvent.needsRedraw=
!0};b.prototype.setWeight=function(a){this._weight=a+" ";this.onChangeEvent.needsRedraw=!0};b.prototype.setVariant=function(a){this._variant=a+" ";this.onChangeEvent.needsRedraw=!0};b.prototype.setStyle=function(a){this._style=a+" ";this.onChangeEvent.needsRedraw=!0};b.prototype.setFillStyle=function(a){this._fillStyle=a;this.onChangeEvent.needsRedraw=!0};b.prototype.css=function(a){a=e.getStyleBySelector(a);""!=a.color&&this.setFillStyle(a.color);""!=a.fontFamily&&this.setFamily(a.fontFamily);""!=
a.fontSize&&this.setSize(a.fontSize);""!=a.fontStyle&&this.setStyle(a.fontStyle);""!=a.fontVariant&&this.setVariant(a.fontVariant);""!=a.fontWeight&&this.setWeight(a.fontWeight);""!=a.left&&this.setLeft(a.left);""!=a.right&&this.setRight(a.right);""!=a.top&&this.setTop(a.top);""!=a.bottom&&this.setBottom(a.bottom);if(""!=a.textShadow){var b,d,f,g;-1<a.textShadow.indexOf("rgb")?b=a.textShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0]:a.textShadow.indexOf("px")>a.textShadow.indexOf(" ")&&(b=
a.textShadow.substr(0,a.textShadow.indexOf(" ")));if(a=a.textShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/))d=parseInt(a[1]),f=parseInt(a[2]),g=parseInt(a[3]);this.setShadow(d,f,b,g)}};b.prototype.getSize=function(a){return this._size};b.prototype.getWeight=function(a){return this._weight};b.prototype.getVariant=function(a){return this._variant};b.prototype.getStyle=function(a){return this._style};b.prototype.setStrokeStyle=function(a){this._strokeStyle=a;this.onChangeEvent.needsRedraw=!0};b.prototype.setStrokeWidth=
function(a){this._lineWidth=a;this._changed=!0};b.prototype.getStrokeWidth=function(){return this._lineWidth};b.prototype.setText=function(a,b){b&&(this.multiLine=a.split("\n"));this._text=a;this.onChangeEvent.needsRedraw=!0};b.prototype.getFamily=function(a){return this._family};b.prototype.getFillStyle=function(a){return this._fillStyle};b.prototype.getStrokeStyle=function(a){return this._strokeStyle};b.prototype.getText=function(){return this._text};b.prototype.setShadow=function(a,b,d,e){this._shadow=
{x:a,y:b,color:d||"black",blur:e||1};this.onChangeEvent.needsRedraw=!0};b.prototype.getShadow=function(){return this._shadow};e.extend(b,d);f.Text=b})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(f,e){function d(){this.def="easeOutQuad";this.math=window.Math}function b(a,b,d,e,f){this.angle=0;this._rotationSpeed=0.1;this.speed=0.05;this.vanishRate=0.0050;this.alpha=1;this.setPath(a,b);this.setWidth(d);this.setHeight(e);this.onChangeEvent={}}function a(a,b,d,e,f,t,g,k,h){this.minAngle||(this.minAngle=0);this.maxAngle||(this.maxAngle=6.28);this.amount=a;this.color=b;this.minWidth=d||1;this.minHeight=e||1;this.maxWidth=f||3;this.maxHeight=t||3;this.minSpeed=g||0.01;this.maxSpeed=k||
0.1;this.vanishRate=h;this.onChangeEvent={}}function s(a,d,f,x,q,t,g,k,h){this.origin=origin;this.direction=direction;a=particleAmount;var m=origin,n=direction;f=f||4;x=x||4;q=q||8;t=t||8;g=g||0.01;k=k||0.4;h=h||e.Math2d.randomFloat(0.01,0.03);for(var p=e.Math2d,s=[],u=0;u<a;u++){var r=new b(m,{x:m.x+5*n.x,y:m.y+5*n.y});r.setWidth(p.randomInt(f,q));r.setHeight(p.randomInt(x,t));if(d)r.color=d[p.randomInt(0,d.length-1)];else switch(p.randomInt(0,2)){case 0:r.color="rgb(255, 128, 0)";break;case 1:r.color=
"rgb(255, 180, 0)";break;case 2:r.color="rgb(255, 80, 0)"}h&&(r.vanishRate=h);r.speed=p.randomFloat(g,k);s.push(r)}this.particles=s;this.visibleParticles=this.particles.length}function p(a){this.operation="source-atop";this.startTime=0;e.applyProperties(this,a,["fillStyle"])}function k(a,b,d){void 0==b&&(b=1);this.rate=1/(b*e.getAverageFps());this.object=a;this.onFinished=d;a.setAlpha(0)}function g(a,b,d){void 0==b&&(b=1);this.rate=1/(b*e.getAverageFps());this.object=a;this.onFinished=d;a.setAlpha(1)}
function n(a,b,d,f,q){void 0==b&&(b=1);this.rate=1/(b*e.getAverageFps());this.object=a;this.min=f||0;this.max=q||1;a.setAlpha(1);this.onFinished=this.changeFade;this.onLoop=d?this.fadeOut:this.fadeIn}function m(a,b,d,f,q){this.object=a;this._x=b;this._y=d;void 0==f&&(f=1);this.onFinished=q;q=e.Math2d;f*=e.getAverageFps();a=new q.Vector2d(a._x,a._y);b=new q.Vector2d(b,d);this.speed=q.getDistance(a,b)/f;this.direction=e.Math2d.getNormalized(e.Math2d.getVector2d(a,b))}function h(a,b,d,f,q){f*=e.getAverageFps();
a._scale||(a._scale={x:1,y:1});this.speedX=Math.abs(a._scale.x-b)/f;this.speedY=Math.abs(a._scale.y-d)/f;this.object=a;this._x=b;this._y=d;this.onFinished=q}function u(a,b,d,f,q){f*=e.getAverageFps();a._scale||(a._scale={x:1,y:1});this.speedX=Math.abs(a._scale.x-b)/f;this.speedY=Math.abs(a._scale.y-d)/f;this.object=a;this._x=b;this._y=d;this.onFinished=q}function r(a,b,d,e){this.object=a;this.times=void 0==b?6:2*b;this.duration=void 0==d?250:d;this.lastTime=0;this.onFinished=e}function y(a,b,d,f){d||
(d=1);this.frames=d*e.getAverageFps();a._rotation||(a._rotation=0);this.object=a;this.angle=b;this.onFinished=f;this._rotation=(this.angle-a._rotation)/this.frames}d.prototype.swing=function(a,b,d,e,f){return this[this.def](a,b,d,e,f)};d.prototype.easeInQuad=function(a,b,d,e,f){return e*(b/=f)*b+d};d.prototype.easeOutQuad=function(a,b,d,e,f){return-e*(b/=f)*(b-2)+d};d.prototype.easeInOutQuad=function(a,b,d,e,f){return 1>(b/=f/2)?e/2*b*b+d:-e/2*(--b*(b-2)-1)+d};d.prototype.easeInCubic=function(a,b,
d,e,f){return e*(b/=f)*b*b+d};d.prototype.easeOutCubic=function(a,b,d,e,f){return e*((b=b/f-1)*b*b+1)+d};d.prototype.easeInOutCubic=function(a,b,d,e,f){return 1>(b/=f/2)?e/2*b*b*b+d:e/2*((b-=2)*b*b+2)+d};d.prototype.easeInQuart=function(a,b,d,e,f){return e*(b/=f)*b*b*b+d};d.prototype.easeOutQuart=function(a,b,d,e,f){return-e*((b=b/f-1)*b*b*b-1)+d};d.prototype.easeInOutQuart=function(a,b,d,e,f){return 1>(b/=f/2)?e/2*b*b*b*b+d:-e/2*((b-=2)*b*b*b-2)+d};d.prototype.easeInQuint=function(a,b,d,e,f){return e*
(b/=f)*b*b*b*b+d};d.prototype.easeOutQuint=function(a,b,d,e,f){return e*((b=b/f-1)*b*b*b*b+1)+d};d.prototype.easeInOutQuint=function(a,b,d,e,f){return 1>(b/=f/2)?e/2*b*b*b*b*b+d:e/2*((b-=2)*b*b*b*b+2)+d};d.prototype.easeInSine=function(a,b,d,e,f){return-e*this.math.cos(b/f*(this.math.PI/2))+e+d};d.prototype.easeOutSine=function(a,b,d,e,f){return e*this.math.sin(b/f*(this.math.PI/2))+d};d.prototype.easeInOutSine=function(a,b,d,e,f){return-e/2*(this.math.cos(this.math.PI*b/f)-1)+d};d.prototype.easeInExpo=
function(a,b,d,e,f){return 0==b?d:e*this.math.pow(2,10*(b/f-1))+d};d.prototype.easeOutExpo=function(a,b,d,e,f){return b==f?d+e:e*(-this.math.pow(2,-10*b/f)+1)+d};d.prototype.easeInOutExpo=function(a,b,d,e,f){return 0==b?d:b==f?d+e:1>(b/=f/2)?e/2*this.math.pow(2,10*(b-1))+d:e/2*(-this.math.pow(2,-10*--b)+2)+d};d.prototype.easeInCirc=function(a,b,d,e,f){return-e*(this.math.sqrt(1-(b/=f)*b)-1)+d};d.prototype.easeOutCirc=function(a,b,d,e,f){return e*this.math.sqrt(1-(b=b/f-1)*b)+d};d.prototype.easeInOutCirc=
function(a,b,d,e,f){return 1>(b/=f/2)?-e/2*(this.math.sqrt(1-b*b)-1)+d:e/2*(this.math.sqrt(1-(b-=2)*b)+1)+d};d.prototype.easeInElastic=function(a,b,d,e,f){a=1.70158;var t=0,g=e;if(0==b)return d;if(1==(b/=f))return d+e;t||(t=0.3*f);g<this.math.abs(e)?(g=e,a=t/4):a=t/(2*this.math.PI)*this.math.asin(e/g);return-(g*this.math.pow(2,10*(b-=1))*this.math.sin((b*f-a)*2*this.math.PI/t))+d};d.prototype.easeOutElastic=function(a,b,d,e,f){a=1.70158;var g=0,h=e;if(0==b)return d;if(1==(b/=f))return d+e;g||(g=0.3*
f);h<this.math.abs(e)?(h=e,a=g/4):a=g/(2*this.math.PI)*this.math.asin(e/h);return h*this.math.pow(2,-10*b)*this.math.sin((b*f-a)*2*this.math.PI/g)+e+d};d.prototype.easeInOutElastic=function(a,b,d,e,f){a=1.70158;var g=0,h=e;if(0==b)return d;if(2==(b/=f/2))return d+e;g||(g=f*0.3*1.5);h<this.math.abs(e)?(h=e,a=g/4):a=g/(2*this.math.PI)*this.math.asin(e/h);return 1>b?-0.5*h*this.math.pow(2,10*(b-=1))*this.math.sin((b*f-a)*2*this.math.PI/g)+d:0.5*h*this.math.pow(2,-10*(b-=1))*this.math.sin((b*f-a)*2*this.math.PI/
g)+e+d};d.prototype.easeInBack=function(a,b,d,e,f,g){void 0==g&&(g=1.70158);return e*(b/=f)*b*((g+1)*b-g)+d};d.prototype.easeOutBack=function(a,b,d,e,f,g){void 0==g&&(g=1.70158);return e*((b=b/f-1)*b*((g+1)*b+g)+1)+d};d.prototype.easeInOutBack=function(a,b,d,e,f,g){void 0==g&&(g=1.70158);return 1>(b/=f/2)?e/2*b*b*(((g*=1.525)+1)*b-g)+d:e/2*((b-=2)*b*(((g*=1.525)+1)*b+g)+2)+d};d.prototype.easeInBounce=function(a,b,d,e,f){return e-this.easeOutBounce(a,f-b,0,e,f)+d};d.prototype.easeOutBounce=function(a,
b,d,e,f){return(b/=f)<1/2.75?e*7.5625*b*b+d:b<2/2.75?e*(7.5625*(b-=1.5/2.75)*b+0.75)+d:b<2.5/2.75?e*(7.5625*(b-=2.25/2.75)*b+0.9375)+d:e*(7.5625*(b-=2.625/2.75)*b+0.984375)+d};d.prototype.easeInOutBounce=function(a,b,d,e,f){return b<f/2?0.5*this.easeInBounce(a,2*b,0,e,f)+d:0.5*this.easeOutBounce(a,2*b-f,0,e,f)+0.5*e+d};b.prototype.setWidth=function(a){this._halfWidth=a/2};b.prototype.setHeight=function(a){this._halfHeight=a/2};b.prototype.setPath=function(a,b){this._x=a.x;this._y=a.y;this.direction=
e.math2d.getVector2d(a,b)};b.prototype.onLoop=function(){this.alpha-=this.vanishRate;this.angle+=this._rotationSpeed;this._x+=this.speed*this.direction.x;this._y+=this.speed*this.direction.y;this.onChangeEvent.needsRedraw=!0};b.prototype.onRender=function(a,b,d,e){0<=this.alpha&&(a.save(),a.globalAlpha=this.alpha,a.translate(this._x-d,this._y-e),a.rotate(this.angle),a.fillStyle=this.fillStyle,a.fillRect(-this._halfWidth,-this._halfHeight,this._halfWidth,this._halfHeight),a.restore())};b.prototype.setZIndex=
function(a){this._zIndex=a;this.onChangeEvent.needsRedraw=!0;this.onChangeEvent.needsSorting=!0};b.prototype.isVisible=function(a,b,d,e){return 0>=this.alpha||this._y+this._halfHeight<b||this._y-this._halfHeight>e||this._x+this._halfWidth<a||this._x-this._halfWidth>d?!1:!0};a.prototype.onLoop=function(){if(this.children){for(var a=0,b=this.children.length,d=0,e;a<b;a++)if(e=this.children[a],0>=e.alpha)d++;else e.onLoop();d==b?this.children=null:this.onChangeEvent.needsRedraw=!0}};a.prototype.onRender=
function(){};a.prototype.isVisible=function(){return!0};a.prototype.setZIndex=function(a){this._zIndex=a;this.onChangeEvent.needsRedraw=!0;this.onChangeEvent.needsSorting=!0};a.prototype.create=function(a,d){var f=e.random;this.children=[];for(var g=0;g<this.amount;g++){var h=f.decimal(this.minAngle,this.maxAngle),k={},m={};k.x=a;k.y=d;m.x=a+50*Math.cos(h);m.y=d+50*Math.sin(h);h=new b(k,m);h.setWidth(f.integer(this.minWidth,this.maxWidth));h.setHeight(f.integer(this.minHeight,this.maxHeight));if(this.color)h.fillStyle=
this.color[f.integer(0,color.length-1)];else switch(f.integer(0,2)){case 0:h.fillStyle="rgb(255, 128, 0)";break;case 1:h.fillStyle="rgb(255, 180, 0)";break;default:h.fillStyle="rgb(255, 80, 0)"}this.vanishRate&&(h.vanishRate=this.vanishRate);h.speed=f.decimal(this.minSpeed,this.maxSpeed);this.children.push(h)}};s.prototype.create=function(a,b){};s.prototype.onLoop=function(a){if(this.visible){for(var b,d=0;d<this.particles.length;d++)b=this.particles[d],b.onLoop(a),b.isVisible()||(this.loop?(b.setPath(this.origin,
{x:this.origin.x+5*this.direction.x,y:this.origin.y+5*this.direction.y}),b.rotation=0,b.alpha=1,b.angle=0,b.vanishRate=e.Math2d.randomFloat(0.05,0.2),b.speed=e.Math2d.randomFloat(0.0050,0.5)):this.visibleParticles--);1>this.visibleParticles&&e.remove(this)}};p.prototype={render:function(a,b,d){this.isVisible()&&(a.globalCompositeOperation=this.operation,a.fillStyle=this.fillStyle,a.fillRect(0,0,b,d))},show:function(){this.startTime=e.getTimeInMillis()},isVisible:function(){return this.showAlways||
e.getTimeInMillis()-this.startTime<this.duration}};k.prototype.onLoop=function(a){a=this.object.getAlpha()+this.rate;if(1>a)this.object.setAlpha(a);else return this.object.setAlpha(1),this.onFinished&&this.onFinished.apply(this.object),!1;return!0};g.prototype.onLoop=function(a){a=this.object.getAlpha()-this.rate;if(0<a)this.object.setAlpha(a);else return this.object.setAlpha(0),this.onFinished&&this.onFinished.apply(this.object),!1;return!0};n.prototype.fadeIn=function(a){a=this.object._alpha+this.rate;
a<this.max?this.object.setAlpha(a):(this.object.setAlpha(this.max),this.onLoop=this.fadeOut);return!0};n.prototype.fadeOut=function(){var a=this.object._alpha-this.rate;a>this.min?this.object.setAlpha(a):(this.object.setAlpha(this.min),this.onLoop=this.fadeIn);return!0};m.prototype={onLoop:function(a){a=1<Math.abs(this._x-this.object._x);var b=1<Math.abs(this._y-this.object._y);a&&this.object.offsetX(this.direction.x*this.speed);b&&this.object.offsetY(this.direction.y*this.speed);return a||b?!0:(this.onFinished&&
this.onFinished.apply(this.object),!1)}};h.prototype={onLoop:function(a){this.object._scale.x<this._x&&(this.object._scale.x+=this.speedX,this.object.onChangeEvent.needsRedraw=!0);this.object._scale.y<this._y&&(this.object._scale.y+=this.speedY,this.object.onChangeEvent.needsRedraw=!0);return this.object._scale.x>=this._x&&this.object._scale.y>=this._y?(this.onFinished&&this.onFinished.apply(this.object),!1):!0}};u.prototype={onLoop:function(a){this.object._scale.x>this._x&&(this.object._scale.x-=
this.speedX,this.object.onChangeEvent.needsRedraw=!0);this.object._scale.y>this._y&&(this.object._scale.y-=this.speedY,this.object.onChangeEvent.needsRedraw=!0);return this.object._scale.x<=this._x&&this.object._scale.y<=this._y?(this.onFinished&&this.onFinished.apply(this.object),!1):!0}};r.prototype={onLoop:function(a){if(e.getTimeInMillis()-this.lastTime>=this.duration){if(this.times--)1==this.object._alpha?this.object.setAlpha(0):this.object.setAlpha(1);else return this.object.setAlpha(void 0),
this.onFinished&&this.onFinished.apply(this.object),!1;this.lastTime=e.getTimeInMillis()}return!0}};y.prototype={onLoop:function(a){if(this.frames--)this.object.offsetRotation(this._rotation);else return this.onFinished&&this.onFinished.apply(this.object),!1;return!0}};f.visual={Particle:b,LinearParticleEmitter:s,RadialParticleEmitter:a,Tint:p,Move:m,FadeIn:k,FadeOut:g,ContinousFade:n,ScaleUp:h,ScaleDown:u,Rotate:y,Twinkle:r}})(M.effects||(M.effects={}),M);(function(f){function e(d,b,a){this.interval=d;this._lastTime=f.getTime();a?(this.owner=a,this.callback=b):this.tick=b;this.enabled=!0}e.prototype.onLoop=function(d){this.enabled&&f.elapsedTimeFrom(this._lastTime,this.interval)&&(this.tick(),this._lastTime=f.getTime())};e.prototype.tick=function(){this.callback.call(this.owner)};f.Timer=e})(window.Match);(function(f){function e(d){this._lastTime=0;this.time=d}e.prototype.elapsed=function(){var d=f.getTime();return d-this.time>=this._lastTime?(this._lastTime=d,!0):!1};f.TimeCounter=e})(window.Match);
