(function(f){function e(){this.listeners=[]}e.prototype.addEventListener=function(d,b){b&&(d=d.bind(b));this.listeners.push(d)};e.prototype.raise=function(){var d=0,b=this.listeners.length;if(0!=b)for(d=0;d<b;d++)this.listeners[d](arguments)};e.prototype.removeEventListener=function(d){d=this.listeners.indexOf(d);-1<d&&this.listeners.splice(d,1)};e.prototype.removeAllEventListeners=function(){this.listeners=[]};f.EventListener=e})(window);var M=window.M||{},game=window.game||{};
(function(f){function e(){var a="Firefox;Chrome;Opera;Safari;MSIE 9.0;BlackBerry".split(";"),b,d;this.name=void 0;for(b in a)d=a[b],this["is"+d]=-1!=navigator.userAgent.indexOf(d),!this.name&&this["is"+d]&&(this.name=d);this.supportedAudioFormat=this.getBrowserPreferredAudioFormat();this.supported=void 0!=this.name}function d(){var a="Android BlackBerry iPhone iPad iPod IEMobile".split(" "),b;for(b in a)deviceName=a[b],this["is"+deviceName]=-1!=navigator.userAgent.indexOf(deviceName),!this.name&&
this["is"+deviceName]&&(this.name=deviceName);this.name?this.isMobile=!0:(this.isMobile=!1,this.name="PC")}function b(){this._isPlaying=!1;this._gameLayers=[];this._gameObjects=[];this.cache=null;this.offScreenCanvas=document.createElement("canvas");this.offScreenContext=this.offScreenCanvas.getContext("2d");this.onLoopProperties={offScreenContext:this.offScreenContext,offScreenCanvas:this.offScreenCanvas,debug:!1,time:0};this.browser=new e;this.device=new d;this.onBeforeLoop=new EventListener;this.onAfterLoop=
new EventListener;this.onGameObjectPushed=new EventListener;this.onGameObjectRemoved=new EventListener;this.setDoubleBuffer(!1);this.plugins={html:{}};var a=this;document.addEventListener("DOMContentLoaded",function(){a.setUpGameLoop()})}function a(){requestAnimationFrame(a);M.gameLoop()}f.Match||(e.prototype.getBrowserPreferredAudioFormat=function(){var a=document.createElement("audio");if(""!=a.canPlayType("audio/ogg"))return".ogg";if(""!=a.canPlayType("audio/mpeg"))return".mp3";if(""!=a.canPlayType("audio/wav"))return".wav";
if(""!=a.canPlayType("audio/mp4"))return".mp4";console.warn("This browser does not support audio")},e.prototype.getBrowserAudioSupportedFormats=function(){var a=document.createElement("audio"),b=[];""!=a.canPlayType("audio/ogg")&&b.push(".ogg");""!=a.canPlayType("audio/mpeg")&&b.push(".mp3");""!=a.canPlayType("audio/wav")&&b.push(".wav");""!=a.canPlayType("audio/mp4")&&b.push(".mp4");return b.join("|")},b.prototype.registerClass=function(){for(var a=arguments[0].split("."),b=arguments[arguments.length-
1],d=window,e=a.length-1,f=[],m,p=0;p<e;p++)m=a[p],d[m]||(d[m]={}),d=d[m];if(!d[a[e]]){for(p=1;p<arguments.length-1;p++)f.push(arguments[p]);d[a[e]]=b.apply(b,f);d[a[e]].namespace=arguments[0]}},b.prototype.registerGameEntity=function(){arguments[0]="game."+arguments[0];this.registerClass.apply(this,arguments)},b.prototype.registerPlugin=function(){arguments[0]="M.plugins."+arguments[0];this.registerClass.apply(this,arguments)},b.prototype.registerPluginTemplate=function(a,b){this.plugins.html[a]=
b},b.prototype.getPluginTemplate=function(a){var b=document.createElement("div");b.setAttribute("id",a);b.innerHTML=this.plugins.html[a];return b},b.prototype.setUpGameLoop=function(){this.gameLoopAlreadySetup=!0;a();"function"==typeof window.main&&window.main()},b.prototype.setKeyboard=function(a){this.keyboard=a;this.onLoopProperties.keyboard=a;this._buildInputMapping()},b.prototype.setMouse=function(a){this.mouse=a;this.onLoopProperties.mouse=a;this._buildInputMapping()},b.prototype.setTouch=function(a){this.touch=
a;this.onLoopProperties.touch=a;this._buildInputMapping()},b.prototype.setAccelerometer=function(a){this.accelerometer=a;this.onLoopProperties.accelerometer=a;this._buildInputMapping()},b.prototype.setOrientation=function(a){this.orientation=a;this.onLoopProperties.orientation=a;this._buildInputMapping()},b.prototype.renderSingleBuffer=function(a,b,d){var e=a.length,f=0,m=this.frontBuffer;for(m.clearRect(0,0,b.width,b.height);f<e;f++)m.drawImage(a[f].onLoop(d),0,0)},b.prototype.renderDoubleBuffer=
function(a,b,d){var e=a.length,f=0,m,p=this.backBuffer;for(p.clearRect(0,0,b.width,b.height);f<e;f++){m=a[f];var r=m.onLoop(d);p.save();m.composite&&(p.globalCompositeOperation=m.composite);null!=m._alpha&&(0<=m._alpha&&1>=m._alpha)&&(p.globalAlpha=m._alpha);p.translate(p.halfWidth,p.halfHeight);m.rotation&&p.rotate(m.rotation);m.scale&&p.scale(m.scale.x,m.scale.y);p.drawImage(r,-p.halfWidth,-p.halfHeight);p.restore()}this.frontBuffer.clearRect(0,0,b.width,b.height);this.frontBuffer.drawImage(p.canvas,
0,0)},b.prototype.updateGameObjects=function(a,b){for(var d=0;d<a.length;d++){var e=a[d];this._applyInput&&this._applyInput(b,e);if(e.onLoop)e.onLoop(b);e.children&&this.updateGameObjects(e.children,b)}},b.prototype._buildInputMapping=function(){var a=this.onLoopProperties,b="",d="";a.keyboard&&(b+="p.keyboard.applyToObject(node);",d+="p.keyboard.update();");a.mouse&&(b+="p.mouse.applyToObject(node);",d+="p.mouse.update();");a.touch&&(b+="p.touch.applyToObject(node);",d+="p.touch.update();");a.accelerometer&&
(b+="p.accelerometer.applyToObject(node);",d+="p.accelerometer.update();");a.orientation&&(b+="p.orientation.applyToObject(node);",d+="p.orientation.update();");this._applyInput=new Function("p","node",b);this._updateInput=new Function("p",d)},b.prototype.gameLoop=function(){if(this._isPlaying){this.onBeforeLoop.raise();var a=this.onLoopProperties;a.time=this.FpsCounter.timeInMillis;this.updateGameObjects(this._gameObjects,a);this._updateInput(a);this.render(this._gameLayers,this.frontBuffer.canvas,
a);this.FpsCounter.count();this.onAfterLoop.raise();this.mouse&&this.mouse.clear()}},b.prototype.getAsBase64Image=function(){return this.frontBuffer.canvas.toDataURL()},b.prototype.getAsImage=function(){var a=new Image;a.src=this.getAsBase64Image();return a},b.prototype.getFirst=function(){return this.getIndex(0)},b.prototype.getIndex=function(a){try{return this._gameObjects[a]}catch(b){return null}},b.prototype.get=function(a){if(this.cache&&this.cache.key==a)return this.cache;for(var b=this._gameObjects.length,
d;b--;)if(d=this._gameObjects[b],a==d.key)return this.cache=d;return null},b.prototype.getLast=function(){return this.getIndex(this._gameObjects.length-1)},b.prototype.isInOnLoopList=function(a){return-1!=this._gameObjects.indexOf(a)},b.prototype.push=function(a){a instanceof this.Layer?this.pushLayer(a):this.pushObject(a)},b.prototype.pushGameObject=function(a){if(!a.onLoop)throw Error("Cannot add object "+a.constructor.name+", it doesn't have an onLoop method");this._gameObjects.push(a);this.onGameObjectPushed.raise()},
b.prototype.pushObject=b.prototype.pushGameObject,b.prototype.removeGameObject=function(a){void 0!=a&&("string"==typeof a?this.removeGameObject(this.get(a)):isNaN(a)?(a=this._gameObjects.indexOf(a),-1!=a&&(this._gameObjects.splice(a,1),this.onGameObjectRemoved.raise())):(this._gameObjects.splice(a,1),this.onGameObjectRemoved.raise()))},b.prototype.removeAllGameObjects=function(){this._gameObjects=[]},b.prototype.createNewContext=function(){return window.document.createElement("canvas").getContext("2d")},
b.prototype.setDoubleBuffer=function(a){a?(this.backBuffer=this.createNewContext(),this.updateBufferSize(),this.render=this.renderDoubleBuffer):this.render=this.renderSingleBuffer},b.prototype.isDoubleBuffered=function(){return this.render==this.renderDoubleBuffer},b.prototype.setCanvasSize=function(a,b){this.frontBuffer&&(this.frontBuffer.canvas.width=a,this.frontBuffer.canvas.height=b,this.updateBufferSize())},b.prototype.setCanvasStretch=function(a){a?this.setCanvasStretchTo(document.documentElement.clientWidth,
document.documentElement.clientHeight):this.setCanvasStretchTo("auto","auto")},b.prototype.setCanvasStretchTo=function(a,b){if(this.frontBuffer){if(a){if("number"==typeof a||"auto"!=a&&"-1"==a.indexOf("px")&&"-1"==a.indexOf("%"))a+="px";this.frontBuffer.canvas.style.width=a}if(b){if("number"==typeof b||"auto"!=b&&"-1"==b.indexOf("px")&&"-1"==b.indexOf("%"))b+="px";this.frontBuffer.canvas.style.height=b}}},b.prototype.updateBufferSize=function(){this.frontBuffer&&(this.backBuffer&&this.frontBuffer&&
(this.backBuffer.canvas.width=this.frontBuffer.canvas.width,this.backBuffer.canvas.height=this.frontBuffer.canvas.height,this.backBuffer.halfWidth=this.backBuffer.canvas.width/2,this.backBuffer.halfHeight=this.backBuffer.canvas.height/2),this.offScreenCanvas.width=this.frontBuffer.canvas.width,this.offScreenCanvas.height=this.frontBuffer.canvas.height,this.collisions.PixelPerfect&&(this.collisions.PixelPerfect.testContext.canvas.width=this.offScreenCanvas.width,this.collisions.PixelPerfect.testContext.canvas.height=
this.offScreenCanvas.height),this.updateViewport())},b.prototype.createGameLayer=function(a,b){var d=new this.GameLayer(a,b||M._gameLayers.length);this.frontBuffer&&d.setBufferSize(this.frontBuffer.canvas);this.pushGameLayer(d);return d},b.prototype.redrawAllLayers=function(){for(var a=0;a<this._gameLayers.length;a++)this._gameLayers[a].needsRedraw=!0},b.prototype.createLayer=b.prototype.createGameLayer,b.prototype.pushGameLayer=function(a){if(!a)throw Error("Cannot add null game layer");this.frontBuffer&&
a.setBufferSize(this.frontBuffer.canvas);this._gameLayers.push(a)},b.prototype.pushLayer=b.prototype.pushGameLayer,b.prototype.setScene=function(a,b){},b.prototype.removeScene=function(){var a=this._gameLayers;this.removeAllGameLayers();return a},b.prototype.pushScene=function(a){for(var b=0,d=a.length;b<d;b++)this.pushGameLayer(a[b])},b.prototype.swapScenes=function(a){a=this.removeScene();this.pushScene(a);return a},b.prototype.removeGameLayer=function(a){a||0===a||(a=this._gameLayers[0]);this.removeElementFromArray(a,
this._gameLayers);for(var b in a.onRenderList)this.removeGameObject(a.onRenderList[b])},b.prototype.removeAllGameLayers=function(){for(var a=0;a<this._gameLayers.length;a++){var b=this._gameLayers[a],d;for(d in b.onRenderList)this.removeGameObject(b.onRenderList[d])}this._gameLayers=[]},b.prototype.getSpeed=function(a){return a/this.getAverageFps()},b.prototype.getSpeedFixedAt=function(a,b){var d=this.getAverageFps();return a/d*(b/d)},b.prototype.getFps=function(){return this.FpsCounter.fps},b.prototype.getAverageFps=
function(){return this.FpsCounter.getAverageFps()},b.prototype.getGameTime=function(){return this.FpsCounter.gameTime},b.prototype.getTime=function(){return this.FpsCounter.timeInMillis},b.prototype.clearFrontBuffer=function(){this.frontBuffer&&this.frontBuffer.clearRect(0,0,this.frontBuffer.canvas.width,this.frontBuffer.canvas.height)},b.prototype.sortLayers=function(){this._gameLayers.sort(function(a,b){return a._zIndex-b._zIndex})},b.prototype.pause=function(){if(this._isPlaying){if(this.onPause)this.onPause()}else if(this.onUnPause)this.onUnPause();
this._isPlaying=!this._isPlaying},b.prototype.start=function(a,b){a||(a=M.dom("canvas"));if(!(a instanceof HTMLCanvasElement))throw Error("start is expecting an HTMLCanvasElement as argument");a.onselectstart=function(){return!1};a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullScreen;this.frontBuffer=a.getContext("2d");this.updateBufferSize();this.updateViewport();for(var d=0,e=this._gameLayers.length;d<e;d++)this._gameLayers[d].setBufferSize(a);
this._isPlaying=!0;this.gameLoopAlreadySetup||this.setUpGameLoop()},b.prototype.updateViewport=function(){this.camera.setViewport(this.frontBuffer.canvas.width,this.frontBuffer.canvas.height)},b.prototype.getViewportSize=function(){return{width:this.camera.viewportWidth,height:this.camera.viewportHeight}},b.prototype.removeIndexFromArray=function(a,b){b.splice(a,1)},b.prototype.removeElementFromArray=function(a,b){var d=b.indexOf(a);-1!=d&&this.removeIndexFromArray(d,b)},b.prototype.dom=function(a){return document.querySelector(a)},
b.prototype.applyProperties=function(a,b,d){if(a&&b){if(d){if(!b)throw Error("Cannot apply null properties to "+a.constructor.name);for(var e=d.length;e--;)if(!b[d[e]])throw Error("Unable to apply properties to ["+a.constructor.name+"] You must specify ["+d[e]+"]");}d="";for(e in b)if(d="set"+e.charAt(0).toUpperCase()+e.substr(1),a[d])a[d](b[e]);else a[e]=b[e];return a}},b.prototype.apply=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var d=arguments[b];if(d)if(d instanceof Function){var e=
new d,f;for(f in e)d.prototype[f]||a[f]||(a[f]=e[f])}else for(f in d)a[f]||(a[f]=d[f])}},b.prototype.put=function(a,b){for(var d in b)a[d]=b[d]},b.prototype.clone=function(a){for(var b in a)c[b]=a[b];return{}},b.prototype.each=function(a,b,d){var e=a.length;if(d)for(;e--;)b.call(d,a[e]);else for(;e--;)b.call(a[e])},b.prototype.extend=function(a,b){for(var d in b.prototype)a.prototype[d]||(a.prototype[d]=b.prototype[d])},b.prototype.round=function(a,b){for(var d="1";b--;)d+="0";b=parseInt(d);return Math.round(a*
b)/b},b.prototype.fastRound=function(a){return a>>0},b.prototype.getPercentage=function(a,b){return a*b/100},b.prototype.elapsedTimeFrom=function(a,b){return M.getTime()-a>=b},b.prototype.isPaused=function(){return!this._isPlaying},b.prototype.getStyleBySelector=function(a){var b=document.styleSheets,d,e,f;for(e=b.length-1;0<=e;e--)for(d=b[e].cssRules,f=0;f<d.length;f++)if(d[f].type==CSSRule.STYLE_RULE&&d[f].selectorText==a)return d[f].style;return null},b.prototype.setFullScreen=function(){this.frontBuffer&&
this.frontBuffer.canvas.requestFullScreen&&this.frontBuffer.canvas.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},b.prototype.getSceneCenter=function(){return this.frontBuffer?this.frontBuffer.getCenter():{x:0,y:0}},b.prototype.setLoadingScene=function(a){this.prevLayers=M.removeScene();this.pushScene(a.getLayers())},b.prototype.getObjectName=function(a){if(!a||!a.constructor)return a;var b=a.constructor.name;b||(b=a.constructor.toString().match(/function ([a-zA-Z_$][a-zA-Z_$0-9]*)/)[1]);return b},
window.console?(window.console.log&&(window.console.debug=window.console.log),window.console.warn||(window.console.warn=window.console.debug)):(window.console={},window.console.log=window.console.debug=window.console.error=window.console.warning=function(){}),HTMLElement.prototype.remove=function(){this.parentNode.removeChild(this)},HTMLElement.prototype.setClass=function(a){this.setAttribute("class",a)},HTMLCanvasElement.prototype.getCenter=function(){return{x:this.width/2,y:this.height/2}},HTMLCanvasElement.prototype.setSize=
function(a,b){this.width=a;this.height=b},HTMLCanvasElement.prototype.adjustTo=function(a,b){this.style.setProperty("width",a+"px",null);this.style.setProperty("height",b+"px",null)},HTMLCanvasElement.prototype.adjustToAvailSize=function(){this.adjustTo(window.screen.availWidth+"px",window.screen.availHeight+"px")},HTMLCanvasElement.prototype.resizeKeepingAspect=function(a){this.adjustTo(this.width*a,this.height*a)},HTMLCanvasElement.prototype.getRight=function(){return this.offsetLeft+this.offsetWidth},
HTMLCanvasElement.prototype.getBottom=function(){return this.offsetTop+this.offsetHeight},HTMLCanvasElement.prototype.getAvailWidth=function(){return this.getRight()<window.screen.availWidth?this.offsetWidth:window.screen.availWidth-this.offsetLeft},HTMLCanvasElement.prototype.getAvailHeight=function(){return this.getBottom()<window.screen.availHeight?this.offsetHeight:window.screen.availHeight-this.offsetTop},HTMLCanvasElement.prototype.getViewport=function(){var a={};a.left=0>this.offsetLeft?-this.offsetLeft:
0;a.top=0>this.offsetTop?-this.offsetTop:0;a.right=this.offsetLeft+this.offsetWidth>window.screen.availWidth?window.screen.availWidth-this.offsetLeft:this.offsetWidth;a.bottom=this.offsetTop+this.offsetHeight>window.screen.availHeight?window.screen.availHeight-this.offsetTop:this.offsetHeight;return a},HTMLCanvasElement.prototype.getAspect=function(){var a={x:1,y:1};this.style.width&&this.width!=parseInt(this.style.width)&&(a.x=this.width/parseInt(this.style.width));this.style.height&&this.height!=
parseInt(this.style.height)&&(a.y=this.height/parseInt(this.style.height));return a},CanvasRenderingContext2D.prototype.resetOperation=function(){this.operationChanged&&"source-over"!=this.globalCompositeOperation&&(this.globalCompositeOperation="source-over",this.operationChanged=!1)},CanvasRenderingContext2D.prototype.resetAlpha=function(){this.alphaChanged&&1!=this.globalAlpha&&(this.globalAlpha=1,this.alphaChanged=!1)},CanvasRenderingContext2D.prototype.resetShadow=function(){this.shadowChanged&&
(0!=this.shadowBlur&&(this.shadowBlur=0),0!=this.shadowOffsetX&&(this.shadowOffsetX=0),0!=this.shadowOffsetY&&(this.shadowOffsetY=0),this.shadowChanged=!1)},window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,1E3/60)}),f.M=f.Match=new b)})(window);(function(f){function e(){this._list=Array(10);this.size=0}e.prototype.push=function(d){this.size==this._list.length&&(this._list.length+=10);this._list[this.size]=d;return this.size++};e.prototype.clear=function(d){this.removeAll();this._list=Array(10)};e.prototype.removeAll=function(d){this.size=0};e.prototype.get=function(d){return this._list[d]};e.prototype.quickRemove=function(d){this._list[d]=null;this._swap(d,this.size-1);this.size--};e.prototype.remove=function(d){this._list.splice(d,1);this.size--};
e.prototype.each=function(d){for(var b=this._list,a=this.size,h=0;h<a;h++)d(b[h],h,this)};e.prototype._swap=function(d,b){var a=this._list[d];this._list[d]=this._list[b];this._list[b]=a};f.ArrayList=e})(M);(function(f){function e(){}e.prototype._request=function(d,b,a,h){var g=new XMLHttpRequest;g.onreadystatechange=function(){4==this.readyState&&200==this.status&&(h?a.call(h,this.responseText):a(this.responseText))};g.open(d,b,!0);g.send()};e.prototype.post=function(d,b){this._request("POST",d,b)};e.prototype.get=function(d,b){this._request("GET",d,b)};f.Ajax=new e})(window.Match);(function(f){function e(){this.lastTime=(new Date).getTime();this._currentFps=0;this.fps="";this.gameTime=1;this.totalFps=this.timeInMillis=0}e.prototype.reset=function(){this.fps="";this.timeInMillis=this._currentFps=this.totalFps=0;this.gameTime=1};e.prototype.count=function(){this.timeInMillis=(new Date).getTime();1E3<=this.timeInMillis-this.lastTime?(this.lastTime=this.timeInMillis,this.fps=this._currentFps,this.gameTime++,this.totalFps+=this.fps,this._currentFps=0):this._currentFps++};e.prototype.getAverageFps=
function(){return 0==this.totalFps?60:Math.floor(this.totalFps/this.gameTime)};f.FpsCounter=new e})(window.Match);(function(f){function e(){this.hasFocus=!1;this.children=[]}e.prototype.pushChild=function(d){d.ownerLayer=this.ownerLayer;return this.children.push(d)};e.prototype.removeChild=function(d){f.removeElementFromArray(d,this.children)};e.prototype.onLoop=function(){throw Error("Method GameObject.onLoop is abstract and must be overriden");};f.GameObject=e})(window.M);(function(f){function e(){this.math=Math}function d(b,a){this.x=b;this.y=a}e.prototype.valueInBetween=function(b,a,d){return a<=b&&b<=d};e.prototype.getXFromCircle=function(b,a,d){return b+a*this.math.cos(d)};e.prototype.getYFromCircle=function(b,a,d){return b+a*this.math.sin(d)};e.prototype.getPointFromCircle=function(b,a,d,g){return this.getPointFromElipsis(b,a,d,d,g)};e.prototype.getPointFromElipsis=function(b,a,h,g,e){return new d(this.getXFromCircle(b,h,e),this.getYFromCircle(a,g,e))};e.prototype.getVector2d=
function(b,a){return new d(a.x-b.x,a.y-b.y)};e.prototype.getVector=function(b,a){return this.getVector2d(b,a)};e.prototype.getRotatedVertex=function(b,a){return new d(b.x*this.math.cos(a)-b.y*this.math.sin(a),b.y*this.math.cos(a)+b.x*this.math.sin(a))};e.prototype.getMagnitude=function(b){return this.math.sqrt(b.x*b.x+b.y*b.y)};e.prototype.getSquareDistance=function(b,a){var d=b.x-a.x,g=b.y-a.y;return d*d+g*g};e.prototype.getAngleBetweenVectors=function(b,a){var d=this.getMagnitude(b)*this.getMagnitude(a);
return this.math.acos((b.x*a.x+b.y*a.y)/d)};e.prototype.getCosBetweenVectors=function(b,a){var d=this.getMagnitude(b)*this.getMagnitude(a);return(b.x*a.x+b.y*a.y)/d};e.prototype.getDistance=function(b,a){return this.math.sqrt(this.getSquareDistance(b,a))};e.prototype.haveTheSameDirection=function(b,a){return 0<b.x&&0>a.x||0>b.x&&0<a.x||0<b.y&&0>a.y||0>b.y&&0<a.y?!1:!0};e.prototype.areParallelVectors=function(b,a){b=this.getNormalized(b);a=this.getNormalized(a);var d=b.x/a.x,g=b.y/a.y;return d>=g-
0.1&&d<=g+0.1};e.prototype.getNormalized=function(b){var a=this.getMagnitude(b);return new d(b.x/a,b.y/a)};e.prototype.substract=function(b,a){return new d(b.x-a.x,b.y-a.y)};e.prototype.add=function(b,a){return new d(b.x+a.x,b.y+a.y)};e.prototype.scalarProduct=function(b,a){return new d(b.x*a,b.y*a)};e.prototype.rotateIfNeeded=function(b,a,d){if(!this.areParallelVectors(b,a)||!this.haveTheSameDirection(b,a)){var g=this.getSquareDistance(b,a),e=this.getRotatedVertex(b,d);if(this.getSquareDistance(e,
a)<g)return b.x=e.x,b.y=e.y,d;a=this.getRotatedVertex(b,-d);b.x=a.x;b.y=a.y;return-d}return 0};f.math2d=f.Math2d=new e;f.math2d.Vector2d=d})(window.Match);(function(f,e){function d(a,b,d,h,e){this.angle=0;this._rotationSpeed=0.1;this.speed=0.05;this.vanishRate=0.005;this.alpha=1;this.setPath(a,b);this.setWidth(d);this.setHeight(h)}function b(a,b,d,h,e,g,f,m,k){this.minAngle||(this.minAngle=0);this.maxAngle||(this.maxAngle=6.28);this.amount=a;this.color=b;this.minWidth=d||1;this.minHeight=h||1;this.maxWidth=e||3;this.maxHeight=g||3;this.minSpeed=f||0.01;this.maxSpeed=m||0.1;this.vanishRate=k}function a(a,b,h,g,f,m,k,q,n){this.origin=origin;this.direction=
direction;a=particleAmount;var p=origin,r=direction;h=h||4;g=g||4;f=f||8;m=m||8;k=k||0.01;q=q||0.4;n=n||e.Math2d.randomFloat(0.01,0.03);for(var s=e.Math2d,w=[],E=0;E<a;E++){var t=new d(p,{x:p.x+5*r.x,y:p.y+5*r.y});t.setWidth(s.randomInt(h,f));t.setHeight(s.randomInt(g,m));if(b)t.color=b[s.randomInt(0,b.length-1)];else switch(s.randomInt(0,2)){case 0:t.color="rgb(255, 128, 0)";break;case 1:t.color="rgb(255, 180, 0)";break;case 2:t.color="rgb(255, 80, 0)"}n&&(t.vanishRate=n);t.speed=s.randomFloat(k,
q);w.push(t)}this.particles=w;this.visibleParticles=this.particles.length}function h(a){this.operation="source-atop";this.startTime=0;e.applyProperties(this,a,["fillStyle"])}function g(a,b,d){void 0==b&&(b=1);this.rate=1/(b*e.getAverageFps());this.object=a;this.onFinished=d}function q(a,b,d){void 0==b&&(b=1);this.rate=1/(b*e.getAverageFps());this.object=a;this.onFinished=d}function k(a,b,d){void 0==b&&(b=1);this.seconds=b;this.object=a;this.timer=0;this.onFinished=d}function n(a,b,d,h,g){void 0==
b&&(b=1);this.rate=1/(b*e.getAverageFps());this.object=a;this.min=h||0;this.max=g||1;a.setAlpha(1);this.onFinished=this.changeFade;this.onLoop=d?this.fadeOut:this.fadeIn}function m(a,b,d,h,g){this.object=a;this._x=b;this._y=d;void 0==h&&(h=1);this.onFinished=g;g=e.Math2d;h*=e.getAverageFps();a=new g.Vector2d(a._x,a._y);b=new g.Vector2d(b,d);this.speed=g.getDistance(a,b)/h;this.direction=e.Math2d.getNormalized(e.Math2d.getVector2d(a,b))}function p(a,b,d,h,g){h*=e.getAverageFps();a._scale||(a._scale=
{x:1,y:1});this.speedX=Math.abs(a._scale.x-b)/h;this.speedY=Math.abs(a._scale.y-d)/h;this.object=a;this._x=b;this._y=d;this.onFinished=g}function r(a,b,d,h,g){h*=e.getAverageFps();a._scale||(a._scale={x:1,y:1});this.speedX=Math.abs(a._scale.x-b)/h;this.speedY=Math.abs(a._scale.y-d)/h;this.object=a;this._x=b;this._y=d;this.onFinished=g}function s(a,b,d,h){this.object=a;this.times=void 0==b?6:2*b;this.duration=void 0==d?250:d;this.lastTime=0;this.onFinished=h}function w(a,b,d,h){d||(d=1);this.frames=
d*e.getAverageFps();a._rotation||(a._rotation=0);this.object=a;this.angle=b;this.onFinished=h;this._rotation=(this.angle-a._rotation)/this.frames}d.prototype.setWidth=function(a){this._halfWidth=a/2};d.prototype.setHeight=function(a){this._halfHeight=a/2};d.prototype.setPath=function(a,b){this._x=a.x;this._y=a.y;this.direction=e.math2d.getVector2d(a,b)};d.prototype.onLoop=function(){this.alpha-=this.vanishRate;this.angle+=this._rotationSpeed;this._x+=this.speed*this.direction.x;this._y+=this.speed*
this.direction.y};d.prototype.onRender=function(a,b,d,h){0<=this.alpha&&(a.save(),a.globalAlpha=this.alpha,a.translate(this._x-d,this._y-h),a.rotate(this.angle),a.fillStyle=this.fillStyle,a.fillRect(-this._halfWidth,-this._halfHeight,this._halfWidth,this._halfHeight),a.restore())};d.prototype.setZIndex=function(a){this._zIndex=a};d.prototype.isVisible=function(a,b,d,h){return 0>=this.alpha||this._y+this._halfHeight<b||this._y-this._halfHeight>h||this._x+this._halfWidth<a||this._x-this._halfWidth>
d?!1:!0};b.prototype.onLoop=function(){if(this.children){for(var a=0,b=this.children.length,d=0,h;a<b;a++)if(h=this.children[a],0>=h.alpha)d++;else h.onLoop();d==b&&(this.children=null)}};b.prototype.onRender=function(){};b.prototype.isVisible=function(){return!0};b.prototype.setZIndex=function(a){this._zIndex=a};b.prototype.create=function(a,b){var h=e.random;this.children=[];for(var g=0;g<this.amount;g++){var f=h.decimal(this.minAngle,this.maxAngle),m={},k={};m.x=a;m.y=b;k.x=a+50*Math.cos(f);k.y=
b+50*Math.sin(f);f=new d(m,k);f.setWidth(h.integer(this.minWidth,this.maxWidth));f.setHeight(h.integer(this.minHeight,this.maxHeight));if(this.color)f.fillStyle=this.color[h.integer(0,color.length-1)];else switch(h.integer(0,2)){case 0:f.fillStyle="rgb(255, 128, 0)";break;case 1:f.fillStyle="rgb(255, 180, 0)";break;default:f.fillStyle="rgb(255, 80, 0)"}this.vanishRate&&(f.vanishRate=this.vanishRate);f.speed=h.decimal(this.minSpeed,this.maxSpeed);this.children.push(f)}};a.prototype.create=function(a,
b){};a.prototype.onLoop=function(a){if(this.visible){for(var b,d=0;d<this.particles.length;d++)b=this.particles[d],b.onLoop(a),b.isVisible()||(this.loop?(b.setPath(this.origin,{x:this.origin.x+5*this.direction.x,y:this.origin.y+5*this.direction.y}),b.rotation=0,b.alpha=1,b.angle=0,b.vanishRate=e.Math2d.randomFloat(0.05,0.2),b.speed=e.Math2d.randomFloat(0.005,0.5)):this.visibleParticles--);1>this.visibleParticles&&e.remove(this)}};h.prototype.render=function(a,b,d){this.isVisible()&&(a.globalCompositeOperation=
this.operation,a.fillStyle=this.fillStyle,a.fillRect(0,0,b,d))};h.prototype.show=function(){this.startTime=e.getTimeInMillis()};h.prototype.isVisible=function(){return this.showAlways||e.getTimeInMillis()-this.startTime<this.duration};g.prototype.initialize=function(){this.object.setAlpha(0);this.onLoop=this.run;return!0};g.prototype.run=function(){var a=this.object.getAlpha()+this.rate;if(1>a)this.object.setAlpha(a);else return this.object.setAlpha(1),this.onFinished&&this.onFinished.apply(this.object),
!1;return!0};g.prototype.onLoop=g.prototype.initialize;q.prototype.initialize=function(){this.object.setAlpha(1);this.onLoop=this.run;return!0};q.prototype.run=function(){var a=this.object.getAlpha()-this.rate;if(0<a)this.object.setAlpha(a);else return this.object.setAlpha(0),this.onFinished&&this.onFinished.apply(this.object),!1;return!0};q.prototype.onLoop=q.prototype.initialize;k.prototype.initialize=function(a){this.timer=new e.TimeCounter(1E3*this.seconds);this.onLoop=this.run};k.prototype.run=
function(){return this.timer.elapsed()?(this.onFinished&&this.onFinished.apply(this.object),!1):!0};k.prototype.onLoop=k.prototype.initialize;n.prototype.fadeIn=function(a){a=this.object._alpha+this.rate;a<this.max?this.object.setAlpha(a):(this.object.setAlpha(this.max),this.onLoop=this.fadeOut);return!0};n.prototype.fadeOut=function(){var a=this.object._alpha-this.rate;a>this.min?this.object.setAlpha(a):(this.object.setAlpha(this.min),this.onLoop=this.fadeIn);return!0};m.prototype.onLoop=function(a){a=
Math.abs(this._x-this.object._x)>this.speed;var b=Math.abs(this._y-this.object._y)>this.speed;a&&this.object.offsetX(this.direction.x*this.speed);b&&this.object.offsetY(this.direction.y*this.speed);return a||b?!0:(this.object.setLocation(this._x,this._y),this.onFinished&&this.onFinished.apply(this.object),!1)};p.prototype.onLoop=function(a){this.object._scale.x<this._x&&(this.object._scale.x+=this.speedX);this.object._scale.y<this._y&&(this.object._scale.y+=this.speedY);return this.object._scale.x>=
this._x&&this.object._scale.y>=this._y?(this.onFinished&&this.onFinished.apply(this.object),!1):!0};r.prototype.onLoop=function(a){this.object._scale.x>this._x&&(this.object._scale.x-=this.speedX);this.object._scale.y>this._y&&(this.object._scale.y-=this.speedY);return this.object._scale.x<=this._x&&this.object._scale.y<=this._y?(this.onFinished&&this.onFinished.apply(this.object),!1):!0};s.prototype.onLoop=function(a){if(e.getTimeInMillis()-this.lastTime>=this.duration){if(this.times--)1==this.object._alpha?
this.object.setAlpha(0):this.object.setAlpha(1);else return this.object.setAlpha(void 0),this.onFinished&&this.onFinished.apply(this.object),!1;this.lastTime=e.getTimeInMillis()}return!0};w.prototype.onLoop=function(a){if(this.frames--)this.object.offsetRotation(this._rotation);else return this.onFinished&&this.onFinished.apply(this.object),!1;return!0};f.visual={Particle:d,LinearParticleEmitter:a,RadialParticleEmitter:b,Tint:h,Move:m,FadeIn:g,FadeOut:q,ContinousFade:n,ScaleUp:p,ScaleDown:r,Rotate:w,
Twinkle:s,Wait:k}})(M.effects||(M.effects={}),M);(function(f,e){function d(b,a,d,g,e,f,n,m){this.object=b;this.endValueX=a;this.endValueY=d;this.startValueY=this.startValueX=0;this.easingMethodX=this[e]||this.linearTween;this.easingMethodY=this[f]||this.easingMethodX;this.currentFrame=1;this.durationSeconds=g;this.mathCached=Math;this.totalFrames=0;this.loop=n;this._needsStartValue=!0;this.onFinished=m}d.prototype._init=function(){var b=this.durationSeconds;if("string"==typeof b&&-1!=b.indexOf("px"))var b=parseInt(b),a=this.endValueX-this.object.getX(),
d=this.endValueY-this.object.getY(),b=Math.max(a/b,d/b);this.totalFrames=b*e.getAverageFps();this.currentFrame=0;if(this._needsStartValue||!this.loop)this.startValueX=this.object.getX(),this.startValueY=this.object.getY(),this.endValueX-=this.startValueX,this.endValueY-=this.startValueY,this._needsStartValue=!1;this.onLoop=this._ease;return!0};d.prototype._ease=function(){this.object.setLocation(this.easingMethodX(this.currentFrame,this.startValueX,this.endValueX,this.totalFrames),this.easingMethodY(this.currentFrame,
this.startValueY,this.endValueY,this.totalFrames));this.currentFrame++;if(this.currentFrame<=this.totalFrames)return!0;this.onFinished&&this.onFinished.apply(this.object);return this.loop?(this.onLoop=this._init,!0):!1};d.prototype.onLoop=d.prototype._init;d.prototype.linearTween=function(b,a,d,g){return d*b/g+a};d.prototype.easeInQuad=function(b,a,d,g){b/=g;return d*b*b+a};d.prototype.easeOutQuad=function(b,a,d,g){b/=g;return-d*b*(b-2)+a};d.prototype.easeInOutQuad=function(b,a,d,g){b/=g/2;if(1>b)return d/
2*b*b+a;b--;return-d/2*(b*(b-2)-1)+a};d.prototype.easeInCubic=function(b,a,d,g){b/=g;return d*b*b*b+a};d.prototype.easeOutCubic=function(b,a,d,g){b/=g;b--;return d*(b*b*b+1)+a};d.prototype.easeInOutCubic=function(b,a,d,g){b/=g/2;if(1>b)return d/2*b*b*b+a;b-=2;return d/2*(b*b*b+2)+a};d.prototype.easeInQuart=function(b,a,d,g){b/=g;return d*b*b*b*b+a};d.prototype.easeOutQuart=function(b,a,d,g){b/=g;b--;return-d*(b*b*b*b-1)+a};d.prototype.easeInOutQuart=function(b,a,d,g){b/=g/2;if(1>b)return d/2*b*b*
b*b+a;b-=2;return-d/2*(b*b*b*b-2)+a};d.prototype.easeInQuint=function(b,a,d,g){b/=g;return d*b*b*b*b*b+a};d.prototype.easeOutQuint=function(b,a,d,g){b/=g;b--;return d*(b*b*b*b*b+1)+a};d.prototype.easeInOutQuint=function(b,a,d,g){b/=g/2;if(1>b)return d/2*b*b*b*b*b+a;b-=2;return d/2*(b*b*b*b*b+2)+a};d.prototype.easeInSine=function(b,a,d,g){return-d*this.mathCached.cos(b/g*(this.mathCached.PI/2))+d+a};d.prototype.easeOutSine=function(b,a,d,g){return d*this.mathCached.sin(b/g*(this.mathCached.PI/2))+
a};d.prototype.easeInOutSine=function(b,a,d,g){return-d/2*(this.mathCached.cos(this.mathCached.PI*b/g)-1)+a};d.prototype.easeInExpo=function(b,a,d,g){return d*this.mathCached.pow(2,10*(b/g-1))+a};d.prototype.easeOutExpo=function(b,a,d,g){return d*(-this.mathCached.pow(2,-10*b/g)+1)+a};d.prototype.easeInOutExpo=function(b,a,d,g){b/=g/2;if(1>b)return d/2*this.mathCached.pow(2,10*(b-1))+a;b--;return d/2*(-this.mathCached.pow(2,-10*b)+2)+a};d.prototype.easeInCirc=function(b,a,d,g){b/=g;return-d*(this.mathCached.sqrt(1-
b*b)-1)+a};d.prototype.easeOutCirc=function(b,a,d,g){b/=g;b--;return d*this.mathCached.sqrt(1-b*b)+a};d.prototype.easeInOutCirc=function(b,a,d,g){b/=g/2;if(1>b)return-d/2*(this.mathCached.sqrt(1-b*b)-1)+a;b-=2;return d/2*(this.mathCached.sqrt(1-b*b)+1)+a};f.Easing=d})(M.effects.visual,M);(function(f,e){function d(a,b){b?(this.min=b,this.pauseAfterFade=!1):(this.min=0.1,this.pauseAfterFade=!0);this.sound=a}function b(a,b){b||(this.max=0.9);this.sound=a}function a(a,b,d){this.soundFrom=a;this.soundTo=b;this.max=d;this.currentStep=this.fadeOut}function h(a){this.sounds=a;this.currentSoundIndex=0;this.sounds[0].play()}function g(b,d,h){e.push(new a(b,d,h))}d.prototype={onLoop:function(){this.sound.volume>this.min?this.sound.volume-=0.004:(this.pauseAfterFade&&this.sound.pause(),e.remove(this))}};
b.prototype={onLoop:function(){this.sound.volume<this.max?this.sound.volume+=0.004:e.remove(this)}};a.prototype={fadeOut:function(){0.05<this.soundFrom.volume?this.soundFrom.volume-=0.004:(this.soundFrom.pause(),this.soundTo.volume=0,this.soundTo.play(),this.currentStep=this.fadeIn)},fadeIn:function(){this.soundTo.volume<this.max?this.soundTo.volume+=0.004:e.remove(this)},onLoop:function(){this.currentStep()}};h.prototype={onLoop:function(){this.sounds[this.currentSoundIndex].ended&&(this.currentSoundIndex++,
this.currentSoundIndex<this.sounds.length?this.sounds[this.currentSoundIndex].play():e.remove(this))}};f.sound={fadeOut:function(a,b){e.push(new d(a,b))},fadeIn:function(a,d){e.push(new b(a,d))},transition:g,soundOver:g,soundQueue:function(a){e.push(new h(a))}}})(M.effects||(M.effects={}),M);(function(f,e){function d(b){this.objects=[];this.mode=null;this.setMode(b||"Polygon")}d.prototype={reset:function(){this.objects=[]},onLoop:function(){for(var b=0,a=1;b<this.objects.length;){for(;a<this.objects.length;)this.checkCollisions(this.objects[b],this.objects[a]),a++;b++;a=b+1}for(b=this.objects.length;b--;)this.objects[b]._visible||f.removeIndexFromArray(b,this.objects)},canCollide:function(b,a){if(b.cantCollideType)for(var d=b.cantCollideType.length;d--;)if(a instanceof b.cantCollideType[d])return!1;
if(b.cantCollide)for(d=b.cantCollide.length;d--;)if(b.cantCollide[d]==a)return!1;return!0},checkCollisions:function(b,a){if(this.canCollide(b,a)&&this.canCollide(a,b)&&this.mode.haveCollided(b,a)){if(b.onCollision)b.onCollision(a);if(a.onCollision)a.onCollision(b)}},setMode:function(b,a){this.mode="string"===typeof b?f.collisions[b]:b},push:function(b){this.objects.push(b)},removeType:function(b){for(var a=this.objects.length;a--;)this.objects[a]instanceof b&&this.remove(this.objects[a])}};e.AllvsAllCollisionHandler=
d})(window.Match,window.Match.collisions||(window.Match.collisions={}));(function(f,e){function d(b){this.colliders=[];this.collidables=[];this.setMode(b||"Polygon");this.collidableCallback=this.colliderCallback="onCollision"}d.prototype={onLoop:function(){for(var b=this.colliders.length;b--;)this.checkCollisions(this.colliders[b],this.collidables)},checkCollisions:function(b,a){if(b)for(var d=a.length,g=null;d--;){g=a[d];if(!g)break;if(g instanceof Array)this.checkCollisions(b,g);else if(this.mode.haveCollided(b,g)){if(b[this.colliderCallback])b[this.colliderCallback](g);
if(g[this.collidableCallback])g[this.collidableCallback](b)}}},setMode:function(b){this.mode="string"===typeof b?f.collisions[b]:b}};e.CollisionHandler=d})(window.Match,window.Match.collisions||(window.Match.collisions={}));(function(f,e){function d(){this.math2d=e}d.prototype={getCollisionArea:function(b){var a=[],d=b.getWidth()/2,g=b.getHeight()/2;a.push({x:-d,y:-g});a.push({x:d,y:-g});a.push({x:d,y:g});a.push({x:-d,y:g});this.rotate(a,b._rotation);this.translate(a,b._x,b._y);return a},translate:function(b,a,d){for(var g=0;g<b.length;g++)b[g].x+=a,b[g].y+=d},rotate:function(b,a){if(a)for(var d=0;d<b.length;d++)b[d]=this.math2d.getRotatedVertex(b[d],a)},haveCollided:function(b,a){for(var d=this.getCollisionArea(a),
g=this.getCollisionArea(b),e=0;e<g.length;e++)if(this.pointInPolygon(g[e].x,g[e].y,d)||this.pointInPolygon(d[e].x,d[e].y,g))return!0;return!1},pointInPolygon:function(b,a,d){var g,e,f=!1,n=d.length,m;g=0;for(e=n-1;g<n;e=g++)m=d[g],e=d[e],m.y>a!=e.y>a&&b<(e.x-m.x)*(a-m.y)/(e.y-m.y)+m.x&&(f=!f);return f}};f.Polygon=new d})(window.Match.collisions||(window.Match.collisions={}),window.Match.math2d);(function(f){function e(){}e.prototype={haveCollided:function(d,b){var a=0,h=0,a=d._halfWidth>d._halfHeight?d._halfWidth:d._halfHeight,h=b._halfWidth>b._halfHeight?b._halfWidth:b._halfHeight;return d._y+a<b._y-h||d._y-a>b._y+h||d._x+a<b._x-h||d._x-a>b._x+h?!1:!0}};f.Square=new e})(window.Match.collisions||(window.Match.collisions={}));(function(f,e){function d(b){this.math2d=e}d.prototype={haveCollided:function(b,a){var d=b.getWidth()*b.getHeight()/2,e=a.getWidth()*a.getHeight()/2,d=d<e?d:e;return this.math2d.getSquareDistance(b.getLocation(),a.getLocation())<=d*d}};f.Radial=new d})(window.Match.collisions||(window.Match.collisions={}),window.Match.math2d);(function(f){function e(){}e.prototype={haveCollided:function(d,b){return d.getBottom()<b.getTop()||d.getTop()>b.getBottom()||d.getRight()<b.getLeft()||d.getLeft()>b.getRight()?!1:!0}};f.Simple=new e})(window.Match.collisions||(window.Match.collisions={}));(function(f,e){function d(){this.testContext=document.createElement("canvas").getContext("2d")}d.prototype.haveCollided=function(b,a){var d=window.Math,e=d.min(b.getLeft(),a.getLeft()),f=d.min(b.getTop(),a.getTop()),k=d.max(b.getRight(),a.getRight())-e,n=d.max(b.getBottom(),a.getBottom())-f,m=this.testContext,p=d=0;m.clearRect(e,f,k,n);m.save();b.onRender(m,m.canvas,0,0);m.globalCompositeOperation="source-in";a.onRender(m,m.canvas,0,0);m.restore();for(e=m.getImageData(e,f,k,n);d<e.width;){for(;p<
e.height;){if(0!=e.data[4*(p*e.width+d)+3])return!0;p++}d++;p=0}return!1};e.PixelPerfect=new d})(window.Match,window.Match.collisions||(window.Match.collisions={}));(function(f){function e(){this._halfViewportWidth=this._halfViewportHeight=this.viewportHeight=this.viewportWidth=this._y=this._x=0}e.prototype.setViewport=function(d,b){this.viewportWidth=d;this.viewportHeight=b;this._halfViewportWidth=d/2;this._halfViewportHeight=b/2};e.prototype.centerAtRenderizable=function(d){this.x=d._x-this._halfViewportWidth;this.y=d._y-this._halfViewportHeight};e.prototype.centerAt=function(d,b){this.x=d-this._halfViewportWidth;this.y=b-this._halfViewportHeight;f.redrawAllLayers()};
e.prototype.setX=function(d){this._x=d;f.redrawAllLayers()};e.prototype.setY=function(d){this._y=d;f.redrawAllLayers()};e.prototype.getX=function(){return this._x};e.prototype.getY=function(){return this._y};e.prototype.offsetX=function(d){this.setX(this._x+d)};e.prototype.offsetY=function(d){this.setY(this._y+d)};e.prototype.getLeftFromLayer=function(d){return this.x*d.parrallaxFactor.x};e.prototype.getTopFromLayer=function(d){return this.y*d.parrallaxFactor.y};e.prototype.getBottomFromLayer=function(d){return this.getTopFromLayer(d)+
this.viewportHeight};e.prototype.getRightFromLayer=function(d){return this.getLeftFromLayer(d)+this.viewportWidth};f.onLoopProperties.camera=f.camera=new e})(window.Match);(function(f){function e(a){n.mousedown(a)}function d(a){n.mouseup(a)}function b(a){n.click(a)}function a(a){n.mousemove(a)}function h(a){n.mousewheel(a)}function g(a){n.DOMMouseScroll(a)}function q(a){a.preventDefault()}function k(){this.events={0:{},1:{},2:{}};this.y=this.x=null;this.isDragging=!1}var n;k.prototype.LEFT=0;k.prototype.MIDDLE=1;k.prototype.RIGHT=2;k.prototype.select=function(a){this.isDragging||(this.selectedObject=a)};k.prototype.preventContexMenu=function(a){a?document.addEventListener("contextmenu",
q,!1):document.removeEventListener("contextmenu",q,!1)};k.prototype.fireEventOnLastSelectedObject=function(){var a=this.selectedObject,b=this.prevSelectedObject;if(a){a.onMouseIn&&!a._mouseInRaised&&(a._mouseInRaised=!0,a.onMouseIn(this));if(b&&b!=a&&(b._mouseInRaised=!1,b.onMouseOut))b.onMouseOut(this);if(a.onMouseUp&&this.up())a.onMouseUp(this);if(a.onClick&&this.clicked())a.onClick(this);if(this.down()){if(a.onMouseDown)a.onMouseDown(this);this.isDragging=!0;if(a.onDrag)a.onDrag(this)}if(a.onMouseOver)a.onMouseOver(this);
if(a.onMouseMove&&this.moved())a.onMouseMove(this);if(a.onMouseWheel&&this.wheel())a.onMouseWheel(this)}else b&&b.onMouseOut&&(b._mouseInRaised=!1,b.onMouseOut(this));this.prevSelectedObject=a;this.isDragging||(this.selectedObject=null)};k.prototype.clicked=function(a){return null!=a?this.events[a].click:this.events[0].click};k.prototype.down=function(a){return null!=a?this.events[a].down:this.events[0].down||this.events[1].down||this.events[2].down};k.prototype.up=function(a){return null!=a?this.events[a].up:
this.events[0].up||this.events[1].up||this.events[2].up};k.prototype.moved=function(){return this.eventMouseMove};k.prototype.wheel=function(){this.wheelDeltaY=0;this.eventMouseWheel&&(this.wheelDeltaY=this.eventMouseWheel.wheelDeltaY);return this.wheelDeltaY};k.prototype.clear=function(){for(var a=0;3>a;a++)this.events[a].up=null,this.events[a].click=null;this.eventMouseMove=this.eventMouseWheel=null};k.prototype.click=function(a){this.events[a.button].click=a;this.x=a.offsetX;this.y=a.offsetY};
k.prototype.mousedown=function(a){this.events[a.button].down=a};k.prototype.mouseup=function(a){this.events[a.button].down=null;this.events[a.button].up=a;this.isDragging=!1};k.prototype.mousewheel=function(a){this.eventMouseWheel=a};k.prototype.DOMMouseScroll=function(a){this.mousewheel({wheelDeltaY:-40*a.detail})};k.prototype.isOverPixelPerfect=function(a){if(a.onRender&&a._visible){var b=f.offScreenContext,d=f.offScreenCanvas,h=f.camera;b.save();b.clearRect(0,0,d.width,d.height);a.onRender(b,d,
h._x,h._y);a=b.getImageData(this.x,this.y,1,1);return a.data[3]?a.data[0]||a.data[1]||a.data[2]?!0:!1:!1}};k.prototype.isOverPolygon=function(a){var b=f.camera,d=this.x+b._x,b=this.y+b._y;return a._rotation?(this._x=d,this._y=b,f.collisions.Polygon.haveCollided(a,this)):a.getBottom()<b||a.getTop()>b||a.getRight()<d||a.getLeft()>d?!1:!0};k.prototype.getHeight=function(){return 2};k.prototype.getWidth=function(){return 2};k.prototype.update=function(){this.fireEventOnLastSelectedObject();this.clear()};
k.prototype.applyToObject=function(a){(a.onMouseOver||a.onMouseIn||a.onMouseOut||a.onMouseWheel||a.onMouseDown&&this.down()||a.onMouseUp&&this.up()||a.onClick&&this.clicked())&&this.isOverPolygon(a)&&this.isOverPixelPerfect(a)&&this.select(a)};f.browser.isFirefox?(k.prototype.mousemove=function(a){this.eventMouseMove=a;this.prevX=this.x;this.prevY=this.y;this.x=a.layerX-a.target.offsetLeft;this.y=a.layerY-a.target.offsetTop},k.prototype.click=function(a){this.events[a.button].click=a;this.prevX=this.x;
this.prevY=this.y;this.x=a.layerX-a.target.offsetLeft;this.y=a.layerY-a.target.offsetTop}):k.prototype.mousemove=function(a){this.eventMouseMove=a;this.prevX=this.x;this.prevY=this.y;this.x=a.offsetX;this.y=a.offsetY};k.prototype.bind=function(){f.browser.isFirefox?document.addEventListener("DOMMouseScroll",g,!1):"MSIE 9.0"==f.browser.name?document.addEventListener("onwheel",h,!1):document.addEventListener("mousewheel",h,!1);document.addEventListener("mousedown",e,!1);document.addEventListener("mouseup",
d,!1);document.addEventListener("mousemove",a,!1);document.addEventListener("click",b,!1);f.setMouse(this)};k.prototype.unbind=function(){f.browser.isFirefox?document.removeEventListener("DOMMouseScroll",g):"MSIE 9.0"==f.browser.name?document.removeEventListener("onwheel",h):document.removeEventListener("mousewheel",h);document.removeEventListener("mousedown",e);document.removeEventListener("mouseup",d);document.removeEventListener("mousemove",a);document.removeEventListener("click",b);f.setMouse(null)};
n=new k;n.bind()})(window.Match);(function(f){function e(a){b.accelerate(a)}function d(){}var b;d.prototype.accelerate=function(a){this._hasEvent=!0;this.accelerationIncludingGravity=a.accelerationIncludingGravity;this.acceleration=a.acceleration;this.rotationRate=a.rotationRate};d.prototype.update=function(){this._hasEvent=!1};d.prototype.right=function(){return this._hasEvent&&(0<this.acceleration.x||0<this.accelerationIncludingGravity.x)};d.prototype.left=function(){return this._hasEvent&&(0>this.acceleration.x||0>this.accelerationIncludingGravity.y)};
d.prototype.up=function(){return this._hasEvent&&0<this.acceleration.y};d.prototype.down=function(){return this._hasEvent&&0>this.acceleration.y};d.prototype.applyToObject=function(a){if(this._hasEvent){if(a.onDeviceAccelerationIncludingGravity)a.onDeviceAccelerationIncludingGravity(this.accelerationIncludingGravity.x,this.accelerationIncludingGravity.y,this.accelerationIncludingGravity.z,this.rotationRate);if(a.onDeviceAcceleration)a.onDeviceAcceleration(this.acceleration.x,this.acceleration.y,this.acceleration.z,
this.rotationRate);if(a.onDeviceRotation)a.onDeviceRotation(this.rotationRate.alpha,this.rotationRate.beta,this.rotationRate.gamma)}};d.prototype.bind=function(){window.addEventListener("devicemotion",e,!1);f.setAccelerometer(this)};d.prototype.unbind=function(){window.removeEventListener("devicemotion",e);f.setAccelerometer(null)};b=new d;b.bind()})(window.Match);(function(f){function e(b){a.fireDown(b)}function d(b){a.fireUp(b)}function b(){this.keysDown={length:0};this.keysUp=null;this.keysPressed={}}var a;b.prototype.bind=function(){document.addEventListener("keydown",e,!1);document.addEventListener("keyup",d,!1);f.setKeyboard(this)};b.prototype.unbind=function(){document.removeEventListener("keydown",e);document.removeEventListener("keyup",d);f.setKeyboard(null)};b.prototype[8]="backspace";b.prototype[9]="tab";b.prototype[13]="enter";b.prototype[16]="shift";
b.prototype[17]="ctrl";b.prototype[18]="alt";b.prototype[19]="pause";b.prototype[20]="capslock";b.prototype[27]="escape";b.prototype[32]="space";b.prototype[33]="pageup";b.prototype[34]="pagedown";b.prototype[35]="end";b.prototype[36]="home";b.prototype[37]="left";b.prototype[38]="up";b.prototype[39]="right";b.prototype[40]="down";b.prototype[45]="insert";b.prototype[46]="delete";b.prototype[112]="f1";b.prototype[113]="f2";b.prototype[114]="f3";b.prototype[115]="f4";b.prototype[116]="f5";b.prototype[117]=
"f6";b.prototype[118]="f7";b.prototype[119]="f8";b.prototype[120]="f9";b.prototype[121]="f10";b.prototype[122]="f11";b.prototype[123]="f12";b.prototype[145]="numlock";b.prototype[220]="pipe";b.prototype.fireDown=function(a){a=this[a.which]||String.fromCharCode(a.which).toLowerCase();this.keysDown[a]=!0;void 0==this.keysPressed[a]&&(this.keysPressed[a]=!0);this.keysDown.length++};b.prototype.fireUp=function(a){a=this[a.which]||String.fromCharCode(a.which).toLowerCase();this.keysUp||(this.keysUp={});
this.keysDown[a]=!1;this.keysPressed[a]=void 0;this.keysUp[a]=!0;0<this.keysDown.length&&this.keysDown.length--};b.prototype.update=function(){this.keysUp=null;for(var a in this.keysPressed)this.keysPressed[a]&&(this.keysPressed[a]=!1)};b.prototype.applyToObject=function(a){if(a.hasFocus){if(a.onKeyDown)a.onKeyDown(this.keysDown);if(a.onKeyUp)a.onKeyUp(this.keysUp);if(a.keyDownMappings&&0<this.keysDown.length)for(var b in a.keyDownMappings)if(this.keysDown[b])a[a.keyDownMappings[b]]();if(a.keyUpMappings&&
this.keysUp)for(b in a.keyUpMappings)if(this.keysUp[b])a[a.keyUpMappings[b]]()}};b.prototype.getKeyCode=function(a){return a.charCodeAt(0)};a=new b;a.bind()})(window.Match);(function(f){function e(a){h.start(a)}function d(a){h.end(a)}function b(a){h.move(a)}function a(){this.y=this.x=0;this.isDragging=!1;this.events={start:null,end:null,move:null}}var h;a.prototype.clear=function(){this.events.end&&(this.events.start=null,this.y=this.x=0);this.events.end=null;this.force=this.events.move=null;this.isDragging||(this.selectedObject=null)};a.prototype.update=function(){this.fireEventOnLastSelectedObject(this);this.clear()};a.prototype.getHeight=function(){return 2};a.prototype.getWidth=
function(){return 2};a.prototype.applyToObject=function(a){!this.isDragging&&((a.onTouch||a.onTouchEnd||a.onTouchMove||a.onDrag)&&this.isOverPolygon(a)&&this.isOverPixelPerfect(a))&&(this.selectedObject=a)};a.prototype._setTouch=function(a){this.x=a.pageX-a.target.offsetLeft;this.y=a.pageY-a.target.offsetTop;this.force=a.force};a.prototype.start=function(a){a=a.changedTouches;a.length&&(a=a[0],this._setTouch(a),this.events.start=a)};a.prototype.end=function(a){a=a.changedTouches;a.length&&(this.events.end=
a[0],this.isDragging=!1,this.selectedObject=null)};a.prototype.move=function(a){a=a.changedTouches;a.length&&(a=a[0],this._setTouch(a),this.events.move=a)};a.prototype.started=function(){return this.events.start};a.prototype.moved=function(){return this.events.move};a.prototype.ended=function(){return this.events.end};a.prototype.any=function(){return this.started()||this.moved()||this.ended()};a.prototype.fireEventOnLastSelectedObject=function(){if(this.selectedObject){if(this.events.start){if(this.selectedObject.onTouch)this.selectedObject.onTouch(this);
this.selectedObject.onDrag&&(this.isDragging=!0)}if(this.events.end&&this.selectedObject.onTouchEnd)this.selectedObject.onTouchEnd(this);if(this.events.move){if(this.selectedObject.onTouchMove)this.selectedObject.onTouchMove(this);if(this.isDragging)this.selectedObject.onDrag(this)}}};a.prototype.isOverPixelPerfect=function(a){if(a.onRender&&a._visible){var b=f.offScreenContext,d=f.offScreenCanvas,e=f.camera;b.save();b.clearRect(0,0,d.width,d.height);a.onRender(b,d,e.x,e.y);a=b.getImageData(this.x,
this.y,1,1);return a.data[3]?a.data[0]||a.data[1]||a.data[2]?!0:!1:!1}};a.prototype.isOverPolygon=function(a){var b=f.camera,d=this.x+b.x,b=this.y+b.y;return a._rotation?(this._x=d,this._y=b,f.collisions.Polygon.haveCollided(a,this)):a.getBottom()<b||a.getTop()>b||a.getRight()<d||a.getLeft()>d?!1:!0};a.prototype.bind=function(){document.addEventListener("touchstart",e,!1);document.addEventListener("touchend",d,!1);document.addEventListener("touchmove",b,!1);f.setTouch(this)};a.prototype.unbind=function(){document.removeEventListener("touchstart",
e);document.removeEventListener("touchend",d);document.removeEventListener("touchmove",b);f.setTouch(null)};h=new a;h.bind()})(window.Match);(function(f){function e(){}e.prototype.rgb=function(d,b,a){return"rgb("+[d,b,a].join()+")"};e.prototype.rgba=function(d,b,a,e){return"rgba("+[d,b,a,e].join()+")"};e.prototype.rgbToHex=function(d,b,a){return"#"+this.componentToHex(d)+this.componentToHex(b)+this.componentToHex(a)};e.prototype.componentToHex=function(d){d=d.toString(16);return 1==d.length?"0"+d:d};e.prototype.hexToRgb=function(d){d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d);return this.rgb(parseInt(d[1],16),parseInt(d[2],16),
parseInt(d[3],16))};e.prototype.alpha=function(){return this.rgba(0,0,0,0)};e.prototype.random=function(){var d=window.Math;return this.rgb(d.round(255*d.random()),d.round(255*d.random()),d.round(255*d.random()))};e.prototype.rgbStringToObject=function(d){var b={};d&&(d=d.match(/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/))&&(b.r=parseInt(d[1]),b.g=parseInt(d[2]),b.b=parseInt(d[3]));return b};f.color=new e})(window.Match);(function(f){function e(){this.math=window.Math}e.prototype.integer=function(d,b){return this.math.floor(this.math.random()*(b-d+1))+d};e.prototype.decimal=function(d,b){return this.math.random()*(b-d)+d};e.prototype.bool=function(){return 0.5>this.math.random()};e.prototype.sign=function(){return this.bool()?1:-1};e.prototype.booleanFromChance=function(d){return this.integer(0,100)<=d};e.prototype.color=function(){return f.color.random()};e.prototype.area=function(d,b,a,e){return{x:f.random.integer(d,
a),y:f.random.integer(b,e)}};f.random=new e})(window.Match);(function(f){function e(){}f.postProcess||(f.postProcess={});e.prototype.run=function(d){return d.canvas};f.postProcess.NoPostProcess=e})(window.M);(function(f){function e(){}f.postProcess||(f.postProcess={});e.prototype.run=function(d){var b=d.getImageData(0,0,d.canvas.width,d.canvas.height),a=b.data,e=a.length,g,f,k,n;for(g=0;g<e;g+=4)f=a[g],k=a[g+1],n=a[g+2],f=0.2126*f+0.7152*k+0.0722*n,a[g]=a[g+1]=a[g+2]=f;d.putImageData(b,0,0);return d.canvas};f.postProcess.GrayScale=e})(window.M);
(function(f){function e(d){if(void 0==d)throw Error("Brightness has no constructor that takes no arguments. You must specify the brightness value");this.value=d}f.postProcess||(f.postProcess={});e.prototype.run=function(d){for(var b=d.getImageData(0,0,d.canvas.width,d.canvas.height),a=b.data,e=0;e<a.length;e+=4)a[e]+=this.value,a[e+1]+=this.value,a[e+2]+=this.value;d.putImageData(b,0,0);return d.canvas};f.postProcess.Brightness=e})(window.M);
(function(f){function e(d,b){this.matrix=d;this.opaque=b}f.postProcess||(f.postProcess={});e.prototype.setSharpen=function(){this.matrix=[0,-1,0,-1,5,-1,0,-1,0]};e.prototype.setBlur=function(){this.matrix=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]};e.prototype.setContour=function(){this.matrix=[1,1,1,1,0.7,-1,-1,-1,-1]};e.prototype.run=function(d){if(this.matrix){var b=Math.round(Math.sqrt(this.matrix.length)),a=Math.floor(b/2),e=d.getImageData(0,0,d.canvas.width,d.canvas.height),g=e.data,f=e.width,k=
e.height,n=document.createElement("canvas").getContext("2d");n.canvas.width=e.width;n.canvas.height=e.height;for(var e=n.getImageData(0,0,e.width,e.height),n=e.data,m=this.opaque?1:0,p=0;p<k;p++)for(var r=0;r<f;r++){for(var s=p,w=r,x=4*(p*f+r),B=0,C=0,D=0,y=0,z=0;z<b;z++)for(var A=0;A<b;A++){var u=s+z-a,v=w+A-a;0<=u&&(u<k&&0<=v&&v<f)&&(u=4*(u*f+v),v=this.matrix[z*b+A],B+=g[u]*v,C+=g[u+1]*v,D+=g[u+2]*v,y+=g[u+3]*v)}n[x]=B;n[x+1]=C;n[x+2]=D;n[x+3]=y+m*(255-y)}d.putImageData(e,0,0);return d.canvas}};
f.postProcess.Convolute=e})(window.M);(function(f){function e(d,b){this.postProcessing=new f.postProcess.NoPostProcess;this.buffer=document.createElement("canvas").getContext("2d");this.onRenderList=[];this.needsRedraw=!0;this.needsSorting=!1;this.operation=this.scale=this.rotation=null;this.parrallaxFactor={x:1,y:1};this._onLoopAnimations=[];this.name=d||"layer"+f._gameLayers.length;this._zIndex=b||0;this.result=this.buffer.canvas;f.frontBuffer&&this.setSize(f.frontBuffer.canvas.width,f.frontBuffer.canvas.height)}e.prototype._loopThroughAnimations=
function(){for(var d=0,b=this._onLoopAnimations.length;d<b;d++)this._onLoopAnimations[d].onLoop()||this._onLoopAnimations.splice(d,1)};e.prototype.setAlpha=function(d){this._alpha=d};e.prototype.getAlpha=function(){return this._alpha};e.prototype.fadeIn=function(d,b){this._onLoopAnimations.push(new f.effects.visual.FadeIn(this,d,b));return this};e.prototype.fadeOut=function(d,b){this._onLoopAnimations.push(new f.effects.visual.FadeOut(this,d,b));return this};e.prototype.continousFade=function(d,b,
a,e){this._onLoopAnimations.push(new f.effects.visual.ContinousFade(this,d,b,a,e));return this};e.prototype.setBufferSize=function(d){if(!(d instanceof HTMLCanvasElement))throw Error("setBufferSize is expecting an HTMLCanvasElement as argument");this.buffer.canvas.width=d.width;this.buffer.canvas.height=d.height};e.prototype.setAntialiasing=function(d){this.buffer.mozImageSmoothingEnabled=d;this.buffer.webkitImageSmoothingEnabled=d;this.buffer.mozImageSmoothingEnabled=d;this.buffer.webkitImageSmoothingEnabled=
d};e.prototype.getWidth=function(){return this.buffer.canvas.width};e.prototype.getHeight=function(){return this.buffer.canvas.height};e.prototype.setWidth=function(d){this.buffer.canvas.width=d};e.prototype.setHeight=function(d){this.buffer.canvas.height=d};e.prototype.setSize=function(d,b){this.setWidth(d);this.setHeight(b)};e.prototype.getCenter=function(){return new f.math2d.Vector2d(this.buffer.canvas.width/2,this.buffer.canvas.height/2)};e.prototype.clearUsingDefault=function(d,b){d.clearRect(0,
0,b.width,b.height)};e.prototype.clearUsingFillColor=function(d,b){d.fillStyle=this.clearColor;d.fillRect(0,0,b.width,b.height)};e.prototype.clearUsingImage=function(d,b){d.drawImage(this.clearImage,0,0)};e.prototype.clear=e.prototype.clearUsingDefault;e.prototype.onLoop=function(d){if(this.needsRedraw){var b=d.camera._x*this.parrallaxFactor.x,a=d.camera._y*this.parrallaxFactor.y,e=b+d.camera.viewportWidth;d=a+d.camera.viewportHeight;var g=this.buffer,f=g.canvas;this.clear(g,f);this.renderGameObjects(this.onRenderList,
g,f,b,a,e,d);this.needsRedraw=!1;this.result=this.postProcessing.run(g)}this.needsSorting&&(this.sort(),this.needsSorting=!1);this._loopThroughAnimations();return this.result};e.prototype.renderGameObjects=function(d,b,a,e,g,f,k){for(var n=0;n<d.length;n++){var m=d[n];m.isVisible(e,g,f,k)&&(m.onRender(b,a,e,g,f,k),m.children&&this.renderGameObjects(m.children,b,a,e,g,f,k))}};e.prototype.addToGame=function(){f.pushGameLayer(this)};e.prototype.renderizableChanged=function(){this.needsRedraw=!0};e.prototype.zIndexChanged=
function(){this.needsSorting=!0};e.prototype.setZIndex=function(d){this._zIndex=d;f.sortLayers()};e.prototype.getZIndex=function(){return this._zIndex};e.prototype.push=function(d,b,a){if(!d)throw Error("Cannot push null Object to game layer");if(!d.onRender)throw Error(f.getObjectName(d)+" must implement onRender method");d.isVisible||(console.warn(f.getObjectName(d)+" does not implement isVisible method. A default method will be appended. Rendering objects outside of game area is inefficient and innecessary, please implement isVisible for better performance"),
d.isVisible=function(){return!0});d.setZIndex||console.warn(f.getObjectName(d)+" does not implement setZIndex method");d.getZIndex||console.warn(f.getObjectName(d)+" does not implement getZIndex method");d._zIndex||(d._zIndex=this.onRenderList.length);d.notifyChange||(console.warn(f.getObjectName(d)+" does not implement notifyChange method. This method must inform the onwerLayer of any change in a value that would require a redraw action. ie: function() { this.ownerLayer.renderizableChanged(); } ownerLayer is added when the object is pushed into a layer by default"),
d.notifyChange=function(){this.ownerLayer&&this.ownerLayer.renderizableChanged()});d.notifyZIndexChange||(console.warn(f.getObjectName(d)+" does not implement notifyZIndexChange method. This method must inform the onwerLayer of any change in the zIndex so that the layer reorders its children. ie: function() { this.ownerLayer.zIndexChanged(); } ownerLayer is added when the object is pushed into a layer by default"),d.notifyZIndexChange=function(){this.ownerLayer&&this.ownerLayer.zIndexChange()});d.ownerLayer=
this;if(d.onLoad)d.onLoad();this.needsSorting=!0;this.onRenderList.push(d);d.onLoop&&f.pushGameObject(d);var e=f.camera;b=e.x*this.parrallaxFactor.x;a=e.y*this.parrallaxFactor.y;var g=b+e.viewportWidth,e=a+e.viewportHeight;this.needsRedraw||(this.needsRedraw=d.isVisible(b,a,g,e))};e.prototype.sort=function(){this.onRenderList.sort(this._sortFunction)};e.prototype._sortFunction=function(d,b){return d._zIndex-b._zIndex};e.prototype.getFirst=function(){return this.getIndex(0)};e.prototype.getIndex=function(d){try{return this.onRenderList[d]}catch(b){return null}};
e.prototype.getAsBase64Image=function(){return this.buffer.canvas.toDataURL()};e.prototype.getAsImage=function(){var d=new Image;d.src=this.getAsBase64Image();return d};e.prototype.get=function(d){if(this.cache&&this.cache.key==d)return this.cache;for(var b=this.onRenderList.length,a;b--;)if(a=this.onRenderList[b],d==a.key)return this.cache=a;return null};e.prototype.getLast=function(){return this.getIndex(this.onRenderList.length-1)};e.prototype.isOnRenderList=function(d){return-1!=this.onRenderList.indexOf(d)};
e.prototype.remove=function(d){if(d){if("string"==typeof d)this.remove(this.get(d));else{var b=this.onRenderList.indexOf(d);-1<b&&this.onRenderList.splice(b,1)}d.onLoop&&f.removeGameObject(d);d.ownerLayer=null;this.needsRedraw=!0}};e.prototype.removeAll=function(){this.onRenderList=[]};e.prototype.setBackground=function(d){""==!d&&"string"==typeof d?f.sprites[d]?(this.clearImage=f.sprites[d]._image,this.clear=this.clearUsingImage):(this.clearColor=d,this.clear=this.clearUsingFillColor):this.clear=
this.clearUsingDefault};e.prototype.getBackground=function(){return this.buffer.canvas.getPropertyValue("background")};f.GameLayer=f.Layer=e})(window.Match);(function(f,e){function d(){this.path="";this.total=this.toLoad=0;this.onImageLoaded=new e;this.onAllImagesLoaded=new e;this.onImageError=new e;this.assets={}}function b(){f.sprites._imageError(this)}function a(){f.sprites._imageLoaded(this)}d.prototype._imageLoaded=function(a){this.toLoad--;if(a.frames)if(a.frames instanceof Array)for(var b in a.frames)a.frames[b].halfWidth=a.frames[b].width/2,a.frames[b].halfHeight=a.frames[b].height/2;else{b=[];var d=a.frames.width,e=a.frames.height,f=a.frames.padding||
0,m=Math.floor(a.width/(d+f)),p=Math.floor(a.height/(e+f)),r,s;for(s=0;s<p;s++)for(r=0;r<m;r++)b.push({x:(f+d)*r+f,y:(f+e)*s+f,width:d,height:e,halfWidth:d/2,halfHeight:e/2});a.frames=b}else a.frames=[{x:0,y:0,width:a.width,height:a.height,halfWidth:a.width/2,halfHeight:a.height/2}];this.onImageLoaded.raise({image:a,name:a.getAttribute("data-name"),remaining:this.toLoad,total:this.total});0>=this.toLoad&&this.onAllImagesLoaded.raise()};d.prototype._imageError=function(a){this.toLoad--;this.onImageError.raise(a);
console.error("Could not load",a.src)};d.prototype.load=function(d,e,q){var k;e&&this.onAllImagesLoaded.addEventListener(e);q&&this.onImageLoaded.addEventListener(q);if(d instanceof Array){var n={},m=0,p=this;e=function(a){a=JSON.parse(a);n[a.name]=a;m++;m>=d.length&&p.load(n)};for(k=0;k<d.length;k++)f.Ajax.post(d[k],e)}else for(k in d)e=d[k],q=new Image,q.setAttribute("data-name",k),q.onload=a,q.onerror=b,this.total=++this.toLoad,"string"==typeof e?q.src=this.path+e:(q.src=this.path+e.source,q.frames=
e.frames,q.animations=e.animations),this.assets[k]=q};d.prototype.remove=function(a){this.assets[a]&&(delete this.assets[a],0<=this.total-1&&this.total--,0<=this.toLoad-1&&this.toLoad--)};d.prototype.removeAll=function(){this.assets={};this.toLoad=this.total=0};d.prototype.removeAllEventListeners=function(){this.onImageLoaded=new e;this.onAllImagesLoaded=new e;this.onImageError=new e};f.SpriteManager=new d;f.sprites=f.SpriteManager})(M,EventListener);(function(f,e){function d(a,b){this.audioBuffer=[];this.src=b;this.name=a;this.increaseBuffer()}function b(){f.sounds.assets[this.name].setReady();f.sounds.toLoad--;0>=f.sounds.toLoad&&f.sounds.onAllSoundsLoaded.raise()}function a(){console.warn("Unable to load "+this.src);f.sounds.error=!0;f.sounds.assets[this.name].setNotReady();f.sounds.toLoad--;0>=f.sounds.toLoad&&f.sounds.onAllSoundsLoaded.raise()}function h(){this.path="";this.total=this.toLoad=0;this.onSoundLoaded=new e;this.onAllSoundsLoaded=
new e;this.onSoundError=new e;this.error=!1;this.assets={}}d.prototype.MAX_BUFFER=3;d.prototype.setReady=function(){this.canPlay=this.checkOk;1==this.audioBuffer.length&&f.sounds.onSoundLoaded.raise({sound:this,remaining:f.sounds.toLoad,total:f.sounds.total})};d.prototype.setNotReady=function(){this.canPlay=this.checkOk;f.sounds.onSoundError.raise({sound:this,remaining:f.sounds.toLoad,total:f.sounds.total})};d.prototype.play=function(a){if(this.canPlay()){for(var b=0,d;b<this.audioBuffer.length;){d=
this.audioBuffer[b];if(d.ended||0==d.currentTime){d.loop=a;d.play();return}b++}d=this.audioBuffer[0];d.pause();d.currentTime=0;d.loop=a;d.play();this.audioBuffer.length<this.MAX_BUFFER&&this.increaseBuffer()}};d.prototype.stop=function(){this.canPlay()&&this.each(function(a){0<a.duration&&(a.pause(),a.currentTime=0)})};d.prototype.pause=function(){this.canPlay()&&(this.onNextPauseResume?(this.play(),this.onNextPauseResume=!1):(this.onNextPauseResume=this.isPlaying(),this.each(function(a){a.pause()})))};
d.prototype.checkFail=function(){return!1};d.prototype.checkOk=function(){return!0};d.prototype.canPlay=function(){this.increaseBuffer();return!1};d.prototype.setPlaybackRate=function(a){this.each(function(b){b.playbackRate=a})};d.prototype.resetPlaybackRate=function(){this.each(function(a){a.playbackRate=1})};d.prototype.getPlaybackRate=function(){return this.audioBuffer[0].playbackRate};d.prototype.isPaused=function(){var a=0;for(l=this.audioBuffer.length;a<l;a++)if(this.audioBuffer[a].paused)return!0;
return!1};d.prototype.setVolume=function(a){this.each(function(b){b.volume=a})};d.prototype.isPlaying=function(){var a=0;for(l=this.audioBuffer.length;a<l;a++)if(!this.audioBuffer[a].paused)return!0;return!1};d.prototype.each=function(a){for(var b=this.audioBuffer.length;b--;)a(this.audioBuffer[b])};d.prototype.increaseBuffer=function(){var d=new Audio(this.src),e=this.audioBuffer[0];d.addEventListener("loadeddata",b);d.addEventListener("error",a);d.name=this.name;e&&(d.muted=e.muted,d.volume=e.volume);
this.audioBuffer.push(d)};d.prototype.mute=function(){this.each(function(a){a.muted=!a.muted})};d.prototype.setLoop=function(a){this.audioBuffer[0].loop=a};var g=function(){};fakeSound={name:""};for(var q in d.prototype)"function"==typeof d.prototype[q]&&(fakeSound[q]=g);h.prototype.load=function(a,b,d){d&&this.onSoundLoaded.addEventListener(d);b&&this.onAllSoundsLoaded.addEventListener(b);if(a instanceof Array){var e={},h=0,g=this;b=function(b){h++;b=JSON.parse(b);e[b.name]=b.source;h>=a.length&&
g.load(e)};for(var q=0;q<a.length;q++)f.Ajax.post(a[q],b)}else for(q in a)this.loadOne(q,a[q])};h.prototype.loadOne=function(a,b){this.total=++this.toLoad;void 0==f.browser.supportedAudioFormat?(this[a]=fakeSound,fakeSound.name=a,this.onSoundLoaded.raise({sound:fakeSound,remaining:f.sounds.toLoad--,total:f.sounds.total}),0>=this.toLoad&&this.onAllSoundsLoaded.raise()):"data"==b.substr(0,4)?this.assets[a]=new d(a,b):(-1==b.lastIndexOf(".")&&(b+=f.browser.supportedAudioFormat),this.assets[a]=new d(a,
this.path+b));this.assets[a].name=a};h.prototype.pause=function(){for(var a in this)this[a]instanceof d&&this[a].pause()};h.prototype.setVolume=function(a){for(var b in this)this[b]instanceof d&&this[b].setVolume(a)};h.prototype.mute=function(){for(var a in this)this[a]instanceof d&&this[a].mute()};h.prototype.stop=function(){for(var a in this)this[a]instanceof d&&this[a].stop()};h.prototype.remove=function(a){this.assets[a]&&(delete this.assets[a],0<=this.total-1&&this.total--,0<=this.toLoad-1&&
this.toLoad--)};h.prototype.removeAll=function(){this.assets={};this.total=this.toLoad=0};f.SoundManager=f.sounds=new h})(Match,EventListener);(function(f,e){function d(a){this._halfHeight=this._halfWidth=this._height=this._width=this._y=this._x=0;this._scale=this._rotation=null;this._visible=!0;this.operation=null;this.behaviours=new f.ArrayList;this.chainedBehaviours=new f.ArrayList;this._currentChainedBehaviour=0;this._onLoopTimers=new f.ArrayList;this.onwerLayer=this._alpha=null;this._raisedNotVisible=!1;this.set(a)}function b(a,b,d,e){this.width=d-a;this.height=e-b;this._x=a+this.width/2;this._y=b+this.height/2}d.prototype.notifyChange=
function(){this.ownerLayer&&this.ownerLayer.renderizableChanged()};d.prototype.notifyZIndexChange=function(){this.ownerLayer&&this.ownerLayer.zIndexChanged()};d.prototype._zIndex=0;d.prototype.onLoop=function(a){this._loopThroughAnimations();this._loopThroughTimers();if(this.onUpdate)this.onUpdate(a)};d.prototype.set=function(a){if(a){var b="",d;for(d in a)if(b="set"+d.charAt(0).toUpperCase()+d.substr(1),this[b])this[b](a[d]);else this[d]=a[d]}};d.prototype.setAlpha=function(a){0<=a&&1>=a?(this._alpha=
a,this.notifyChange()):this._alpha=null};d.prototype.getAlpha=function(){return this._alpha};d.prototype._loopThroughAnimations=function(){this.behaviours.each(function(a,b,d){a&&!a.onLoop()&&d.quickRemove(b)});this.chainedBehaviours.size&&(this.chainedBehaviours._list[this._currentChainedBehaviour].onLoop()||this._currentChainedBehaviour++,this._currentChainedBehaviour==this.chainedBehaviours.size&&(this.chainedBehaviours.removeAll(),this._currentChainedBehaviour=0))};d.prototype.clearAnimations=
function(){this.behaviours=[]};d.prototype.fadeIn=function(a,b){this.behaviours.push(new e.FadeIn(this,a,b));return this};d.prototype.fadeOut=function(a,b){this.behaviours.push(new e.FadeOut(this,a,b));return this};d.prototype.continousFade=function(a,b,d,f){this.behaviours.push(new e.ContinousFade(this,a,b,d,f));return this};d.prototype.move=function(a,b,d,f,k,n,m){this.behaviours.push(new e.Easing(this,a,b,d,f,k,n,m));return this};d.prototype.scaleUp=function(a,b,d,f){this.behaviours.push(new e.ScaleUp(this,
a,b,d,f));return this};d.prototype.scaleDown=function(a,b,d,f){this.behaviours.push(new e.ScaleDown(this,a,b,d,f));return this};d.prototype.twinkle=function(a,b,d){this.behaviours.push(new e.Twinkle(this,a,b,d));return this};d.prototype.rotate=function(a,b,d){this.behaviours.push(new e.Rotate(this,a,b,d));return this};d.prototype.chainWait=function(a,b){this.chainedBehaviours.push(new e.Wait(this,a,b));return this};d.prototype.chainFadeIn=function(a,b){this.chainedBehaviours.push(new e.FadeIn(this,
a,b));return this};d.prototype.chainFadeOut=function(a,b){this.chainedBehaviours.push(new e.FadeOut(this,a,b));return this};d.prototype.chainContinousFade=function(a,b,d,f){this.chainedBehaviours.push(new e.ContinousFade(this,a,b,d,f));return this};d.prototype.chainMove=function(a,b,d,f,k){this.chainedBehaviours.push(new e.Easing(this,a,b,d,f,k));return this};d.prototype.chainScaleUp=function(a,b,d,f){this.chainedBehaviours.push(new e.ScaleUp(this,a,b,d,f));return this};d.prototype.chainScaleDown=
function(a,b,d,f){this.chainedBehaviours.push(new e.ScaleDown(this,a,b,d,f));return this};d.prototype.chainTwinkle=function(a,b,d){this.chainedBehaviours.push(new e.Twinkle(this,a,b,d));return this};d.prototype.chainRotate=function(a,b,d){this.chainedBehaviours.push(new e.Rotate(this,a,b,d));return this};d.prototype._loopThroughTimers=function(){for(var a=0,b=this._onLoopTimers.length;a<b;a++)this._onLoopTimers[a].onLoop()};d.prototype.addTimer=function(a,b){var d=new f.Timer(a,b,this);this._onLoopTimers.push(d);
return d};d.prototype.removeTimer=function(a){this._onLoopTimers.splice(this._onLoopTimers.indexOf(this._getTimer(a)),1);return this};d.prototype._getTimer=function(a){for(var b=0,d=this._onLoopTimers.length;b<d;b++)if(this._onLoopTimers[b].callback==a)return this._onLoopTimers[b]};d.prototype.setZIndex=function(a){this._zIndex=a;this.notifyChange();this.notifyZIndexChange()};d.prototype.getZIndex=function(){return this._zIndex};d.prototype.setVisible=function(a){this._visible=a;this.notifyChange()};
d.prototype.setWidth=function(a){this._width=a;this._halfWidth=a/2;this.notifyChange()};d.prototype.setHeight=function(a){this._height=a;this._halfHeight=a/2;this.notifyChange()};d.prototype.getWidth=function(){return this._scale?this._width*this._scale.x:this._width};d.prototype.getHeight=function(){return this._scale?this._height*this._scale.y:this._height};d.prototype.setSize=function(a,b){this.setWidth(a);this.setHeight(b)};d.prototype.getSize=function(){return{width:this.getWidth(),height:this.getHeight()}};
d.prototype.setScale=function(a,b){if(a||b)a||(a=1),b||(b=1),this._scale={x:a,y:b},this.notifyChange()};d.prototype.setScaleX=function(a){this._scale||(this._scale={},this._scale.y=1);this._scale.x=a;this.notifyChange()};d.prototype.setScaleY=function(a){this._scale||(this._scale={},this._scale.x=1);this._scale.y=a;this.notifyChange()};d.prototype.mirror=function(){this.invertX()};d.prototype.invertX=function(){this._scale||(this._scale={},this._scale.x=1,this._scale.y=1);this._scale.x*=-1;this.notifyChange()};
d.prototype.invertY=function(){this._scale||(this._scale={},this._scale.x=1,this._scale.y=1);this._scale.y=-1;this.notifyChange()};d.prototype.getLeft=function(){return this._scale?void 0!=this.pivotX?this._x+this.pivotX-this._width*this._scale.x:this._x-this._halfWidth*this._scale.x:void 0!=this.pivotX?this._x+this.pivotX-this._width:this._x-this._halfWidth};d.prototype.getRight=function(){return this._scale?void 0!=this.pivotX?this._x+this.pivotX+this._width*this._scale.x:this._x+this._halfWidth*
this._scale.x:void 0!=this.pivotX?this._x+this.pivotX+this._width:this._x+this._halfWidth};d.prototype.getTop=function(){return this._scale?void 0!=this.pivotY?this._y+this.pivotY-this._height*this._scale.y:this._y-this._halfHeight*this._scale.y:void 0!=this.pivotY?this._y+this.pivotY-this._height:this._y-this._halfHeight};d.prototype.getBottom=function(){return this._scale?void 0!=this.pivotY?this._y+this.pivotY+this._height*this._scale.y:this._y+this._halfHeight*this._scale.y:void 0!=this.pivotY?
this._y+this.pivotY+this._height:this._y+this._halfHeight};d.prototype.setLeft=function(a){this._prevX=this._x;this._x=this._scale?a+this._halfWidth*this._scale.x:a+this._halfWidth;this.updateChildrenPosition();this.notifyChange()};d.prototype.setRight=function(a){this._prevX=this._x;this._x=this._scale?a-this._halfWidth*this._scale.x:a-this._halfWidth;this.updateChildrenPosition();this.notifyChange()};d.prototype.setTop=function(a){this._prevY=this._y;this._y=this._scale?a+this._halfHeight*this._scale.y:
a+this._halfHeight;this.updateChildrenPosition();this.notifyChange()};d.prototype.setBottom=function(a){this._prevY=this._y;this._y=this._scale?a-this._halfHeight*this._scale.y:a-this._halfHeight;this.updateChildrenPosition();this.notifyChange()};d.prototype.getLocation=function(){return{x:this._x,y:this._y}};d.prototype.setLocation=function(a,b){this.prevX=this._x;this.prevY=this._y;this._x=a;this._y=b;this.updateChildrenPosition();this.notifyChange()};d.prototype.movedInX=function(){return this.prevX!=
this._x};d.prototype.movedInY=function(){return this.prevY!=this._y};d.prototype._applyOperation=function(a){this.operation?(a.globalCompositeOperation=this.operation,a.operationChanged=!1):a.operationChanged&&a.resetOperation()};d.prototype._applyAlpha=function(a){null!=this._alpha&&0<=this._alpha&&1>=this._alpha?(a.globalAlpha=this._alpha,a.alphaChanged=!0):a.alphaChanged&&a.resetAlpha()};d.prototype._applyShadow=function(a){this._shadow?(a.shadowOffsetX=this._shadow.x,a.shadowOffsetY=this._shadow.y,
a.shadowColor=this._shadow.color,a.shadowBlur=this._shadow.blur,a.shadowChanged=!1):a.shadowChanged&&a.resetShadow()};d.prototype._applyTranslation=function(a,b,d){a.translate(this._x-b,this._y-d)};d.prototype._applyRotation=function(a){this._rotation&&a.rotate(this._rotation)};d.prototype._applyScale=function(a){this._scale&&a.scale(this._scale.x,this._scale.y)};d.prototype.offsetAlpha=function(a){this._alpha+=a;this.notifyChange()};d.prototype.offsetRotation=function(a){this._rotation+=a;this.notifyChange()};
d.prototype.isVisible=function(a,b,d,e){if(0==this._alpha||!this._visible)return!1;a=this.isIn(a,b,d,e);this.onOutsideViewport&&(this._raisedNotVisible&&a?this._raisedNotVisible=!1:(this.onOutsideViewport(),this._raisedNotVisible=!0));return a};d.prototype.isIn=function(a,d,e,q){return this._rotation?f.collisions.Polygon.haveCollided(this,new b(a,d,e,q)):this.getBottom()<d||this.getTop()>q||this.getRight()<a||this.getLeft()>e?!1:!0};d.prototype.setRotation=function(a){this._rotation=a;this.notifyChange()};
d.prototype.getRotation=function(){return this._rotation};d.prototype.setX=function(a){this.prevX=this._x;this._x=a;this.updateChildrenPosition();this.notifyChange()};d.prototype.setY=function(a){this.prevY=this._y;this._y=a;this.updateChildrenPosition();this.notifyChange()};d.prototype.updateChildrenPosition=function(){if(this.children)for(var a in this.children)this.children[a].offset(this.prevX-this._x,this.prevY-this._y)};d.prototype.remove=function(){this.ownerLayer.remove(this)};d.prototype.offset=
function(a,b){this.prevX=this._x;this.prevY=this._y;this._x+=a;this._y+=b;this.updateChildrenPosition();this.notifyChange()};d.prototype.offsetX=function(a){this.prevX=this._x;this._x+=a;this.updateChildrenPosition();this.notifyChange()};d.prototype.offsetY=function(a){this.prevY=this._y;this._y+=a;this.updateChildrenPosition();this.notifyChange()};d.prototype.centerAt=function(a){this.setLocation(a.x,a.y)};d.prototype.getX=function(){return this._x};d.prototype.getY=function(){return this._y};d.prototype.onRender=
function(){throw Error("Method onRender must be overriden");};d.prototype.getMaxSize=function(){return Math.max(this.getWidth(),this.getHeight())};d.prototype.toString=function(){return this.constructor.name};f.renderers=f.renderers||{};f.renderers.Renderizable=d;b.prototype.getWidth=function(){return this.width};b.prototype.getHeight=function(){return this.height}})(M,M.effects.visual);(function(f,e,d,b){function a(a){d.apply(this);this._animation=this.animationName=null;this.frameIndex=0;this.isPlaying=!1;a&&this.setImage(a)}a.prototype.setImage=function(a,d){if(!a)throw Error("Image cannot be null");if(a instanceof Image)a.frames||(a.frames=[{x:0,y:0,width:a.width,height:a.height,halfWidth:a.width/2,halfHeight:a.height/2}]),this._image=a;else{var e=b[a];if(e)this._image=e;else throw Error("Image by id "+a+" not loaded");}this.setFrameIndex(d);this._animation=this.animationName=
null;this.isPlaying=!1};a.prototype.play=function(a,b){if(!this._animation||this.animationName!=a||!this.isPlaying){if(a||!this._animation){if(!this._image)throw Error("No image selected");if(!this._image.animations)throw Error("Image has no animations");if(!this._image.animations[a])throw Error("Image has no animation by name "+a);this._animation=this._image.animations[a];this.animationName=a;this._frameIndex=0}this.isPlaying=!0;this.loop=b||this._animation.loop;this.notifyChange()}};a.prototype.stop=
function(){this.isPlaying=!1};a.prototype._animate=function(){if(this.isPlaying){var a=e.getTime();this.currentFrameStartInMillis||(this.currentFrameStartInMillis=a);a-this.currentFrameStartInMillis>this._animation.duration&&(this.currentFrame=this._image.frames[this._animation.frames[this._frameIndex]],this._frameIndex<this._animation.frames.length-1?this._frameIndex++:this.loop?this._frameIndex=0==this._frameIndex?1:0:this._animation.next?this.play(this._animation.next):this.isPlaying=!1,this.currentFrameStartInMillis=
a,this.notifyChange())}};a.prototype.isLastAnimationFrame=function(){return this._animation?this._frameIndex==this._animation.frames.length-1:!1};a.prototype.isFirstAnimationFrame=function(){return this._animation?1==this._frameIndex:!1};a.prototype.onLoop=function(a){this._loopThroughAnimations();this._loopThroughTimers();if(this.onUpdate)this.onUpdate(a);this._animate()};a.prototype.onRender=function(a,b,d,e){if(this._image){this._applyOperation(a);this._applyAlpha(a);var f;b=this.pivotX?this.pivotX:
-this.oHW||-this.currentFrame.halfWidth;f=this.pivotY?this.pivotY:-this.oHH||-this.currentFrame.halfHeight;this._rotation||this._scale?(a.save(),this._applyTranslation(a,d,e),this._applyRotation(a),this._applyScale(a),a.drawImage(this._image,this.currentFrame.x,this.currentFrame.y,this.currentFrame.width,this.currentFrame.height,b,f,this.oW||this.currentFrame.width,this.oH||this.currentFrame.height),a.restore()):(a.drawImage(this._image,this.currentFrame.x,this.currentFrame.y,this.currentFrame.width,
this.currentFrame.height,this._x+b,this._y+f,this.oW||this.currentFrame.width,this.oH||this.currentFrame.height),this._alpha&&a.resetAlpha());this._applyShadow(a)}};a.prototype.setSize=function(a,b){this.oW=a;this.oH=b;this.oHW=a/2;this.oHH=b/2;this.notifyChange()};a.prototype.setFrameIndex=function(a){this._frameIndex=a=a||0;this.currentFrame=this._image.frames[a]};a.prototype.getTop=function(){return this._scale?this._y-this.currentFrame.halfHeight*this._scale.y:this._y-this.currentFrame.halfHeight};
a.prototype.getBottom=function(){return this._scale?this._y+this.currentFrame.halfHeight*this._scale.y:this._y+this.currentFrame.halfHeight};a.prototype.getLeft=function(){return this._scale?this._x-this.currentFrame.halfWidth*this._scale.x:this._x-this.currentFrame.halfWidth};a.prototype.getRight=function(){return this._scale?this._x+this.currentFrame.halfWidth*this._scale.x:this._x+this.currentFrame.halfWidth};a.prototype.getWidth=function(){return this._scale?this.currentFrame.width*this._scale.x:
this.currentFrame.width};a.prototype.getHeight=function(){return this._scale?this.currentFrame.height*this._scale.y:this.currentFrame.height};a.prototype.setLeft=function(a){this._x=this._scale?a+this.currentFrame.halfWidth*this._scale.x:a+this.currentFrame.halfWidth;this.notifyChange()};a.prototype.setRight=function(a){this._x=this._scale?a-this.currentFrame.halfWidth*this._scale.x:a-this.currentFrame.halfWidth;this.notifyChange()};a.prototype.setTop=function(a){this._y=this._scale?a+this.currentFrame.halfHeight*
this._scale.y:a+this.currentFrame.halfHeight;this.notifyChange()};a.prototype.setBottom=function(a){this._y=this._scale?a-this.currentFrame.halfHeight*this._scale.y:a-this.currentFrame.halfHeight;this.notifyChange()};a.prototype.toString=function(){return"Sprite"};e.extend(a,d);f.Sprite=a})(Match.renderers,Match,Match.renderers.Renderizable,Match.sprites.assets);(function(f,e,d){function b(a){d.apply(this,arguments);this._fillStyle="black";this._lineWidth=this._strokeStyle=null;this.set(a)}b.prototype.css=function(a){a=e.getStyleBySelector(a);""!=a.color&&this.setFillStyle(a.color);""!=a.backgroundColor&&this.setFillStyle(a.backgroundColor);""!=a.borderColor&&this.setStrokeStyle(a.borderColor);""!=a.borderWidth&&this.setLineWidth(a.borderWidth);""!=a.width&&this.setWidth(a.width);""!=a.height&&this.setHeight(a.height);""!=a.left&&this.setLeft(a.left);""!=
a.right&&this.setRight(a.right);""!=a.top&&this.setTop(a.top);""!=a.bottom&&this.setBottom(a.bottom);if(""!=a.boxShadow){var b,d,f,k;-1<a.boxShadow.indexOf("rgb")?b=a.boxShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0]:a.boxShadow.indexOf("px")>a.boxShadow.indexOf(" ")&&(b=a.boxShadow.substr(0,a.boxShadow.indexOf(" ")));if(a=a.boxShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/))d=parseInt(a[1]),f=parseInt(a[2]),k=parseInt(a[3]);this.setShadow(d,f,b,k)}};b.prototype.setFillStyle=function(a){this._fillStyle=
a;this.notifyChange()};b.prototype.setStrokeStyle=function(a){this._strokeStyle=a;this.notifyChange()};b.prototype.setStrokeWidth=function(a){this._lineWidth=a;this.notifyChange()};b.prototype.setShadow=function(a,b,d,e){this._shadow={x:a,y:b,color:d||"black",blur:e||1};this.notifyChange()};b.prototype.getFillStyle=function(){return this._fillStyle};b.prototype.getStrokeStyle=function(){return this._strokeStyle};b.prototype.getStrokeWidth=function(){return this._lineWidth};b.prototype.getShadow=function(){return this._shadow};
b.prototype.onRender=function(a,b,d,e){this._applyOperation(a);this._applyAlpha(a);this._rotation||this._scale?(a.save(),this._applyTranslation(a,d,e),this._applyRotation(a),this._applyScale(a),this._fillStyle&&(a.fillStyle=this._fillStyle),a.fillRect(-this._halfWidth,-this._halfHeight,this._width,this._height),this._lineWidth&&(a.lineWidth=this._lineWidth),this._strokeStyle&&(a.strokeStyle=this._strokeStyle,a.strokeRect(-this._halfWidth,-this._halfHeight,this._width,this._height)),a.restore()):(this._fillStyle&&
(a.fillStyle=this._fillStyle),a.fillRect(this._x-this._halfWidth,this._y-this._halfHeight,this._width,this._height),this._lineWidth&&(a.lineWidth=this._lineWidth),this._strokeStyle&&(a.strokeStyle=this._strokeStyle,a.strokeRect(this._x-this._halfWidth,this._y-this._halfHeight,this._width,this._height)));this._applyShadow(a)};b.prototype.toString=function(){return"Rectangle"};e.extend(b,d);f.Rectangle=b})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(f,e,d){function b(a){d.apply(this,arguments);this._fillStyle="rgb(0,0,0)";this._lineWidth=this._strokeStyle=null;this._radius=1;this._startAngle=0;this._endAngle=6.28;this.set(a)}b.prototype.css=function(a){a=e.getStyleBySelector(a);""!=a.color&&this.setFillStyle(a.color);""!=a.backgroundColor&&this.setFillStyle(a.backgroundColor);""!=a.borderColor&&this.setStrokeStyle(a.borderColor);""!=a.borderWidth&&this.setLineWidth(a.borderWidth);""!=a.width&&this.setRadius(a.width);""!=a.height&&this.setRadius(a.height);
""!=a.left&&this.setLeft(a.left);""!=a.right&&this.setRight(a.right);""!=a.top&&this.setTop(a.top);""!=a.bottom&&this.setBottom(a.bottom);if(""!=a.boxShadow){var b,d,f,k;-1<a.boxShadow.indexOf("rgb")?b=a.boxShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0]:a.boxShadow.indexOf("px")>a.boxShadow.indexOf(" ")&&(b=a.boxShadow.substr(0,a.boxShadow.indexOf(" ")));if(a=a.boxShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/))d=parseInt(a[1]),f=parseInt(a[2]),k=parseInt(a[3]);this.setShadow(d,f,b,k)}};
b.prototype.setStrokeStyle=function(a){this._strokeStyle=a;this.notifyChange()};b.prototype.getStrokeStyle=function(){return this._strokeStyle};b.prototype.setFillStyle=function(a){this._fillStyle=a;this.notifyChange()};b.prototype.getFillStyle=function(){return this._fillStyle};b.prototype.setStrokeWidth=function(a){this._lineWidth=a;this.notifyChange()};b.prototype.getStrokeWidth=function(){return this._lineWidth};b.prototype.setRadius=function(a){this._radius=a;this.notifyChange()};b.prototype.setShadow=
function(a,b,d,e){this._shadow={x:a,y:b,color:d||"black",blur:e||1};this.notifyChange()};b.prototype.getShadow=function(){return this._shadow};b.prototype.getRadius=function(){return this._radius};b.prototype.isMouseOver=function(a){a||(a=e.onLoopProperties);return e.Math2d.getDistance({x:this._x,y:this._y},a.mouse)<=this._radius};b.prototype.getWidth=function(){return this._scale?this._radius*this._scale.x:this._radius};b.prototype.getHeight=function(){return this._scale?this._radius*this._scale.y:
this._radius};b.prototype.getLeft=function(){return this._scale?this._x-this._radius*this._scale.x:this._x-this._radius};b.prototype.getRight=function(){return this._scale?this._x+this._radius*this._scale.x:this._x+this._radius};b.prototype.getTop=function(){return this._scale?this._y-this._radius*this._scale.y:this._y-this._radius};b.prototype.getBottom=function(){return this._scale?this._y+this._radius*this._scale.y:this._y+this._radius};b.prototype.setLeft=function(a){this._x=this._scale?a+this._radius*
this._scale.x:a+this._radius;this.notifyChange()};b.prototype.setRight=function(a){this._x=this._scale?a-this._radius*this._scale.x:a-this._radius;this.notifyChange()};b.prototype.setTop=function(a){this._y=this._scale?a+this._radius*this._scale.y:a+this._radius;this.notifyChange()};b.prototype.setBottom=function(a){this._y=this._scale?a-this._radius*this._scale.y:a-this._radius;this.notifyChange()};b.prototype.onRender=function(a,b,d,e){this._applyOperation(a);this._applyAlpha(a);this._scale?(a.save(),
this._applyTranslation(a,d,e),this._applyScale(a),a.beginPath(),a.arc(0,0,this._radius,this._startAngle,this._endAngle,!1),a.closePath(),this._fillStyle&&(a.fillStyle=this._fillStyle,a.fill()),a.restore()):(a.beginPath(),a.arc(this._x-this._radius/2,this._y-this._radius/2,this._radius,this._startAngle,this._endAngle,!1),a.closePath(),this._fillStyle&&(a.fillStyle=this._fillStyle,a.fill()));this._applyShadow(a);this._lineWidth&&(a.lineWidth=this._lineWidth);this._strokeStyle&&(a.strokeStyle=this._strokeStyle,
a.stroke(-this._halfWidth,-this._halfHeight,this._width,this._height))};b.prototype.toString=function(){return"Circle"};e.extend(b,d);f.Circle=b})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(f,e,d){function b(a){d.apply(this,arguments);this._weight=this._variant=this._style="";this._size="14px";this._family="Calibri, Verdana, Arial, Monospace";this._textAlign="center";this._textBaseline="middle";this._text="";this.set(a)}b.prototype.fillText=function(a,b){if(this.multiLine)for(var d=0;d<this.multiLine.length;d++)context.fillText(this.multiLine[d],a,b+d*this.getHeight());else context.fillText(this._text,a,b);this._strokeStyle&&(context.strokeStyle=this._strokeStyle,context.lineWidth=
this._lineWidth||1,context.strokeText(this._text,a,b))};b.prototype.onRender=function(a,b,d,e){this._applyOperation(a);this._applyAlpha(a);a.font=this._style+this._variant+this._weight+this._size+this._family;a.textAlign=this._textAlign;a.textBaseline=this._textBaseline;a.fillStyle=this._fillStyle;this._applyShadow(a);this._rotation||this._scale?(a.save(),this._applyTranslation(a,d,e),this._applyRotation(a),this._applyScale(a),this.fillText(0,0),a.restore()):this.fillText(this._x,this._y)};b.prototype.getRight=
function(){return this._x+this.getWidth()};b.prototype.getBottom=function(){return this._y+this.getHeight()};b.prototype.getHeight=function(){if(this._text==this._cachedText2)return this._height;var a=document.createElement("span"),b;a.font=this._style+this._variant+this._weight+this._size+this._family;a.textContent=this._text;document.body.appendChild(a);b=a.offsetHeight;document.body.removeChild(a);this._height=b;this._cachedText2=this._text;return b};b.prototype.setAlignment=function(a,b){this.setHorizontalAlign(a);
this.setVerticalAlign(b)};b.prototype.setHorizontalAlign=function(a){this._textAlign=a;this.notifyChange()};b.prototype.setVerticalAlign=function(a){this._textBaseline=a;this.notifyChange()};b.prototype.getWidth=function(){if(this._text==this._cachedText)return this._width;var a,b=e.offScreenContext;b.save();b.font=this._style+this._variant+this._weight+this._size+this._family;b.fillStyle=this._fillStyle;a=b.measureText(this._text).width;b.restore();this._width=a;this._cachedText=this._text;return a};
b.prototype.setFamily=function(a){this._family=a;this.notifyChange()};b.prototype.setSize=function(a){this._size=parseInt(a)+"px ";this.notifyChange()};b.prototype.setWeight=function(a){this._weight=a+" ";this.notifyChange()};b.prototype.setBold=function(a){a?this.setWeight("bold"):this.setWeight("")};b.prototype.setVariant=function(a){this._variant=a+" ";this.notifyChange()};b.prototype.setStyle=function(a){this._style=a+" ";this.notifyChange()};b.prototype.setFillStyle=function(a){this._fillStyle=
a;this.notifyChange()};b.prototype.css=function(a){a=e.getStyleBySelector(a);""!=a.color&&this.setFillStyle(a.color);""!=a.fontFamily&&this.setFamily(a.fontFamily);""!=a.fontSize&&this.setSize(a.fontSize);""!=a.fontStyle&&this.setStyle(a.fontStyle);""!=a.fontVariant&&this.setVariant(a.fontVariant);""!=a.fontWeight&&this.setWeight(a.fontWeight);""!=a.left&&this.setLeft(a.left);""!=a.right&&this.setRight(a.right);""!=a.top&&this.setTop(a.top);""!=a.bottom&&this.setBottom(a.bottom);if(""!=a.textShadow){var b,
d,f,k;-1<a.textShadow.indexOf("rgb")?b=a.textShadow.match(/rgb\((\d{1,3}), (\d{1,3}), (\d{1,3})\)/)[0]:a.textShadow.indexOf("px")>a.textShadow.indexOf(" ")&&(b=a.textShadow.substr(0,a.textShadow.indexOf(" ")));if(a=a.textShadow.match(/([0-9]+px) ([0-9]+px) ([0-9]+px)/))d=parseInt(a[1]),f=parseInt(a[2]),k=parseInt(a[3]);this.setShadow(d,f,b,k)}};b.prototype.getSize=function(a){return this._size};b.prototype.getWeight=function(a){return this._weight};b.prototype.getVariant=function(a){return this._variant};
b.prototype.getStyle=function(a){return this._style};b.prototype.setStrokeStyle=function(a){this._strokeStyle=a;this.notifyChange()};b.prototype.setStrokeWidth=function(a){this._lineWidth=a;this._changed=!0};b.prototype.getStrokeWidth=function(){return this._lineWidth};b.prototype.setText=function(a,b){b&&(this.multiLine=a.split("\n"));this._text=a;this.notifyChange()};b.prototype.getFamily=function(a){return this._family};b.prototype.getFillStyle=function(a){return this._fillStyle};b.prototype.getStrokeStyle=
function(a){return this._strokeStyle};b.prototype.getText=function(){return this._text};b.prototype.setShadow=function(a,b,d,e){this._shadow={x:a,y:b,color:d||"black",blur:e||1};this.notifyChange()};b.prototype.getShadow=function(){return this._shadow};b.prototype.toString=function(){return"Text"};e.extend(b,d);f.Text=b})(window.Match.renderers,window.Match,window.Match.renderers.Renderizable);(function(f){function e(d,b,a){this.interval=d;this._lastTime=f.getTime();a?(this.owner=a,this.callback=b):this.tick=b;this.enabled=!0}e.prototype.onLoop=function(d){this.enabled&&f.elapsedTimeFrom(this._lastTime,this.interval)&&(this.tick(),this._lastTime=f.getTime())};e.prototype.tick=function(){this.callback.call(this.owner)};f.Timer=e})(window.Match);(function(f){function e(d){this._lastTime=0;this.time=d}e.prototype.initialize=function(){this._lastTime=f.getTime();this.elapsed=this._run;return!1};e.prototype.setInterval=function(d){this.elapsed=this.initialize;this.time=d;return!1};e.prototype._run=function(){var d=f.getTime();return d-this.time>=this._lastTime?(this._lastTime=d,!0):!1};e.prototype.reset=function(){this.elapsed=this.initialize};e.prototype.elapsed=e.prototype.initialize;f.TimeCounter=e})(window.Match);
